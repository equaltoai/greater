import{f as m,a as f,c as A,w as fe,d as ce,s as U}from"../chunks/Dk8Y7fR_.js";import{p as Q,u as q,h as a,d as W,i as p,a6 as Z,s as x,b as E,r as L,g as O,A as V,f as h,t as H,n as z}from"../chunks/Bpv4puWN.js";import{p as N,a as X,s as de}from"../chunks/DHI4pdy5.js";import{h as $}from"../chunks/C2zQ9FVj.js";import{o as ee}from"../chunks/Ci0fFNKZ.js";import{i as M}from"../chunks/_LYS6rzG.js";import{p as j}from"../chunks/BEwztiVq.js";import"../chunks/BwIUDySL.js";import{a as te,o as le,c as ue,g as he}from"../chunks/CR55hjPZ.js";const me=!1,pe=!1,ve=!0,Ye=Object.freeze(Object.defineProperty({__proto__:null,csr:ve,prerender:pe,ssr:me},Symbol.toStringTag,{value:"Module"}));var ge=fe(m("<script>{preventFlashScript()}<\/script><!>",1)),ye=m('<div class="gr-theme-provider" data-theme-provider=""><!></div>');function be(s,e){Q(e,!0);let t=j(e,"enableSystemDetection",3,!0),r=j(e,"enablePersistence",3,!0),o=j(e,"preventFlash",3,!0);q(()=>{e.theme&&e.theme!==N.preferences.colorScheme&&N.setColorScheme(e.theme)}),ee(()=>(e.theme&&N.setColorScheme(e.theme),()=>{}));const n=Z(()=>()=>c());q(()=>{a(n)()});function c(){if(!o())return"";const i=r()!==!1,d=t()!==!1,g=["if (window.matchMedia('(prefers-contrast: high)').matches) {","  theme = 'high-contrast';","} else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {","  theme = 'dark';","}","if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {","  motion = 'reduced';","}"],l=["(function() {",`  ${i?"const stored = localStorage.getItem('gr-preferences-v1');":"const stored = null;"}`];return l.push("  let theme = 'light';","  let density = 'comfortable';","  let fontSize = 'medium';","  let motion = 'normal';"),i&&l.push("  if (stored) {","    try {","      const prefs = JSON.parse(stored);","      if (prefs.highContrastMode || window.matchMedia('(prefers-contrast: high)').matches) {","        theme = 'high-contrast';","      } else if (prefs.colorScheme === 'auto') {","        theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';","      } else if (prefs.colorScheme) {","        theme = prefs.colorScheme;","      }","      density = prefs.density || 'comfortable';","      fontSize = prefs.fontSize || 'medium';","      motion = prefs.motion || 'normal';","      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {","        motion = 'reduced';","      }","      if (prefs.customColors) {","        const root = document.documentElement;","        if (prefs.customColors.primary) {","          root.style.setProperty('--gr-custom-primary', prefs.customColors.primary);","        }","        if (prefs.customColors.secondary) {","          root.style.setProperty('--gr-custom-secondary', prefs.customColors.secondary);","        }","        if (prefs.customColors.accent) {","          root.style.setProperty('--gr-custom-accent', prefs.customColors.accent);","        }","      }","      if (prefs.fontScale) {","        document.documentElement.style.setProperty('--gr-font-scale', String(prefs.fontScale));","      }","    } catch (e) {","      // Ignore errors and use defaults","    }","  }"),d&&(l.push("  if (!stored) {"),g.forEach(y=>{l.push(`    ${y}`)}),l.push("  }")),l.push("  document.documentElement.setAttribute('data-theme', theme);","  document.documentElement.setAttribute('data-density', density);","  document.documentElement.setAttribute('data-font-size', fontSize);","  document.documentElement.setAttribute('data-motion', motion);","})();"),l.join(`
`)}var u=ye();$("14640p0",i=>{var d=A(),g=p(d);{var l=y=>{var T=ge();x(p(T)),f(y,T)};M(g,y=>{o()&&typeof window>"u"&&y(l)})}f(i,d)});var v=E(u);X(v,()=>e.children),L(u),f(s,u),W()}let Y=s=>s,k={},F={addEventListener(){},removeEventListener(){}};function we(){try{return typeof localStorage<"u"}catch{return!1}}we()&&(k=localStorage);let Se={addEventListener(s,e,t){window.addEventListener("storage",e),window.addEventListener("pageshow",t)},removeEventListener(s,e,t){window.removeEventListener("storage",e),window.removeEventListener("pageshow",t)}};typeof window<"u"&&(F=Se);function _e(s,e=void 0,t={}){let r=t.encode||Y,o=t.decode||Y,n=te(e),c=n.set;n.set=i=>{let d=r(i);typeof d>"u"?delete k[s]:k[s]=d,c(i)};function u(i){i.key===s?i.newValue===null?c(e):c(o(i.newValue)):k[s]||c(e)}function v(){n.set(k[s]?o(k[s]):e)}return le(n,()=>{if(v(),t.listen!==!1)return F.addEventListener(s,u,v),()=>{F.removeEventListener(s,u,v)}}),n}const ke={primary:"#2563eb",primaryLight:"#3b82f6",primaryDark:"#1d4ed8",accent1:"#8b5cf6",accent2:"#ec4899",background:"#ffffff",backgroundAlt:"#fafafa",surface:"#f3f4f6",surfaceHover:"#e5e7eb",border:"#d1d5db",borderHover:"#9ca3af",text:"#111827",textMuted:"#6b7280",textInverse:"#ffffff",success:"#10b981",warning:"#f59e0b",error:"#ef4444",info:"#3b82f6",boost:"#8b5cf6",favorite:"#ec4899"},xe={primary:"#3b82f6",primaryLight:"#60a5fa",primaryDark:"#2563eb",accent1:"#a78bfa",accent2:"#f472b6",background:"#0f0f0f",backgroundAlt:"#0a0a0a",surface:"#1a1a1a",surfaceHover:"#262626",border:"#333333",borderHover:"#4d4d4d",text:"#f3f4f6",textMuted:"#9ca3af",textInverse:"#111827",success:"#34d399",warning:"#fbbf24",error:"#f87171",info:"#60a5fa",boost:"#a78bfa",favorite:"#f472b6"},Pe={primary:"#0000ff",primaryLight:"#3333ff",primaryDark:"#000099",accent1:"#ff00ff",accent2:"#ff0000",background:"#ffffff",backgroundAlt:"#f0f0f0",surface:"#e0e0e0",surfaceHover:"#d0d0d0",border:"#000000",borderHover:"#333333",text:"#000000",textMuted:"#333333",textInverse:"#ffffff",success:"#008000",warning:"#ff8c00",error:"#ff0000",info:"#0000ff",boost:"#ff00ff",favorite:"#ff0000"},Ee={primary:"#00ffff",primaryLight:"#66ffff",primaryDark:"#00cccc",accent1:"#ffff00",accent2:"#ff00ff",background:"#000000",backgroundAlt:"#0a0a0a",surface:"#1a1a1a",surfaceHover:"#2a2a2a",border:"#ffffff",borderHover:"#cccccc",text:"#ffffff",textMuted:"#cccccc",textInverse:"#000000",success:"#00ff00",warning:"#ffaa00",error:"#ff3333",info:"#00ccff",boost:"#ffff00",favorite:"#ff00ff"},Le=_e("theme-state",{mode:"system",preset:"default",customThemes:[],activeCustomThemeId:void 0},{encode:JSON.stringify,decode:JSON.parse}),G=te("light");if(typeof window<"u"){const s=window.matchMedia("(prefers-color-scheme: dark)");G.set(s.matches?"dark":"light"),s.addEventListener("change",e=>{G.set(e.matches?"dark":"light")})}const R=ue([Le,G],(s,e)=>{const t=s.mode==="dark"||s.mode==="system"&&e==="dark";if(s.preset==="custom"&&s.activeCustomThemeId){const r=s.customThemes.find(o=>o.id===s.activeCustomThemeId);if(r)return r.colors}return s.preset==="high-contrast"?t?Ee:Pe:t?xe:ke});function J(s){if(typeof document>"u")return;const e=document.documentElement;Object.entries(s).forEach(([t,r])=>{if(r){const o=t.replace(/([A-Z])/g,"-$1").toLowerCase();e.style.setProperty(`--color-${o}`,r)}}),e.style.setProperty("--color-shadow",s.text+"20"),e.style.setProperty("--color-overlay",s.background+"cc")}typeof window<"u"&&R.subscribe(s=>{J(s)});function Me(s,e){Q(e,!0),ee(()=>{const t=R.get();return J(t),R.subscribe(o=>{J(o)})}),W()}class Oe{dbName="greater-offline";version=1;db=null;async open(){return this.db?this.db:new Promise((e,t)=>{const r=indexedDB.open(this.dbName,this.version);r.onerror=()=>t(r.error),r.onsuccess=()=>{this.db=r.result,e(r.result)},r.onupgradeneeded=o=>{const n=o.target.result;n.objectStoreNames.contains("offline-posts")||n.createObjectStore("offline-posts",{keyPath:"id"})}})}async savePost(e){await(await this.open()).transaction("offline-posts","readwrite").objectStore("offline-posts").put(e)}async deletePost(e){await(await this.open()).transaction("offline-posts","readwrite").objectStore("offline-posts").delete(e)}async getAllPosts(){const t=(await this.open()).transaction("offline-posts","readonly");return new Promise((r,o)=>{const n=t.objectStore("offline-posts").getAll();n.onsuccess=()=>r(n.result),n.onerror=()=>o(n.error)})}}class Te{#e=O(V([]));get posts(){return a(this.#e)}set posts(e){h(this.#e,e,!0)}#t=O(V(typeof navigator<"u"?navigator.onLine:!0));get isOnline(){return a(this.#t)}set isOnline(e){h(this.#t,e,!0)}#s=O(!1);get isSyncing(){return a(this.#s)}set isSyncing(e){h(this.#s,e,!0)}offlineDB=new Oe;constructor(){}initialize(){if(typeof window>"u")return;const e=localStorage.getItem("offline-queue");if(e)try{const t=JSON.parse(e);t.state&&(this.posts=t.state.posts||[])}catch(t){console.error("Failed to load offline state:",t)}window.addEventListener("online",()=>{this.setOnlineStatus(!0)}),window.addEventListener("offline",()=>{this.setOnlineStatus(!1)}),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",t=>{t.data.type==="sync-complete"&&this.removePost(t.data.postId)}),this.offlineDB.getAllPosts().then(t=>{this.posts=t}).catch(console.error)}persist(){if(typeof window>"u")return;const e={state:{posts:this.posts}};localStorage.setItem("offline-queue",JSON.stringify(e))}addPost(e){const t=`offline-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,r={id:t,data:e,timestamp:Date.now(),retries:0};return this.posts=[...this.posts,r],this.offlineDB.savePost(r).catch(console.error),"serviceWorker"in navigator&&"SyncManager"in window&&navigator.serviceWorker.ready.then(o=>{o.sync?.register("sync-posts").catch(console.error)}),t}removePost(e){this.posts=this.posts.filter(t=>t.id!==e),this.offlineDB.deletePost(e).catch(console.error)}updatePost(e,t){this.posts=this.posts.map(r=>r.id===e?{...r,...t}:r)}setOnlineStatus(e){this.isOnline=e,e&&this.posts.length>0&&this.syncPosts()}async syncPosts(){if(!(!this.isOnline||this.posts.length===0||this.isSyncing)){this.isSyncing=!0;try{const e=await he();for(const t of this.posts)try{const r=Ce(t.data);await e.createNote(r),this.removePost(t.id)}catch(r){this.updatePost(t.id,{retries:t.retries+1,error:r instanceof Error?r.message:"Failed to sync"}),t.retries>=3&&this.removePost(t.id)}}finally{this.isSyncing=!1}}}clearQueue(){const e=this.posts;this.posts=[],e.forEach(t=>{this.offlineDB.deletePost(t.id).catch(console.error)})}}const b=new Te;function Ce(s){const e={content:s.status??"",visibility:Ie(s.visibility??"public"),sensitive:s.sensitive??!1};return s.spoiler_text&&(e.summary=s.spoiler_text),s.in_reply_to_id&&(e.inReplyToId=s.in_reply_to_id),s.media_ids?.length&&(e.mediaIds=[...s.media_ids]),s.poll&&(e.poll={options:[...s.poll.options],expiresIn:s.poll.expires_in,multiple:s.poll.multiple??!1,hideTotals:s.poll.hide_totals??!1}),s.language&&(e.language=s.language),e}function Ie(s){return{public:"PUBLIC",unlisted:"UNLISTED",private:"FOLLOWERS",direct:"DIRECT"}[s]??"PUBLIC"}var De=m(`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 1l22 22M9 9v.01M15 9a6 6 0 0 1 4.24 10.24M7.83 7.83A6 6 0 0 0 12 18c1.46 0 2.8-.52 3.84-1.39M5 12h.01M19 12a7 7 0 0 0-7-7M12 19v.01"></path></svg> <span>You're offline. Posts will be sent when connection is restored.</span>`,1),Ae=m('<svg class="spinner svelte-19iy7d1" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg> <span> </span>',1),Be=m('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path></svg> <span> </span>',1),He=m('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"></path></svg> <span>Back online!</span>',1),Ne=m('<div><div class="banner-content svelte-19iy7d1"><!></div> <button class="dismiss-btn svelte-19iy7d1" aria-label="Dismiss"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div>');function je(s,e){Q(e,!0);const t=Z(()=>b.posts.length);let r=O(!1),o=O(!1);q(()=>{!b.isOnline&&!a(o)?(h(r,!0),h(o,!0)):b.isOnline&&a(o)&&(a(t)>0?(h(r,!0),setTimeout(()=>{b.posts.length===0&&h(r,!1)},3e3)):h(r,!1),h(o,!1))});function n(){h(r,!1)}var c=A(),u=p(c);{var v=i=>{var d=Ne(),g=E(d),l=E(g);{var y=w=>{var C=De();z(2),f(w,C)},T=w=>{var C=A(),re=p(C);{var oe=S=>{var P=Ae(),I=x(p(P),2),B=E(I);L(I),H(()=>U(B,`Syncing ${a(t)??""} queued ${a(t)===1?"post":"posts"}...`)),f(S,P)},ne=S=>{var P=A(),I=p(P);{var B=_=>{var D=Be(),K=x(p(D),2),ae=E(K);L(K),H(()=>U(ae,`${a(t)??""} ${a(t)===1?"post":"posts"} queued`)),f(_,D)},ie=_=>{var D=He();z(2),f(_,D)};M(I,_=>{a(t)>0?_(B):_(ie,!1)},!0)}f(S,P)};M(re,S=>{b.isSyncing?S(oe):S(ne,!1)},!0)}f(w,C)};M(l,w=>{b.isOnline?w(T,!1):w(y)})}L(g);var se=x(g,2);se.__click=n,L(d),H(()=>de(d,1,`offline-banner ${b.isOnline?"online":"offline"}`,"svelte-19iy7d1")),f(i,d)};M(u,i=>{a(r)&&i(v)})}f(s,c),W()}ce(["click"]);var qe=m('<meta name="viewport" content="width=device-width, initial-scale=1.0"/> <meta name="description" content="A modern, high-performance web client for Mastodon-compatible instances"/>',1),ze=m("<!> <!> <!>",1);function Ze(s,e){$("12qhfyh",t=>{var r=qe();z(2),f(t,r)}),be(s,{children:(t,r)=>{var o=ze(),n=p(o);Me(n,{});var c=x(n,2);je(c,{});var u=x(c,2);X(u,()=>e.children),f(t,o)},$$slots:{default:!0}})}export{Ze as component,Ye as universal};
