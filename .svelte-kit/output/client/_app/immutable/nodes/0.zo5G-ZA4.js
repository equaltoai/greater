import{c as U,l as K,e as pe,d as R,b as f,a as w,f as _,s as ee}from"../chunks/LQvIjRXQ.js";import{M as V,U as ve,O as Y,S as d,T as L,X as I,aj as te,g as i,Z as c,W as l,Y as b,a2 as he,ay as ge,a0 as T,N as g,P as $,Q as H,R as M,a1 as G,_ as Q}from"../chunks/DIpZa-rG.js";import{w as me,s as ye}from"../chunks/DSqW2YpI.js";import{l as be,h as we}from"../chunks/DLudcOmY.js";import{s as _e,a as ke}from"../chunks/rm3Wd_Ll.js";import"../chunks/DQIc1P_2.js";import{a as re,o as Se,c as xe,g as Oe}from"../chunks/D3HftPX2.js";import{i as N}from"../chunks/sirv-2-2.js";const Te=!1,Pe=!1,Le=!0,st=Object.freeze(Object.defineProperty({__proto__:null,csr:Le,prerender:Pe,ssr:Te},Symbol.toStringTag,{value:"Module"}));let se=t=>t,P={},W={addEventListener(){},removeEventListener(){}};function Ee(){try{return typeof localStorage<"u"}catch{return!1}}Ee()&&(P=localStorage);let Ie={addEventListener(t,e,s){window.addEventListener("storage",e),window.addEventListener("pageshow",s)},removeEventListener(t,e,s){window.removeEventListener("storage",e),window.removeEventListener("pageshow",s)}};typeof window<"u"&&(W=Ie);function Me(t,e=void 0,s={}){let r=s.encode||se,o=s.decode||se,n=re(e),u=n.set;n.set=h=>{let k=r(h);typeof k>"u"?delete P[t]:P[t]=k,u(h)};function v(h){h.key===t?h.newValue===null?u(e):u(o(h.newValue)):P[t]||u(e)}function m(){n.set(P[t]?o(P[t]):e)}return Se(n,()=>{if(m(),s.listen!==!1)return W.addEventListener(t,v,m),()=>{W.removeEventListener(t,v,m)}}),n}const De={primary:"#2563eb",primaryLight:"#3b82f6",primaryDark:"#1d4ed8",accent1:"#8b5cf6",accent2:"#ec4899",background:"#ffffff",backgroundAlt:"#fafafa",surface:"#f3f4f6",surfaceHover:"#e5e7eb",border:"#d1d5db",borderHover:"#9ca3af",text:"#111827",textMuted:"#6b7280",textInverse:"#ffffff",success:"#10b981",warning:"#f59e0b",error:"#ef4444",info:"#3b82f6",boost:"#8b5cf6",favorite:"#ec4899"},Ae={primary:"#3b82f6",primaryLight:"#60a5fa",primaryDark:"#2563eb",accent1:"#a78bfa",accent2:"#f472b6",background:"#0f0f0f",backgroundAlt:"#0a0a0a",surface:"#1a1a1a",surfaceHover:"#262626",border:"#333333",borderHover:"#4d4d4d",text:"#f3f4f6",textMuted:"#9ca3af",textInverse:"#111827",success:"#34d399",warning:"#fbbf24",error:"#f87171",info:"#60a5fa",boost:"#a78bfa",favorite:"#f472b6"},Be={primary:"#0000ff",primaryLight:"#3333ff",primaryDark:"#000099",accent1:"#ff00ff",accent2:"#ff0000",background:"#ffffff",backgroundAlt:"#f0f0f0",surface:"#e0e0e0",surfaceHover:"#d0d0d0",border:"#000000",borderHover:"#333333",text:"#000000",textMuted:"#333333",textInverse:"#ffffff",success:"#008000",warning:"#ff8c00",error:"#ff0000",info:"#0000ff",boost:"#ff00ff",favorite:"#ff0000"},Ce={primary:"#00ffff",primaryLight:"#66ffff",primaryDark:"#00cccc",accent1:"#ffff00",accent2:"#ff00ff",background:"#000000",backgroundAlt:"#0a0a0a",surface:"#1a1a1a",surfaceHover:"#2a2a2a",border:"#ffffff",borderHover:"#cccccc",text:"#ffffff",textMuted:"#cccccc",textInverse:"#000000",success:"#00ff00",warning:"#ffaa00",error:"#ff3333",info:"#00ccff",boost:"#ffff00",favorite:"#ff00ff"},$e=Me("theme-state",{mode:"system",preset:"default",customThemes:[],activeCustomThemeId:void 0},{encode:JSON.stringify,decode:JSON.parse}),z=re("light");if(typeof window<"u"){const t=window.matchMedia("(prefers-color-scheme: dark)");z.set(t.matches?"dark":"light"),t.addEventListener("change",e=>{z.set(e.matches?"dark":"light")})}const F=xe([$e,z],(t,e)=>{const s=t.mode==="dark"||t.mode==="system"&&e==="dark";if(t.preset==="custom"&&t.activeCustomThemeId){const r=t.customThemes.find(o=>o.id===t.activeCustomThemeId);if(r)return r.colors}return t.preset==="high-contrast"?s?Ce:Be:s?Ae:De});function J(t){if(typeof document>"u")return;const e=document.documentElement;Object.entries(t).forEach(([s,r])=>{if(r){const o=s.replace(/([A-Z])/g,"-$1").toLowerCase();e.style.setProperty(`--color-${o}`,r)}}),e.style.setProperty("--color-shadow",t.text+"20"),e.style.setProperty("--color-overlay",t.background+"cc")}typeof window<"u"&&F.subscribe(t=>{J(t)});Z[d]="src/lib/components/islands/svelte/ThemeInitializer.svelte";function Z(t,e){U(new.target),V(e,!0,Z),ve(()=>{const r=F.get();return J(r),F.subscribe(n=>{J(n)})});var s={...K()};return Y(s)}class He{dbName="greater-offline";version=1;db=null;async open(){return this.db?this.db:new Promise((e,s)=>{const r=indexedDB.open(this.dbName,this.version);r.onerror=()=>s(r.error),r.onsuccess=()=>{this.db=r.result,e(r.result)},r.onupgradeneeded=o=>{const n=o.target.result;n.objectStoreNames.contains("offline-posts")||n.createObjectStore("offline-posts",{keyPath:"id"})}})}async savePost(e){const r=(await b(this.open()))().transaction("offline-posts","readwrite");(await b(r.objectStore("offline-posts").put(e)))()}async deletePost(e){const r=(await b(this.open()))().transaction("offline-posts","readwrite");(await b(r.objectStore("offline-posts").delete(e)))()}async getAllPosts(){const s=(await b(this.open()))().transaction("offline-posts","readonly");return new Promise((r,o)=>{const n=s.objectStore("offline-posts").getAll();n.onsuccess=()=>r(n.result),n.onerror=()=>o(n.error)})}}class Ne{#e=L(I(te([])),"OfflineStore.posts");get posts(){return i(this.#e)}set posts(e){c(this.#e,e,!0)}#t=L(I(te(l(typeof navigator,"undefined",!1)?navigator.onLine:!0)),"OfflineStore.isOnline");get isOnline(){return i(this.#t)}set isOnline(e){c(this.#t,e,!0)}#s=L(I(!1),"OfflineStore.isSyncing");get isSyncing(){return i(this.#s)}set isSyncing(e){c(this.#s,e,!0)}offlineDB=new He;constructor(){}initialize(){if(l(typeof window,"undefined"))return;const e=localStorage.getItem("offline-queue");if(e)try{const s=JSON.parse(e);s.state&&(this.posts=s.state.posts||[])}catch(s){console.error(...be("error","Failed to load offline state:",s))}window.addEventListener("online",()=>{this.setOnlineStatus(!0)}),window.addEventListener("offline",()=>{this.setOnlineStatus(!1)}),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",s=>{l(s.data.type,"sync-complete")&&this.removePost(s.data.postId)}),this.offlineDB.getAllPosts().then(s=>{this.posts=s}).catch(console.error)}persist(){if(l(typeof window,"undefined"))return;const e={state:{posts:this.posts}};localStorage.setItem("offline-queue",JSON.stringify(e))}addPost(e){const s=`offline-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,r={id:s,data:e,timestamp:Date.now(),retries:0};return this.posts=[...this.posts,r],this.offlineDB.savePost(r).catch(console.error),"serviceWorker"in navigator&&"SyncManager"in window&&navigator.serviceWorker.ready.then(o=>{o.sync?.register("sync-posts").catch(console.error)}),s}removePost(e){this.posts=this.posts.filter(s=>l(s.id,e,!1)),this.offlineDB.deletePost(e).catch(console.error)}updatePost(e,s){this.posts=this.posts.map(r=>l(r.id,e)?{...r,...s}:r)}setOnlineStatus(e){this.isOnline=e,e&&this.posts.length>0&&this.syncPosts()}async syncPosts(){if(!(!this.isOnline||l(this.posts.length,0)||this.isSyncing)){this.isSyncing=!0;try{const e=(await b(Oe()))();for(const s of this.posts)try{const r=qe(s.data);(await b(e.createNote(r)))(),this.removePost(s.id)}catch(r){this.updatePost(s.id,{retries:s.retries+1,error:r instanceof Error?r.message:"Failed to sync"}),s.retries>=3&&this.removePost(s.id)}}finally{this.isSyncing=!1}}}clearQueue(){const e=this.posts;this.posts=[],e.forEach(s=>{this.offlineDB.deletePost(s.id).catch(console.error)})}}const y=new Ne;function qe(t){const e={content:t.status??"",visibility:je(t.visibility??"public"),sensitive:t.sensitive??!1};return t.spoiler_text&&(e.summary=t.spoiler_text),t.in_reply_to_id&&(e.inReplyToId=t.in_reply_to_id),t.media_ids?.length&&(e.mediaIds=[...t.media_ids]),t.poll&&(e.poll={options:[...t.poll.options],expiresIn:t.poll.expires_in,multiple:t.poll.multiple??!1,hideTotals:t.poll.hide_totals??!1}),t.language&&(e.language=t.language),e}function je(t){return{public:"PUBLIC",unlisted:"UNLISTED",private:"FOLLOWERS",direct:"DIRECT"}[t]??"PUBLIC"}a[d]="src/lib/components/islands/svelte/OfflineIndicator.svelte";var Re=w(_(`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 1l22 22M9 9v.01M15 9a6 6 0 0 1 4.24 10.24M7.83 7.83A6 6 0 0 0 12 18c1.46 0 2.8-.52 3.84-1.39M5 12h.01M19 12a7 7 0 0 0-7-7M12 19v.01"></path></svg> <span>You're offline. Posts will be sent when connection is restored.</span>`,1),a[d],[[41,8,[[42,10]]],[44,8]]),Ge=w(_('<svg class="spinner svelte-19iy7d1" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg> <span> </span>',1),a[d],[[46,8,[[47,10]]],[49,8]]),Qe=w(_('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path></svg> <span> </span>',1),a[d],[[51,8,[[52,10],[53,10]]],[55,8]]),We=w(_('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"></path></svg> <span>Back online!</span>',1),a[d],[[57,8,[[58,10]]],[60,8]]),ze=w(_('<div><div class="banner-content svelte-19iy7d1"><!></div> <button class="dismiss-btn svelte-19iy7d1" aria-label="Dismiss"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div>'),a[d],[[38,2,[[39,4],[64,4,[[65,6,[[66,8],[67,8]]]]]]]]);function a(t,e){U(new.target),V(e,!0,a);const s=L(he(()=>y.posts.length),"queuedCount");let r=L(I(!1),"showBanner"),o=L(I(!1),"wasOffline");ge(()=>{!y.isOnline&&!i(o)?(c(r,!0),c(o,!0)):y.isOnline&&i(o)&&(i(s)>0?(c(r,!0),setTimeout(()=>{l(y.posts.length,0)&&c(r,!1)},3e3)):c(r,!1),c(o,!1))});function n(){c(r,!1)}var u={...K()},v=R(),m=T(v);{var h=k=>{var D=ze(),q=$(D),oe=$(q);{var ne=S=>{var A=Re();Q(2),f(S,A)},ie=S=>{var A=R(),fe=T(A);{var ce=x=>{var E=Ge(),B=M(T(E),2),j=$(B);H(B),G(()=>ee(j,`Syncing ${i(s)??""} queued ${l(i(s),1)?"post":"posts"}...`)),f(x,E)},le=x=>{var E=R(),B=T(E);{var j=O=>{var C=Qe(),X=M(T(C),2),ue=$(X);H(X),G(()=>ee(ue,`${i(s)??""} ${l(i(s),1)?"post":"posts"} queued`)),f(O,C)},de=O=>{var C=We();Q(2),f(O,C)};g(()=>N(B,O=>{i(s)>0?O(j):O(de,!1)},!0),"if",a,50,6)}f(x,E)};g(()=>N(fe,x=>{y.isSyncing?x(ce):x(le,!1)},!0),"if",a,45,6)}f(S,A)};g(()=>N(oe,S=>{y.isOnline?S(ie,!1):S(ne)}),"if",a,40,6)}H(q);var ae=M(q,2);ae.__click=n,H(D),G(()=>_e(D,1,`offline-banner ${y.isOnline?"online":"offline"}`,"svelte-19iy7d1")),f(k,D)};g(()=>N(m,k=>{i(r)&&k(h)}),"if",a,37,0)}return f(t,v),Y(u)}pe(["click"]);p[d]="src/routes/+layout.svelte";var Fe=w(_('<meta name="viewport" content="width=device-width, initial-scale=1.0"/> <meta name="description" content="A modern, high-performance web client for Mastodon-compatible instances"/>',1),p[d],[[21,2],[22,2]]),Je=w(_("<!> <!> <!>",1),p[d],[]);function p(t,e){U(new.target),V(e,!0,p);var s={...K()};return we("12qhfyh",r=>{var o=Fe();Q(2),f(r,o)}),g(()=>ke(t,{children:me(p,(r,o)=>{var n=Je(),u=T(n);g(()=>Z(u,{}),"component",p,26,2,{componentTag:"ThemeInitializer"});var v=M(u,2);g(()=>a(v,{}),"component",p,27,2,{componentTag:"OfflineIndicator"});var m=M(v,2);g(()=>ye(m,()=>e.children),"render",p,28,2),f(r,n)}),$$slots:{default:!0}}),"component",p,25,0,{componentTag:"ThemeProvider"}),Y(s)}export{p as component,st as universal};
