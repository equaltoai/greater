"use strict";(globalThis.webpackChunk_github_ui_github_ui=globalThis.webpackChunk_github_ui_github_ui||[]).push([["packages_diff-lines_diff-lines_ts"],{2265:(e,t,i)=>{i.d(t,{W:()=>o,j:()=>s});var n=i(74848),r=i(96540);let a=(0,r.createContext)({});function s({children:e}){let[t,i]=(0,r.useState)(!1),s=(0,r.useMemo)(()=>({isDialogOpen:t,setIsDialogOpen:i}),[t,i]);return(0,n.jsx)(a.Provider,{value:s,children:e})}let o=()=>(0,r.useContext)(a);try{a.displayName||(a.displayName="DialogStateContext")}catch{}try{s.displayName||(s.displayName="DialogStateProvider")}catch{}},3038:(e,t,i)=>{i.d(t,{Av:()=>D,Ji:()=>h,Ls:()=>N,Mk:()=>v,Po:()=>m,S4:()=>y,Yf:()=>j,a1:()=>S,a2:()=>l,dT:()=>w,dv:()=>p,j2:()=>x,oH:()=>d,qK:()=>f,qX:()=>c,u6:()=>u,x_:()=>g});var n=i(13083),r=i(61583),a=i(66358),s=i(36729),o=i(51391);function l(e,t,i){return"left"===i?!m(e)&&e.left===t:!m(e)&&(0,n.XU)(e.type)===i&&e.right===t}function d(e,t){return"LEFT"===t?`L${e}`:`R${e}`}function c(e,t,i){let n=`-${m(t)||"number"!=typeof t.left?"empty":t.left}`,r=i?`-${m(i)||"number"!=typeof i.right?"empty":i.right}`:"";return`${e}${n}${r}`}function u(e,t){return`${e}-${t}`}function m(e){return!!e&&e===s.Vv}function f(e){return!!e&&e!==s.Vv}function h(e){return"CONTEXT"===e.type}function p(e,t){return t===a.w$.Empty||t===a.w$.Hunk?[e,void 0]:b(e,a.JF[t])}function g(e,t){let i;switch(t){case a.w$.Addition:i=a.JF[a.w$.Addition];break;case a.w$.Deletion:i=a.JF[a.w$.Deletion];break;case a.w$.Context:case a.w$.InjectedContext:i=a.JF[a.w$.Context]}return b(e,i)}function b(e,t){if(!t||!e.startsWith(t))return[e,void 0];let i=e[0];return[e.substring(1),i]}function v(e){let t=[],i=[],n=()=>{for(;t.length<i.length;)t.push(s.Vv);for(;i.length<t.length;)i.push(s.Vv)};for(let r of e)switch(r.type){case"ADDITION":i.push(r);break;case"DELETION":t.push(r);break;case"CONTEXT":case"INJECTED_CONTEXT":case"HUNK":n(),t.push(r),i.push(r)}return n(),{leftLines:t,rightLines:i}}function C(e){return["HUNK","CONTEXT","INJECTED_CONTEXT","DELETION"].includes(e.type)}function x({line:e,range:t,fileAnchor:i}){let n,{origin:a,pathname:s}=window.location;if(e){let a=C(e)?e.left:e.right;n=t&&a&&t.startLineNumber<=a&&t.endLineNumber>=a?(0,r.j$)(t):function(e,t){let i=C(e),n=i?e.left:e.right,a=i?"left":"right";if(null!==n)return(0,r.j$)({diffAnchor:t,endLineNumber:n,endOrientation:a,startLineNumber:n,startOrientation:a})}(e,i)}else t&&(n=(0,r.j$)(t));if(n)return`${a}${s}#${n}`}function y({hasThreads:e}){return e?"80px":"24px"}let L=["ADDITION","DELETION","CONTEXT"],S=(e,t)=>{if(m(e)||!e)return!1;let i=t.leftLines.concat(t.rightLines),n=i.filter(e=>!m(e)).map(e=>(0,o.bo)(e)),r=(0,o.bo)(e);return i.length>0&&n.includes(r)?i.every(e=>!!m(e)||L.includes(e.type)):!!m(e)||L.includes(e.type)},N=e=>e?e.filter(e=>!m(e)).map(e=>{var t;let[i]=g((t=e.html,new DOMParser().parseFromString(t,"text/html").documentElement.textContent||""),e.type);return i}).join(`
`):"";function w(e){return!!(e.text.length<1&&("CONTEXT"===e.type||"INJECTED_CONTEXT"===e.type)||("DELETION"===e.type||"ADDITION"===e.type)&&1===e.text.length&&["+","-"].includes(e.text.charAt(0)))}let D=(e,t,i,n)=>{let r;if(e)return e;if(!m(t)){let e=(i?t.left:t.right)??0,a=i?"left":"right";r={startOrientation:a,endOrientation:a,startLineNumber:e,endLineNumber:e,diffAnchor:n}}return r};function j(e,t=!1,i=!1){let n;switch(e){case"ADDITION":n=t?"var(--diffBlob-additionNum-bgColor, var(--diffBlob-addition-bgColor-num))":"var(--diffBlob-additionLine-bgColor, var(--diffBlob-addition-bgColor-line))";break;case"DELETION":n=t?"var(--diffBlob-deletionNum-bgColor, var(--diffBlob-deletion-bgColor-num))":"var(--diffBlob-deletionLine-bgColor, var(--diffBlob-deletion-bgColor-line))";break;case"HUNK":n=t?"var(--diffBlob-hunkNum-bgColor-rest, var(--diffBlob-hunk-bgColor-num))":"var(--diffBlob-hunkLine-bgColor, var(--bgColor-accent-muted))";break;case"EMPTY":n=t?"var(--diffBlob-emptyNum-bgColor, var(--diffBlob-hunk-bgColor-num))":"var(--diffBlob-emptyLine-bgColor, var(--bgColor-accent-muted))";break;default:n="var(--bgColor-default)"}return i?"":n}},3252:(e,t,i)=>{function n(e){return[...e.querySelectorAll(".js-blob-code-addition")].map(e=>e.textContent).filter(e=>null!==e)}function r(e){if(!e||e.length>1e5)return null;let t=e.split(/\r?\n/),i=!1,n="",r=[];for(let e=0;e<t.length;e++){let a=t[e];if(void 0!==a)if(i){if(a.match(/^ {0,3}(`{3,}|~{3,})[ \t]*$/))return r;let e=a;if(n.length>0){let t=RegExp(`^ {0,${n.length}}`);e=a.replace(t,"")}r.push(e)}else{let e=a.match(/^( {0,3})(`{3,}|~{3,})suggestion[ \t]*$/);if(e){i=!0,n=e[1]||"";continue}}}return null}i.d(t,{T:()=>r,y:()=>n})},5981:(e,t,i)=>{i.d(t,{v:()=>E,n:()=>A});var n=i(74848),r=i(96540),a=i(71323),s=i(97283),o=i(87134),l=i(1932),d=i(21132),c=i(15697);function u({diffSummaries:e,loadedPathDigests:t,loadingPathDigests:i,selectedPathDigest:n}){let r=!0,a=Object.values(e),s=a.findIndex(e=>e.pathDigest===n);return a.map(({path:e,pathDigest:n},a)=>{let o,l;switch(!0){case t.has(n):o=d.s.Loaded;break;case i.has(n):o=d.s.Loading;break;default:o=d.s.NotLoaded}let c=!1;return o===d.s.Loaded?(l="RENDER",c=!1):(a===s?(l="EAGER_AUTO_LOAD",c=!0):(l=a<s?"LAZY_AUTO_LOAD":a===s+1?"EAGER_AUTO_LOAD":r?"EAGER_AUTO_LOAD":"HIDE",c=!1),r&&"LAZY_AUTO_LOAD"!==l&&(r=!1)),{path:e,pathDigest:n,loadingStatus:o,renderMode:l,loadSolo:c}})}var m=i(70170),f=i(91747),h=i(61583),p=i(79472),g=i(45270),b=i(43362),v=i(48845),C=i(20622),x=i(96379),y=i(16235),L=i(69599);function S({basePath:e,selectedRange:t,hideWhitespace:i}){return[C.u.diffEntries,e,`baseOid:${t.baseOid}`,`headOid:${t.headOid}`,`hideWhitespace:${i}`]}async function N(e){let t=(0,y.S)(),i=S(e),n=await D(e);return n&&n.length>0&&t.setQueryData(i,(0,l.jM)(e=>{if(!e)return n;for(let t of n)e.find(e=>e.pathDigest===t.pathDigest)||e.push(t)})),n}async function w(e){let t,i=(0,y.S)(),n=S(e),r=i.getQueryData(n);if(r?.length){let i=new Set(r.map(e=>e.path));if(0===(t=e.paths.filter(e=>!i.has(e))).length)return r}else t=e.paths;let a=await D({...e,paths:t});return a&&a.length>0&&i.setQueryData(n,(0,l.jM)(e=>{if(!e)return a;for(let t of a)e.find(e=>e.pathDigest===t.pathDigest)||e.push(t)})),(i.getQueryData(n)||[]).filter(t=>e.paths.includes(t.path))}async function D({basePath:e,fullDiff:t,selectedRange:i,paths:n,contextRanges:r,signal:a,hideWhitespace:s}){let o=new URLSearchParams;if(o.append("paths",n.join(",")),r){let e=n.map(e=>(r[e]??[]).map(([e,t])=>`${e}-${t}`).join(",")).join(":");o.append("ctx",e)}o.append("w",s?"1":"0"),i.baseOid===t.baseOid?o.append("range",i.headOid):o.append("range",`${i.baseOid}..${i.headOid}`);let l=`${e}/page_data/${C.u.diffEntries}?${o.toString()}`;try{let e=await (0,x.Sr)(l,{signal:a});if(a?.aborted)return;let t=await (0,v.hp)(e);return(0,v.R)(e,t),t??void 0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}}function j(e,t,i,n){return[C.u.diffContextLines,e,t,i,n]}async function I({contextLineRanges:e,basePath:t,path:i,w:n="0",fullDiff:r,selectedRange:a}){let s=new URLSearchParams;for(let t of(s.append("path",i),e))s.append("context_line_ranges[]",JSON.stringify(t));s.append("w",n),a.baseOid===r.baseOid?s.append("range",a.headOid):s.append("range",`${a.baseOid}..${a.headOid}`);let o=`${t}/page_data/${C.u.diffContextLines}?${s.toString()}`,l=await (0,x.QJ)(o);if(l.ok)return await l.json()??void 0}var k=i(88008);let _=(0,r.createContext)(null);function A(e){let t=(0,r.useContext)(_);if(!t)throw Error("Missing PullRequestStoreProvider in the tree");return(0,a.P)(t,e)}let E=({initData:e,children:t})=>{let i=(0,r.useRef)(null),a=(0,f.u)("prx_files_lite_throttle"),s=(0,f.u)("prx_files_medium_throttle"),o=(0,p.Qn)(e.user.viewSettings.hideWhitespace),l=(0,g.Xv)(),d=(0,b.Wp)(e.diffSummaries),c=(0,b.Be)(e.diffSummaries),u=(0,b.wm)(e.viewerPendingReview),m=(0,b.Sl)(e.diffContents),v=(0,b.jH)(e.markers,e.diffSummaries),C=(0,k.Ol)(e.pullRequest.pathName,e.pullRequest.comparison.headOid);return i.current||(function(e,t,i,n,r,a){let s=(0,y.S)(),o=S({basePath:i,selectedRange:{baseOid:e??r.baseOid,headOid:t??r.headOid},hideWhitespace:a});s.setQueryData(o,n)}(l.startOid,l.endOid,e.pullRequest.pathName,e.diffContents,e.pullRequest.comparison,o),i.current=R({baseOid:e.pullRequest.comparison.baseOid,headOid:e.pullRequest.comparison.headOid,selectedCommitRange:{baseOid:l.startOid??void 0,headOid:l.endOid??void 0},changeGroupGeneration:e.changeGroupGeneration,hideWhitespace:o,isSingleFileMode:e.isSingleFileMode,collapsedFilesMap:c,initialSummariesViewedStatus:c,initialSummariesViewedCount:e.user.viewedFilesCount,diffEntries:m,initialDiffSummaries:d,initialLoadedPathDigests:new Set(e.diffContents.map(e=>e.pathDigest)),markers:v,basePath:e.pullRequest.pathName,pendingReview:u,prxFilesLiteThrottle:a,prxFilesMediumThrottle:s,pullRequest:e.pullRequest,selectedPathDigest:(0,h.jU)((0,h.o9)()),initialActiveBatch:C.length>0?C:void 0,showChangeGroupPreference:e.user.viewSettings.showChangeGroups})),(0,n.jsx)(_.Provider,{value:i.current,children:t})},R=e=>(0,s.y)()((0,o.lt)((...t)=>({...(({changeGroupGeneration:{canAccessChangeGroups:e,changeGroups:t,latestChangeGroupOrchestration:i,changeGroupGenerationChannel:n,unavailableReason:r},showChangeGroupPreference:a})=>s=>({changeGroupGeneration:{canAccessChangeGroups:e,changeGroups:t,latestChangeGroupOrchestration:i,changeGroupGenerationChannel:n,unavailableReason:r},showChangeGroupPreference:a,changeGroupGenerationActions:{updateChangeGroupGeneration:e=>s(t=>({changeGroupGeneration:{...t.changeGroupGeneration,...e},showChangeGroupPreference:t.showChangeGroupPreference}),void 0,"updateChangeGroupGeneration"),updateChangeGroupPreference:e=>s(t=>({changeGroupGeneration:t.changeGroupGeneration,showChangeGroupPreference:e}),void 0,"updateChangeGroupPreference")}}))(e)(...t),...((e,t)=>({codeowners:void 0,codeownersActions:{setCodeowners:t=>{e({codeowners:t},void 0,"updateCodeowners")}}}))(...t),...(({baseOid:e,headOid:t,selectedCommitRange:i,hideWhitespace:n})=>r=>({comparisonInfo:{fullDiff:{baseOid:e,headOid:t},selectedRange:{baseOid:i.baseOid??e,headOid:i.headOid??t},hideWhitespace:n},comparisonInfoActions:{updateWhitespace:e=>r(t=>({comparisonInfo:{...t.comparisonInfo,hideWhitespace:e}}),void 0,"comparisonInfo#updateWhitespace")}}))(e)(...t),...((e,t)=>({diffFilter:{state:{activeChangeGroupId:void 0,filterText:"",fileExtensions:{},unselectedFileExtensions:new Set,showDeletedFiles:!0,showOnlyManifestFiles:!1,showOnlyOwnedFiles:!1,showVendoredFiles:!0,showViewedFiles:!0},filtersInteractedWith:!1},diffFilterActions:{updateDiffFilter:(i,n)=>{e({diffFilter:{...t().diffFilter,state:{...t().diffFilter.state,...i},filtersInteractedWith:t().diffFilter.filtersInteractedWith||!!n}},void 0,"updateFilters")}}}))(...t),...(({initialDiffSummaries:e,initialSummariesViewedStatus:t,initialSummariesViewedCount:i})=>(n,r)=>({diffSummaries:e,summariesViewedCount:i,summariesViewedStatus:t,codeowners:void 0,getPathDigestFromThreadID:e=>{for(let t of Object.values(r().diffSummaries))if(t.markersMap){for(let[i,n]of Object.entries(t.markersMap))if(n.threads.some(t=>Number(t.id)===Number(e)))return t.pathDigest}},getPathDigestFromAnnotationID:e=>{for(let t of Object.values(r().diffSummaries))if(t.markersMap){for(let[i,n]of Object.entries(t.markersMap))if(n.annotations.some(t=>t.id===e))return t.pathDigest}},diffSummariesActions:{setDiffSummaries:e=>{n({diffSummaries:e},void 0,"updateDiffSummaries")},setDiffViewed:(e,t)=>{n(i=>i.diffSummaries?{summariesViewedStatus:(0,l.jM)(i.summariesViewedStatus,i=>{i[e]=t}),summariesViewedCount:i.summariesViewedCount+(t?1:-1),diffSummaries:(0,l.jM)(i.diffSummaries,i=>{i[e]&&(i[e].markedAsViewed=t)})}:i)},onCommentThreadAdded:({path:e,diffLineKey:t,startPosition:i,threadID:r})=>{n((0,l.jM)(n=>{if(!n.diffSummaries)return;let a=n.diffSummaries[e];if(!a)return;let s=a.markersMap??{};s[t]||(s[t]={threads:[],annotations:[]}),s[t].threads.push({id:parseInt(r),start:i}),a.totalCommentsCount=(a.totalCommentsCount||0)+1}),void 0,"commentAddedForDiffSummary")},onCommentThreadDeleted:({path:e,threadID:t})=>{n((0,l.jM)(i=>{if(!i.diffSummaries)return;let n=i.diffSummaries[e];if(n&&n?.totalCommentsCount&&n?.markersMap)for(let[e,i]of Object.entries(n.markersMap))i.threads=i.threads.filter(e=>e.id!==parseInt(t)),0===i.threads.length&&0===i.annotations.length&&delete n.markersMap[e]}),void 0,"commentDeletedForDiffSummary")}}}))(e)(...t),...(({markers:e})=>(t,i)=>({markers:e,getThread:(e,t,n)=>{let r=i().markers;if(r)return r[t]?.[n]?.threads?.find(t=>Number(t.id)===e)},getThreadFromCommentID:e=>{let t=i().markers;if(!t)return;let n=Object.values(t).flatMap(e=>Object.values(e).flatMap(e=>e?.threads??[]));if(n){for(let t of Object.values(n))if(t?.commentsData?.comments.some(t=>t.databaseId===e))return t}},getAnnotationFromID:e=>{let t=i().markers;if(!t)return;let n=Object.values(t).flatMap(e=>Object.values(e).flatMap(e=>e?.annotations??[]));if(n){for(let t of Object.values(n))if(t.databaseId===e)return t}},markersActions:{updateThread:(e,n,r,a)=>{let s=i().markers;if(!s)return;let o=a(s[n]?.[r]?.threads?.find(t=>Number(t.id)===e));o&&t({markers:(0,l.jM)(s,t=>{let i=t[n]?.[r]?.threads?.findIndex(t=>Number(t.id)===e);if(void 0===i||-1===i)t[n]||(t[n]={}),t[n][r]||(t[n][r]={threads:[],annotations:[]}),t[n][r].threads.push(o);else if(t[n]&&t[n][r]&&-1!==i){let e=o.positioning??t[n][r].threads[i]?.positioning,a=o.subject??t[n][r].threads[i]?.subject,s={...o,positioning:e,subject:a};t[n][r].threads[i]=s}})},void 0,"updateThread")},updateThreads:e=>{let n=i().markers;n&&t({markers:(0,l.jM)(n,t=>{for(let i of Object.keys(n)){let n=t[i];if(n)for(let t of Object.keys(n)){let i=n[t];if(!i)continue;let r=i.threads;r&&(i.threads=e(r))}}})})},deleteThreadComment:(e,n,r,a)=>{let s="not_found",o=i().markers;return o&&t({markers:(0,l.jM)(o,t=>{let i=t[r]?.[a]?.threads?.find(t=>Number(t.id)===e);if(!i){s="not_found";return}let o=i.commentsData,l=o?.comments.filter(e=>e.id!==n)??[];if(!o||o.comments.length===l.length){s="not_found";return}if(0===l.length){s="thread_deleted";let i=t[r]?.[a]?.threads;if(i){let t=i.findIndex(t=>Number(t.id)===e);-1!==t&&i.splice(t,1)}}else s="comment_deleted",o&&(o.comments=l)})},void 0,"deleteThreadComment"),s},updateThreadComment:({threadID:e,filePath:n,lineMarkersKey:r,match:a,transform:s})=>{let o=i().markers;o&&t({markers:(0,l.jM)(o,t=>{let i,o=t[n]?.[r]?.threads?.find(t=>Number(t.id)===e);if(!o)return;let l=o.commentsData,d=l?.comments.findIndex(a);"number"==typeof d&&-1!==d&&(i=l?.comments[d]);let c=s(i);c&&(-1===d||"number"!=typeof d?l?.comments.push(c):l&&l.comments&&(l.comments[d]=c))})},void 0,"updateThreadComment")}}}))(e)(...t),...(({prxFilesLiteThrottle:e,prxFilesMediumThrottle:t,initialDiffSummaries:i,initialLoadedPathDigests:n,selectedPathDigest:r})=>(a,s)=>{let o;return o=t?100:50*!!e,{entries:u({diffSummaries:i,loadedPathDigests:n,loadingPathDigests:new Set,selectedPathDigest:r}),selectedPathDigest:r,internalProgressiveDiffsActions:{loadSelectedEntries:(0,m.n)(async e=>{if(0===e.length)return;let t=e.map(e=>e.path),i=e.map(e=>e.pathDigest),n=s().entries.filter(e=>e.loadingStatus===d.s.Loaded).map(e=>e.pathDigest),r=s().entries.filter(e=>e.loadingStatus===d.s.Loading).map(e=>e.pathDigest);a(e=>({entries:u({diffSummaries:e.diffSummaries,loadedPathDigests:new Set(n),loadingPathDigests:new Set([...r,...i]),selectedPathDigest:e.selectedPathDigest})}),void 0,"loadSelectedEntries#preFetch");let{loadDiffEntries:o}=s().diffEntriesActions,l=(0,c.i)({paths:new Set(t),diffSummaries:s().diffSummaries}),m=await o({paths:t,contextRanges:l});if(!m||0===m.length){let e=[...s().entries.filter(e=>e.loadingStatus===d.s.Loaded).map(e=>e.pathDigest)],t=s().entries.filter(e=>e.loadingStatus===d.s.Loading).map(e=>e.pathDigest);return a({entries:u({diffSummaries:s().diffSummaries,loadedPathDigests:new Set(e),loadingPathDigests:new Set(t),selectedPathDigest:s().selectedPathDigest})},void 0,"loadSelectedEntries#postFetch#noAPIData")}let f=m.map(e=>e.pathDigest),h=[...s().entries.filter(e=>e.loadingStatus===d.s.Loaded).map(e=>e.pathDigest),...f],p=s().entries.filter(e=>e.loadingStatus===d.s.Loading).filter(e=>!f.includes(e.pathDigest)).map(e=>e.pathDigest);a(e=>({...e,entries:u({diffSummaries:s().diffSummaries,loadedPathDigests:new Set(h),loadingPathDigests:new Set(p),selectedPathDigest:s().selectedPathDigest})}),void 0,"loadSelectedEntries#postFetch")},o)},progressiveDiffsActions:{loadMore:async(e,{preferAnySoloEntry:t}={})=>{let i=function({progressiveDiffEntries:e,startingAt:t,preferAnySoloEntry:i}){if(i){let t=e.find(e=>e.loadSolo&&e.loadingStatus===d.s.NotLoaded);if(t)return[t]}let n=e.findIndex(e=>e.pathDigest===t.pathDigest);if(-1===n)return[];let r=e[n];if(r&&r.loadSolo&&r.loadingStatus===d.s.NotLoaded)return[r];let a=[];for(let t=n;t<e.length;t++){let i=e[t];if(!i||(i.loadingStatus===d.s.NotLoaded&&a.push(i),a.length>=4))break}return a}({progressiveDiffEntries:s().entries,startingAt:e,preferAnySoloEntry:t});return s().internalProgressiveDiffsActions.loadSelectedEntries(i)},updateSelectedPathDigest:e=>{a(t=>({...t,selectedPathDigest:e}));let t=s().entries.find(t=>t.pathDigest===e);if(t)return s().internalProgressiveDiffsActions.loadSelectedEntries([t])}}}})(e)(...t),...(({collapsedFilesMap:e})=>(t,i)=>({collapsedFilesMap:e,filesCollapsedStatusActions:{updateFileCollapsedStatus:(e,n)=>{let r=i().collapsedFilesMap;r&&t({collapsedFilesMap:(0,l.jM)(r,t=>{t[e]=n})},void 0,"updateFileCollapsedStatus")},updateAllFilesCollapsedStatus:e=>{let n=i().collapsedFilesMap;n&&t({collapsedFilesMap:(0,l.jM)(n,t=>{for(let i of Object.keys(t))t[i]=e})},void 0,"deleteThreadComment")}}}))(e)(...t),...(({pendingReview:e})=>(t,i)=>({pendingReview:e,pendingReviewActions:{addPendingComment:e=>{let n=i().pendingReview;n&&t({pendingReview:(0,l.jM)(n,t=>{t.pendingReviewIDs||(t.pendingReviewIDs=[]),t.pendingReviewIDs.push(e)})},void 0,"addPendingComment")},removePendingComment:e=>{let n=i().pendingReview;n&&t({pendingReview:(0,l.jM)(n,t=>{let i=t.pendingReviewIDs?.filter(t=>t!==e);t.pendingReviewIDs=i})},void 0,"removePendingComment")},clearPendingReview:()=>{let e=i().pendingReview;e&&t({pendingReview:(0,l.jM)(e,e=>{e.id=void 0,e.pendingReviewIDs=[],e.comments=[]})},void 0,"clearPendingReview")}}}))(e)(...t),...(({basePath:e,diffEntries:t,baseOid:i,headOid:n,selectedCommitRange:r})=>(a,s)=>{let o=(0,y.S)();for(let[a,s]of Object.entries(t)){let t=j(e,s.path,r.baseOid??i,r.headOid??n);o.setQueryData(t,()=>s.diffLines)}return{diffEntries:t,diffEntriesActions:{updateDiffEntries:t=>{let i=s().diffEntries??{},n={};for(let i of t){let t=j(e,i.path,s().comparisonInfo.selectedRange.baseOid,s().comparisonInfo.selectedRange.headOid);o.setQueryData(t,i.diffLines),n[i.path]=i}a({diffEntries:(0,l.jM)(i,e=>{for(let t of Object.keys(n))n[t]&&(e[t]=n[t])})},void 0,"updateDiffEntriesInMap")},loadDiffEntries:async t=>{let i=await (e=>(0,L.G7)("pr_sfv_new_diff_fetch")?w(e):N(e))({basePath:e,...t,...s().comparisonInfo});return i&&0!==i.length?(s().diffEntriesActions.updateDiffEntries(i),i):[]},fetchContextLines:async({path:t,contextLineRanges:i,w:n="0"})=>{let r=j(e,t,s().comparisonInfo.selectedRange.baseOid,s().comparisonInfo.selectedRange.headOid),l=s().diffEntries[t];l&&await o.fetchQuery({queryKey:r,queryFn:async()=>{let d=await I({contextLineRanges:i,basePath:e,path:t,w:n,...s().comparisonInfo}),c=l.diffLines,u=o.setQueryData(r,e=>c=function(e,t){let i=new Map;for(let t of e){let e=`${t.left}-${t.right}`;i.set(e,t)}return t.map(e=>{let t=`${e.left}-${e.right}`,n=i.get(t);return n?{...e,position:n.position,displayNoNewLineWarning:n.displayNoNewLineWarning}:{...e,position:null,threadsData:void 0}})}(e??l.diffLines,d?.diffEntryLines??[]));return a(e=>({...e,diffEntries:{...e.diffEntries,[t]:{...l,diffLines:c}}}),void 0,"addContextLinesToDiffEntry"),u}})}}}})(e)(...t),...(({markers:e})=>(t,i)=>{let n,r,a=(0,h.Gl)(),s=(0,h.e3)();if(e){if(a){let t=Object.values(e||{}).flatMap(e=>Object.values(e).flatMap(e=>e?.threads??[]));if(t){let e=Number(a);for(let i of Object.values(t)){let t=i?.commentsData?.comments;if(i&&t)for(let a of t)Number(a.databaseId)===e&&(n=i.id,r=e)}}}else if(s){let t=Object.values(e).flatMap(e=>Object.values(e).flatMap(e=>e?.annotations??[]));if(t){let e=Number(s);for(let i of Object.values(t))Number(i.databaseId)===e&&(n=i.id)}}}return{markerAndDiffNavigation:{markerId:n,commentId:r,getCommentId:()=>i().markerAndDiffNavigation.commentId,getMarkerId:()=>i().markerAndDiffNavigation.markerId},markerAndDiffNavigationActions:{navigateToSelectedComment:e=>{let n=i().getThreadFromCommentID(e);if(n){let r=i().getPathDigestFromThreadID(n.id);i().progressiveDiffsActions.updateSelectedPathDigest(r),t(t=>({markerAndDiffNavigation:{...t.markerAndDiffNavigation,commentId:e,markerId:n?.id}}))}},navigateToSelectedAnnotation:e=>{let n=i().getAnnotationFromID(e);if(n){let r=i().getPathDigestFromAnnotationID(e);i().progressiveDiffsActions.updateSelectedPathDigest(r),t(e=>({markerAndDiffNavigation:{...e.markerAndDiffNavigation,commentId:void 0,markerId:n.id}}))}},handleHashUpdate:()=>{let e=(0,h.Gl)(),t=(0,h.e3)(),n=(0,h.jU)(window.location.hash),r=i(),a=r.markerAndDiffNavigation.commentId,s=r.markerAndDiffNavigation.markerId,o=r.selectedPathDigest;if(e&&e!==a)r.markerAndDiffNavigationActions.navigateToSelectedComment(e);else if(t){let e=r.getAnnotationFromID(t),i=e?.id;i&&i!==s&&r.markerAndDiffNavigationActions.navigateToSelectedAnnotation(t)}else n&&n!==o?r.progressiveDiffsActions.updateSelectedPathDigest(n):e||t||n||!o||r.progressiveDiffsActions.updateSelectedPathDigest(void 0)}}}})(e)(...t),...(({isSingleFileMode:e})=>t=>({isSingleFileMode:e}))(e)(...t),...(({pullRequest:e})=>t=>({pullRequest:{state:e.state,basePath:e.pathName},pullRequestActions:{updatePullRequestState:i=>{t({pullRequest:{state:i,basePath:e.pathName}},void 0,"pullRequest#updatePullRequestState")}}}))(e)(...t),...(e=>t=>({suggestionBatch:{activeBatch:e.initialActiveBatch??[],isSuggestionBatchPending:(e.initialActiveBatch?.length??0)>0},suggestionBatchActions:{addSuggestionToBatch:e=>t(t=>{if(t.suggestionBatch.activeBatch.includes(e))return t;let i=[...t.suggestionBatch.activeBatch,e];return{suggestionBatch:{...t.suggestionBatch,activeBatch:i,isSuggestionBatchPending:i.length>0}}}),removeSuggestionFromBatch:e=>t(t=>{let i=t.suggestionBatch.activeBatch.filter(t=>t!==e);return{suggestionBatch:{...t.suggestionBatch,activeBatch:i,isSuggestionBatchPending:i.length>0}}}),clearSuggestionBatch:()=>t(e=>({suggestionBatch:{...e.suggestionBatch,activeBatch:[],isSuggestionBatchPending:!1}})),loadActiveBatchFromStorage:e=>t(t=>({suggestionBatch:{...t.suggestionBatch,activeBatch:e,isSuggestionBatchPending:e.length>0}}))}}))(e)(...t)}),{name:"pull-request-store"}));try{_.displayName||(_.displayName="PullRequestStoreContext")}catch{}try{E.displayName||(E.displayName="PullRequestStoreProvider")}catch{}},8431:(e,t,i)=>{i.d(t,{A:()=>n});let n={diff:"Diff-module__diff--Sofy4",diffTargetable:"Diff-module__diffTargetable--kW3Cm",diffHeaderWrapper:"Diff-module__diffHeaderWrapper--eH6zk",diffAddFileThread:"Diff-module__diffAddFileThread--f81Tx",diffFooter:"Diff-module__diffFooter--kHHJz"}},13814:(e,t,i)=>{i.d(t,{J:()=>DiffSelectedLineEvent,L:()=>DiffAddCommentButtonClickedEvent});var n=i(50467);let DiffAddCommentButtonClickedEvent=class DiffAddCommentButtonClickedEvent extends Event{constructor(e,t){super("DiffAddCommentButtonClickedEvent",{bubbles:!0,cancelable:!0,composed:!0}),(0,n._)(this,"endLineNumber",void 0),(0,n._)(this,"endOrientation",void 0),(0,n._)(this,"filePath",void 0),(0,n._)(this,"startOrientation",void 0),(0,n._)(this,"startLineNumber",void 0),this.startLineNumber=e.startLineNumber,this.endLineNumber=e.endLineNumber,this.startOrientation=e.startOrientation,this.endOrientation=e.endOrientation,this.filePath=t}};let DiffSelectedLineEvent=class DiffSelectedLineEvent extends Event{constructor(e,t){super("DiffSelectedLineEvent",{bubbles:!0,cancelable:!0,composed:!0}),(0,n._)(this,"endLineNumber",void 0),(0,n._)(this,"endOrientation",void 0),(0,n._)(this,"filePath",void 0),(0,n._)(this,"startOrientation",void 0),(0,n._)(this,"startLineNumber",void 0),this.startLineNumber=e.startLineNumber,this.endLineNumber=e.endLineNumber,this.startOrientation=e.startOrientation,this.endOrientation=e.endOrientation,this.filePath=t}}},15697:(e,t,i)=>{function n({paths:e,diffSummaries:t}){let i={};for(let n of e){let e=t[n];if(e&&e.markersMap){let t=[];for(let i in e.markersMap){let n=e.markersMap[i]?.ctx;n&&t.push(n)}i[n]=t}}return i}function r({diffSummary:e}){let t=[];if(e&&e.markersMap)for(let i in e.markersMap){let n=e.markersMap[i]?.ctx;n&&t.push({start:n[0],end:n[1]})}return t}i.d(t,{B:()=>r,i:()=>n})},18373:(e,t,i)=>{i.d(t,{U:()=>y});var n=i(74848),r=i(21728),a=i(96540),s=i(43883),o=i(21373),l=i(67955),d=i(72511),c=i(15837),u=i(39183),m=i(86877),f=i(4175),h=i(46251),p=i(15220),g=i(38621);let b={dismissalCommentTextarea:"BaseSharedDismissalDialog-module__dismissalCommentTextarea--xxBPO"};var v=i(55127),C=i.n(v);let x={FalsePositive:"false_positive",UsedInTests:"used_in_tests",WontFix:"wont_fix"};function y(e){let t,i,v,y,L,S,N,w,D,j,I,k,_,A,E,R,T,O,M,P,$,F,B,H,U=(0,r.c)(62),{setOpen:G,count:K,error:V,isPending:q,delegatedAlertDismissalEnabled:W,codeSecurity:z,onSubmit:X}=e,[Q,J]=(0,a.useState)(""),[Y,Z]=(0,a.useState)(""),[ee,et]=(0,a.useState)(!1);U[0]!==W||U[1]!==Y?(t=!W||!!Y.trim(),U[0]=W,U[1]=Y,U[2]=t):t=U[2];let ei=t,en=!!Q&&ei;U[3]===Symbol.for("react.memo_cache_sentinel")?(i=e=>{J(e??"")},U[3]=i):i=U[3];let er=i,ea=z?"alert":"finding";U[4]!==K||U[5]!==ea?(v=function(e,t){let i=C()(e,t),n=t>1,r=`Dismiss ${i}`,a=`Select a reason to dismiss ${C()("this",t)} ${i}.`,s=`Request to dismiss ${i}`,o=n?`These ${i} need approval before they can be dismissed. Requests are sent to all approvers.`:`This ${i} needs approval before it can be dismissed. Requests are sent to all approvers.`,l=n?`These ${i} are not valid`:`This ${i} is not valid`;return{title:r,subtitle:a,submitButtonLabel:"Dismiss",delegatedAlertDismissal:{title:s,subtitle:o,submitButtonLabel:"Submit request"},reasons:{falsePositiveDescription:l,usedInTestsDescription:n?`These ${i} are not in production code`:`This ${i} is not in production code`,wontFixDescription:n?`These ${i} are not relevant`:`This ${i} is not relevant`}}}(ea,K),U[4]=K,U[5]=ea,U[6]=v):v=U[6];let{title:es,subtitle:eo,submitButtonLabel:el,delegatedAlertDismissal:ed,reasons:ec}=v;U[7]!==Y||U[8]!==en||U[9]!==X||U[10]!==Q?(y=async()=>{if(!en)return void et(!0);et(!1),X({resolution:Q,dismissalComment:Y})},U[7]=Y,U[8]=en,U[9]=X,U[10]=Q,U[11]=y):y=U[11];let eu=y;U[12]!==G?(L=()=>G(!1),U[12]=G,U[13]=L):L=U[13];let em=W?ed.title:es,ef=W?ed.subtitle:eo;return U[14]!==K||U[15]!==ed||U[16]!==W||U[17]!==q||U[18]!==en||U[19]!==eu||U[20]!==G||U[21]!==el?(S=()=>(0,n.jsxs)(p.l.Footer,{children:[(0,n.jsx)(o.Q,{onClick:()=>G(!1),children:"Cancel"}),(0,n.jsxs)(o.Q,{variant:"primary",onClick:eu,disabled:!en||q,leadingVisual:q?g.SyncIcon:null,children:[(0,n.jsx)("span",{children:W?ed.submitButtonLabel:el}),K>1&&(0,n.jsx)(l.A,{scheme:"primary",className:"ml-2",children:(0,s.ai)(K)})]})]}),U[14]=K,U[15]=ed,U[16]=W,U[17]=q,U[18]=en,U[19]=eu,U[20]=G,U[21]=el,U[22]=S):S=U[22],U[23]!==V?(N=V&&(0,n.jsx)(d.A,{variant:"danger",children:V.message}),U[23]=V,U[24]=N):N=U[24],U[25]===Symbol.for("react.memo_cache_sentinel")?(w=(0,n.jsx)(c.A.Label,{visuallyHidden:!0,children:"Dismissal reason"}),U[25]=w):w=U[25],U[26]===Symbol.for("react.memo_cache_sentinel")?(D=(0,n.jsx)(u.A,{value:x.FalsePositive}),j=(0,n.jsx)(m.A.Label,{children:"False positive"}),U[26]=D,U[27]=j):(D=U[26],j=U[27]),U[28]!==ec.falsePositiveDescription?(I=(0,n.jsxs)(m.A,{children:[D,j,(0,n.jsx)(m.A.Caption,{children:ec.falsePositiveDescription})]}),U[28]=ec.falsePositiveDescription,U[29]=I):I=U[29],U[30]===Symbol.for("react.memo_cache_sentinel")?(k=(0,n.jsx)(u.A,{value:x.UsedInTests}),_=(0,n.jsx)(m.A.Label,{children:"Used in tests"}),U[30]=k,U[31]=_):(k=U[30],_=U[31]),U[32]!==ec.usedInTestsDescription?(A=(0,n.jsxs)(m.A,{children:[k,_,(0,n.jsx)(m.A.Caption,{children:ec.usedInTestsDescription})]}),U[32]=ec.usedInTestsDescription,U[33]=A):A=U[33],U[34]===Symbol.for("react.memo_cache_sentinel")?(E=(0,n.jsx)(u.A,{value:x.WontFix}),R=(0,n.jsx)(m.A.Label,{children:"Won't fix"}),U[34]=E,U[35]=R):(E=U[34],R=U[35]),U[36]!==ec.wontFixDescription?(T=(0,n.jsxs)(m.A,{children:[E,R,(0,n.jsx)(m.A.Caption,{children:ec.wontFixDescription})]}),U[36]=ec.wontFixDescription,U[37]=T):T=U[37],U[38]!==q||U[39]!==I||U[40]!==A||U[41]!==T?(O=(0,n.jsxs)(c.A,{name:"resolution",onChange:er,disabled:q,children:[w,I,A,T]}),U[38]=q,U[39]=I,U[40]=A,U[41]=T,U[42]=O):O=U[42],U[43]!==W?(M=(0,n.jsx)(m.A.Label,{required:W,children:"Comment"}),U[43]=W,U[44]=M):M=U[44],U[45]===Symbol.for("react.memo_cache_sentinel")?(P=(0,n.jsx)(f.Ay,{placeholder:"Add a comment",rows:5,maxLength:280,name:"dismissal_comment",onChange:e=>Z(e.target.value),className:b.dismissalCommentTextarea}),U[45]=P):P=U[45],U[46]!==ee?($=ee&&(0,n.jsx)(m.A.Validation,{variant:"error",children:"This field is required"}),U[46]=ee,U[47]=$):$=U[47],U[48]!==q||U[49]!==M||U[50]!==$?(F=(0,n.jsx)("div",{children:(0,n.jsxs)(m.A,{disabled:q,children:[M,P,$]})}),U[48]=q,U[49]=M,U[50]=$,U[51]=F):F=U[51],U[52]!==O||U[53]!==F||U[54]!==N?(B=(0,n.jsxs)(h.B,{gap:"normal",children:[N,O,F]}),U[52]=O,U[53]=F,U[54]=N,U[55]=B):B=U[55],U[56]!==B||U[57]!==L||U[58]!==em||U[59]!==ef||U[60]!==S?(H=(0,n.jsx)(p.l,{width:"large",height:"auto",onClose:L,title:em,subtitle:ef,renderFooter:S,children:B}),U[56]=B,U[57]=L,U[58]=em,U[59]=ef,U[60]=S,U[61]=H):H=U[61],H}try{y.displayName||(y.displayName="BaseSharedDismissalDialog")}catch{}},21132:(e,t,i)=>{i.d(t,{s:()=>n});let n={Loaded:"Loaded",Loading:"Loading",NotLoaded:"NotLoaded"}},27011:(e,t,i)=>{i.d(t,{JA:()=>E,YL:()=>R,qL:()=>X,wI:()=>A,gt:()=>B,xW:()=>O,wL:()=>$,a_:()=>P,TV:()=>M,iY:()=>T,wh:()=>Z,kN:()=>et,JR:()=>ee,L3:()=>f,yo:()=>h,HZ:()=>en,$W:()=>ea,jT:()=>ei,QV:()=>er,or:()=>el,I8:()=>eo,l0:()=>b,Ud:()=>C,uh:()=>x,Fm:()=>y,qg:()=>v,mU:()=>L,GR:()=>j,SM:()=>K,it:()=>Y,j5:()=>p,RH:()=>eh,Fl:()=>F,Lh:()=>w,ne:()=>U,an:()=>z,rP:()=>q,_N:()=>Q,ys:()=>J,pV:()=>es,mY:()=>S,Kp:()=>eu,XN:()=>g,zK:()=>D,mF:()=>I,m9:()=>N,WA:()=>H,WK:()=>em,xJ:()=>ef,Nk:()=>ep,_W:()=>V,Qb:()=>W,BI:()=>G,Mv:()=>ed,gi:()=>ec});var n=i(70466),r=i(59914),a=i(5981),s=i(82603),o=i(71317),l=i(35311);let d={unableToGenerate:"UNABLE_TO_GENERATE"},c=[],u=[],m={threads:c,annotations:u},f=()=>(0,a.n)(e=>e.comparisonInfo),h=()=>(0,a.n)(e=>e.comparisonInfoActions),p=()=>(0,a.n)(e=>e.isSingleFileMode),g=()=>(0,a.n)(e=>e.pullRequest.state),b=()=>(0,a.n)(e=>e.diffSummaries),v=()=>(0,a.n)(e=>Object.values(e.diffSummaries).length??0),C=()=>(0,a.n)(e=>e.diffSummariesActions),x=()=>(0,a.n)(_([e=>e.diffSummaries],e=>Object.values(e),n.x)),y=e=>(0,a.n)(t=>t.diffSummaries[e]),L=()=>k().filteredDiffSummaries,S=()=>(0,a.n)(e=>e.entries),N=()=>(0,a.n)(e=>e.selectedPathDigest),w=()=>(0,a.n)(e=>e.markerAndDiffNavigationActions),D=()=>(0,a.n)(e=>e.markerAndDiffNavigation.commentId),j=()=>(0,a.n)(e=>e.markerAndDiffNavigation.getMarkerId),I=()=>(0,a.n)(e=>e.markerAndDiffNavigation.markerId),k=()=>(0,a.n)(_([e=>e.diffSummaries,e=>e.codeowners,e=>e.diffFilter.state,e=>e.diffFilter.filtersInteractedWith,e=>e.changeGroupGeneration.changeGroups],(e,t,i,n,r)=>{let a=new Map,d=[],c=r.find(e=>e.id===i.activeChangeGroupId),u=c?.hunkPositions?new Set(Object.keys(c.hunkPositions)):void 0;for(let n of Object.values(e)){let e=(0,s.hG)({diffPath:n.path,codeownersData:t}).isOwnedByViewer;!function(e,t,i,n){return(!n||!!n.has(e.path))&&e.path.toLowerCase().includes(t.filterText.toLowerCase())&&!t.unselectedFileExtensions.has((0,l.QC)(e.path))&&(t.showDeletedFiles||"REMOVED"!==e.changeType&&"DELETED"!==e.changeType)&&(!t.showOnlyManifestFiles||!!e.isManifestFile)&&(!t.showOnlyOwnedFiles||i)&&(t.showViewedFiles||!e.markedAsViewed)&&(t.showVendoredFiles||!e.isVendored)}(n,i,e,u)?a.set(n.path,!0):(d.push(n),a.set(n.path,!1))}if(n){let e=d.length,t=`${e} file${1===e?"":"s"} remain${1===e?"s":""}`;(0,o.k)(t,150)}return{hiddenFiles:a,filteredDiffSummaries:d}},n.x));function _(e,t,i){let n,r;return a=>{let s=e.map(e=>e(a));if(n&&i(s,n))return r;let o=t(...s);return n=s,r=o,o}}let A=()=>(0,a.n)((0,r.k)(e=>Object.values(e.markers||{}).flatMap(e=>Object.values(e).flatMap(e=>e?.annotations??u)))),E=()=>(0,a.n)(e=>{let t=e.diffFilter.state.activeChangeGroupId;if(t)return e.changeGroupGeneration.changeGroups.find(e=>e.id===t)}),R=()=>(0,a.n)(e=>e.diffFilter.state.activeChangeGroupId),T=()=>(0,a.n)(e=>e.changeGroupGeneration.changeGroups),O=()=>(0,a.n)(e=>e.changeGroupGeneration),M=()=>(0,a.n)(e=>e.changeGroupGeneration.unavailableReason?e.changeGroupGeneration.unavailableReason:e.changeGroupGeneration.changeGroups.length<1&&!e.changeGroupGeneration.latestChangeGroupOrchestration?d.unableToGenerate:null),P=()=>(0,a.n)(e=>e.changeGroupGeneration.changeGroupGenerationChannel),$=()=>(0,a.n)(e=>e.changeGroupGenerationActions),F=()=>(0,a.n)(e=>e.changeGroupGeneration.latestChangeGroupOrchestration),B=()=>(0,a.n)(e=>e.changeGroupGeneration.canAccessChangeGroups),H=()=>(0,a.n)(e=>e.showChangeGroupPreference),U=e=>(0,a.n)((0,r.k)(t=>t.markers?.[e])),G=e=>(0,a.n)((0,r.k)(t=>{let i=Object.values(t.markers||{}).flatMap(e=>Object.values(e).flatMap(e=>e?.threads??c)),n=[];if(!e)return i;for(let t of e)if(i){for(let e of i)if(Number(e.id)===t){n.push(e);break}}return n})),K=()=>(0,a.n)(e=>e.getThread),V=(e,t,i)=>(0,a.n)(n=>n.markers?.[t]?.[i]?.threads.find(t=>t.id===e)),q=(e,t)=>(0,a.n)(_([i=>i.markers?.[e]?.[t]],e=>{let t=e?.threads??c,i=e?.annotations??u;return t.length||i.length?{threads:t,annotations:i}:m},n.x)),W=e=>(0,a.n)(t=>{let i=Object.values(t.markers||{}).flatMap(e=>Object.values(e).flatMap(e=>e?.threads??c)).filter(t=>t&&(!e||e.includes(parseInt(t.id))));return i?i.filter(e=>!e.isResolved&&!e.positioning?.isOutdated).reduce((e,t)=>e+(t.commentsData?.comments?.length??0),0):0}),z=()=>(0,a.n)(e=>e.markersActions),X=()=>(0,a.n)(e=>e.markers),Q=()=>(0,a.n)(e=>e.pendingReviewActions),J=()=>(0,a.n)(e=>e.pendingReview),Y=()=>(0,a.n)(e=>(e.pendingReview?.pendingReviewIDs?.length??0)>0),Z=()=>(0,a.n)(e=>e.codeownersActions),ee=()=>(0,a.n)(e=>e.filesCollapsedStatusActions),et=e=>(0,a.n)(t=>t.collapsedFilesMap?.[e]??!1),ei=e=>(0,a.n)(t=>t.diffEntries?.[e]??null),en=()=>(0,a.n)(e=>e.diffEntries),er=()=>(0,a.n)(e=>e.diffEntriesActions),ea=e=>(0,a.n)((0,r.k)(t=>t.entries.filter(t=>e.some(e=>e.path===t.path)))),es=()=>(0,a.n)(e=>e.progressiveDiffsActions),eo=()=>(0,a.n)(e=>e.diffFilter.state),el=()=>(0,a.n)(e=>e.diffFilterActions),ed=e=>(0,a.n)(t=>t.summariesViewedStatus?.[e]??!1),ec=()=>(0,a.n)(e=>e.summariesViewedCount),eu=()=>(0,a.n)(e=>e.pullRequest.basePath),em=()=>(0,a.n)(e=>e.suggestionBatch),ef=()=>(0,a.n)(e=>e.suggestionBatchActions),eh=()=>(0,a.n)(e=>e.suggestionBatch.isSuggestionBatchPending),ep=e=>(0,a.n)(t=>t.suggestionBatch.activeBatch.includes(e))},36472:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(13083),r=i(3038);function a({selectedLineRange:e,leftLines:t,rightLines:i}){let a=!!i,{startOrientation:s,endOrientation:o}=e,l=m(s).findIndex(t=>(0,r.a2)(t,e.startLineNumber,e.startOrientation)),d=m(o).findIndex(t=>(0,r.a2)(t,e.endLineNumber,e.endOrientation)),c=l>=0&&d>=0;function u(e){if(!c||(0,r.Po)(e))return!1;let t=m((0,n.XU)(e.type)).indexOf(e);return t>=l&&t<=d}function m(e){var r;return a&&"left"!==("string"==typeof(r=e)?r:(0,n.XU)(r.type))?i:t}let f=m("left").filter(e=>u(e));return{selectedRightLines:m("right").filter(e=>u(e)),selectedLeftLines:f}}},36729:(e,t,i)=>{i.d(t,{Vv:()=>r,Wr:()=>a,zW:()=>n});let n="FILE",r="empty-diff-line",a={Line:"line",Multiline:"multiline",File:"file"}},39698:(e,t,i)=>{i.d(t,{i:()=>d});var n=i(48845),r=i(20622),a=i(97665),s=i(94747),o=i(69510),l=i(27011);function d(e,t){let i=(0,l.Kp)(),d=`${i}/page_data/${r.u.unresolveThread}`,c=(0,a.jE)(),{updateThread:u}=(0,l.an)();return(0,s.n)({mutationFn:async({threadId:e})=>{let t=await (0,n.q$)(d,{method:"POST",body:{threadId:e}});(0,n.R)(t)},onSuccess:(n,r)=>(u(Number(r.threadId),e,t,e=>{if(e)return{...e,isResolved:!1,resolvedBy:void 0}}),c.invalidateQueries({queryKey:(0,o.XG)(i)}))})}},43362:(e,t,i)=>{i.d(t,{Be:()=>a,Sl:()=>o,Wp:()=>r,YY:()=>d,jH:()=>l,wm:()=>s});var n=i(36729);function r(e){return e.reduce((e,t)=>(e[t.path]=t,e),{})}function a(e){return e.reduce((e,t)=>(e[t.path]=!!t.markedAsViewed,e),{})}function s(e){let t=e.comments.map(e=>parseInt(e.threadId));return{id:e.id,pendingReviewIDs:t,comments:e.comments}}function o(e){return e.reduce((e,t)=>(e[t.path]=t,e),{})}function l(e,t){if(!e)return;let i={};if(!t)return i;for(let r of t){if(!r.markersMap||0===Object.keys(r.markersMap).length)continue;let t=r.path,a={};for(let t in r.markersMap){let i=r.markersMap[t];if(!i?.threads&&!i?.annotations)continue;let s={threads:[],annotations:[]};if(i.annotations)for(let t of i.annotations){let i=e.annotations[Number(t.id)];i&&s.annotations.push(i)}if(i.threads)for(let n of i.threads){let i=function(e,t){if("FILE"===e)return;let i=e[0];if(!u(i))return;let n=Number(e.slice(1)),r=-1,a="R";if(t.start){r=parseInt(t.start.slice(1));let e=t.start[0];u(e)&&(a=e)}else r=n,a=i;return{endLine:n,endDiffSide:c[i],startLine:r,startDiffSide:c[a],isOutdated:!!t.outdatedReason}}(t,n),r=e.threads[Number(n.id)];r&&i&&(r={...r,positioning:i,subject:i}),r&&s.threads.push(r)}"FILE"===t?a[n.zW]=s:a[t]=s}i[t]=a}return i}function d(e){return{endLine:e.line,endDiffSide:e.side?.toLowerCase()==="right"?"RIGHT":"LEFT",startLine:e.startLine??e.line,startDiffSide:e.startSide?e.startSide?.toLowerCase()==="right"?"RIGHT":"LEFT":e.side?.toLowerCase()==="right"?"RIGHT":"LEFT",isOutdated:!1}}let c={L:"LEFT",R:"RIGHT"};function u(e){return"L"===e||"R"===e}},43883:(e,t,i)=>{i.d(t,{Gl:()=>a,TC:()=>d,ai:()=>s,eh:()=>l});var n=i(21067);let r={};function a(e,t){let i=t?.currency??"USD";return(r[i]||(r[i]=new Intl.NumberFormat((0,n.JK)(),{currency:i,style:"currency"}))).format(e)}function s(e,t){return new Intl.NumberFormat((0,n.JK)(),{maximumFractionDigits:t?.precision}).format(e)}let o=["k","m","b"];function l(e,t){let{suffix:i=!0,capping:n=1/0,precision:r=1}=t??{},a="",l=Math.min(n,e);if(i){let e=c(l);a=o[e-1]||"",l/=1e3**e}let d=s(l,{precision:r})+a;return e>n?`${d}+`:d}function d(e){if(e<=1e4)return 1;let t=c(e);return e/1e3**t>=10?0:1}function c(e){let t=Math.floor(Math.log(Math.max(Math.abs(e),1))/Math.log(1e3));return Math.min(o.length,t)}},45270:(e,t,i)=>{i.d(t,{Dp:()=>l,ww:()=>c,Xv:()=>d});var n=i(74848),r=i(96540);let a=/^(?<startOid>[a-fA-F0-9]{7,40})\.\.(?<endOid>[a-fA-F0-9]{7,40})$/,s=/^[a-fA-F0-9]{7,40}$/,o=(0,r.createContext)({});function l({baseRefOid:e,path:t,children:i}){let l=(0,r.useMemo)(()=>{let{startOid:i,endOid:n}=function(e,t){let i,n,r=e.split("/"),o=r[r.length-1];if(o){let e=function(e){let t=e.match(a),i=t?.groups?.startOid,n=t?.groups?.endOid;return t&&i&&n?{startOid:i,endOid:n}:s.test(e)?{singleCommitOid:e}:void 0}(o);e&&(i="startOid"in e?e.startOid:t,n="endOid"in e?e.endOid:e.singleCommitOid)}return{startOid:i,endOid:n}}(t,e);return{endOid:n,startOid:i,baseRefOid:e}},[e,t]);return(0,n.jsx)(o.Provider,{value:l,children:i})}let d=()=>(0,r.useContext)(o);function c(){let{endOid:e,startOid:t}=d();return!!e||!!t}try{o.displayName||(o.displayName="SelectedRefContext")}catch{}try{l.displayName||(l.displayName="SelectedRefContextProvider")}catch{}},50625:(e,t,i)=>{i.d(t,{L:()=>l});var n=i(82075),r=i(96540);let{getItem:a,removeItem:s,setItem:o}=(0,n.D)("localStorage");function l({diffSide:e,filePath:t,handlePersistedCommentExists:i,line:n,subjectId:l,threadId:d,fileLevelComment:c}){let u,m,f=(0,r.useMemo)(()=>d||(d??((e,t)=>{let{diffSide:i,filePath:n,line:r,subjectId:a}=e;if(t)return`PullRequest:${a}-File:${n}`;if(void 0!==r&&void 0!==i)return`PullRequest:${a}-File:${n}-Line:${r}-DiffSide:${i}`;throw Error("Cannot build diff line comment cache key for a comment without a line number or diff side")})({diffSide:e,filePath:t,line:n,subjectId:l},c)),[e,t,n,l,d,c]),{hasPersistedComment:h,removePersistedCommentFromStorage:p}=(u=a(f),m=!!u?.text?.trim(),(0,r.useEffect)(()=>{m&&i?.(u)},[m]),{hasPersistedComment:m,removePersistedCommentFromStorage:()=>{s(f),m=!1,u=null}});return{hasPersistedComment:h,persistCommentToStorage:e=>{let t={text:e.text};e.startLine&&e.startSide&&(t={...t,startLine:e.startLine,startSide:e.startSide}),o(f,t)},removePersistedCommentFromStorage:p}}},51391:(e,t,i)=>{i.d(t,{Aj:()=>u,EV:()=>d,KV:()=>m,M6:()=>l,bo:()=>o,sB:()=>c});var n=i(36472),r=i(3038),a=i(61583),s=i(71315);function o(e){return`b:${e.blobLineNumber}-l:${e.left}-r:${e.right}`}function l({current:e,currentOrientation:t,previous:i,previousOrientation:n}){return!!i&&("left"===n&&"left"===t&&!!e.left&&!!i.left&&i.left>e.left||"right"===n&&"right"===t&&!!e.right&&!!i.right&&i.right>e.right||"right"===n&&"left"===t&&!!e.right&&!!i.right&&i.right>e.right||"left"===n&&"right"===t&&!!e.left&&!!i.left&&i.left>e.left||!1)}function d({diffAnchor:e,diffLines:t,isSplitView:i,lineRange:a}){let s,l=new Set([]);if(0===t.length)return{selectedLineKeys:l};if(!a)return{selectedLineKeys:new Set([])};let{startLineNumber:d,startOrientation:c,endLineNumber:u,endOrientation:m}=a,f=t;if(i){let e=(0,r.Mk)(t);f=e.leftLines,s=e.rightLines}let h={diffAnchor:e,endLineNumber:u??d,endOrientation:m??c,startLineNumber:d,startOrientation:c},p=(0,n.A)({selectedLineRange:h,leftLines:f,rightLines:s});for(let e=0;e<p.selectedLeftLines.length;e++){let t=p.selectedLeftLines[e];t&&!(0,r.Po)(t)&&l.add(o(t))}for(let e=0;e<p.selectedRightLines.length;e++){let t=p.selectedRightLines[e];t&&!(0,r.Po)(t)&&l.add(o(t))}return{selectedLineKeys:l,startOrientation:c,selectedLineRange:h}}function c(e){let t;for(t of e);return t}function u(e){return e.values().next().value}function m(e){let t=(0,a.EW)(s.fV.hash);if(!t||t[1]!==e)return;let i=t[2]?"L"===t[2]?"left":"right":void 0,n=t[3]?parseInt(t[3]):void 0,r=t[4]?"L"===t[4]?"left":"right":void 0,o=t[5]?parseInt(t[5]):void 0;if(i&&n)return{diffAnchor:e,endOrientation:r??i,endLineNumber:o??n,startOrientation:i,startLineNumber:n}}},61219:(e,t,i)=>{i.d(t,{U:()=>J});var n=i(74848),r=i(42118),a=i(26156),s=i(71073),o=i(81156),l=i(63352),d=i(73189),c=i(78809),u=i(73017),m=i(71315),f=i(43258),h=i(38621),p=i(72511),g=i(24990),b=i(87448),v=i(34164),C=i(96540),x=i(25407),y=i(94747),L=i(27011),S=i(1932),N=i(96379),w=i(48845),D=i(20622),j=i(34784),I=i(8748),k=i(50625),_=i(93642),A=i(70109);let E={ReviewThreadContainer:"ReviewThreadComment-module__ReviewThreadContainer--mI1dg",ReviewThreadWrapper:"ReviewThreadComment-module__ReviewThreadWrapper--zXqpP",ReviewThreadBox:"ReviewThreadComment-module__ReviewThreadBox--Ddyuz",ReviewThreadInnerContainer:"ReviewThreadComment-module__ReviewThreadInnerContainer--xw85s",ReplyWrapper:"ReviewThreadComment-module__ReplyWrapper--yIUaX",SafeHTMLBox:"ReviewThreadComment-module__SafeHTMLBox--SVSQJ",BodyHTMLContainer:"ReviewThreadComment-module__BodyHTMLContainer--O6lsx"};var R=i(88431),T=i(40961),O=i(80081),M=i(3252),P=i(91747),$=i(2265),F=i(30459),B=i(26607),H=i(21373),U=i(88008);function G({onOpenDialog:e,suggestedChange:t}){let{sendAnalyticsEvent:i}=(0,F.s)(),r=(0,C.useRef)(null),a=(0,L.Nk)(t.commentDatabaseId||0),s=(0,L.RH)(),o=(0,P.u)("batch_suggested_changes"),{addSuggestionToBatch:l,removeSuggestionFromBatch:d}=(0,L.xJ)(),c=(0,L.WK)(),u=(0,L.Kp)(),m=(0,L.L3)(),f=(0,C.useCallback)(()=>{t.commentDatabaseId&&(l(t.commentDatabaseId),(0,U.CE)(u,m.fullDiff.headOid,[...c.activeBatch,t.commentDatabaseId]),i("comments.add_suggested_change_to_batch","ADD_SUGGESTED_CHANGE_TO_BATCH_BUTTON"))},[l,t.commentDatabaseId,c,u,m,i]),h=(0,C.useCallback)(()=>{t.commentDatabaseId&&(d(t.commentDatabaseId),(0,U.CE)(u,m.fullDiff.headOid,c.activeBatch.filter(e=>e!==t.commentDatabaseId)),i("comments.remove_suggested_change_from_batch","REMOVE_SUGGESTED_CHANGE_FROM_BATCH_BUTTON"))},[d,t.commentDatabaseId,c,u,m,i]),p=(0,C.useCallback)(()=>{e(r)},[e]);return(0,n.jsx)("div",{className:"d-flex flex-row flex-items-center",children:o&&a?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(B.A,{variant:"attention",children:"Pending in batch"}),(0,n.jsx)("div",{className:"ml-auto",children:(0,n.jsx)(H.Q,{variant:"danger",onClick:h,children:"Remove from batch"})})]}):(0,n.jsxs)("div",{className:"d-flex gap-2 ml-auto",children:[!s&&(0,n.jsx)(H.Q,{variant:"default",onClick:p,ref:r,children:"Apply suggestion"}),o&&(0,n.jsx)(H.Q,{variant:"primary",onClick:f,children:"Add suggestion to batch"})]})})}try{G.displayName||(G.displayName="ApplyOrAddToBatch")}catch{}var K=i(3585);function V({reason:e,className:t="m-2"}){return(0,n.jsx)("div",{className:t,children:(0,n.jsx)("small",{className:"fgColor-muted",children:e})})}try{V.displayName||(V.displayName="CodeSuggestionUnavailable")}catch{}function q({suggestedChange:e}){let{setIsDialogOpen:t}=(0,$.W)(),[i,r]=(0,C.useState)(!1),a=(0,C.useRef)(void 0),s=(0,P.u)("batch_suggested_changes"),o=(0,L.WK)(),l=s&&void 0!==e.commentDatabaseId&&null!==e.commentDatabaseId&&o.activeBatch.includes(e.commentDatabaseId),{isValid:d,reason:c}=(0,O.EJ)(e,[]),u=(0,C.useMemo)(()=>[e],[e]),f=u.map(e=>e.authorLogin),h=(0,C.useCallback)(e=>{r(e),t?.(e)},[t]),p=(0,C.useCallback)(()=>{if(h(!1),a.current){let e=a.current.current;setTimeout(()=>e?.focus())}},[h]),g=(0,C.useCallback)(e=>{h(!0),a.current=e},[h,a]),{mutate:b}=function(){let e=(0,L.Kp)(),t=`${e}/page_data/${D.u.submitSuggestedChanges}`;return(0,y.n)({mutationFn:async({changes:e,currentOid:i,message:n})=>{let r=await (0,w.q$)(t,{method:"POST",body:{changes:e,currentOid:i,message:n}}),a=await (0,w.hp)(r);return(0,w.R)(r,a),a},onSuccess:()=>{m.cg?.location.reload()}})}(),{fullDiff:{headOid:v}}=(0,L.L3)(),x=(0,C.useCallback)((e,t,i)=>{b({changes:u,message:e,currentOid:v},{onSuccess:()=>{p(),i()},onError:e=>{t(e,"submitSuggestedChanges","Failed to submit suggested changes")}})},[u,p,v,b]);return(0,n.jsxs)("div",{className:"border-top p-2",children:[(0,n.jsx)(G,{suggestedChange:e,onOpenDialog:g}),!l&&!d&&c&&(0,n.jsx)(V,{reason:c,className:"m-0"}),i&&(0,n.jsx)(K.$,{authorLogins:f,batchSize:u.length,onClose:p,onCommit:x})]})}try{q.displayName||(q.displayName="CodeSuggestionActions")}catch{}function W({applySuggestedChangesValidationData:e,comment:t,commentBodyRef:i,filePath:r,isOutdated:a,isThreadResolved:s,suggestedChangesConfig:o,databaseId:l,viewerCanApplySuggestion:d}){let c=(0,L.XN)(),u=function(e,t,i,n,r){let[a,s]=(0,C.useState)();return(0,R.N)(()=>{if(!e.current||t.subjectType?.toUpperCase()!=="LINE")return;let a=[...e.current.getElementsByClassName("js-apply-changes")];if(a.length>0){let e=[];for(let s of a){let a=s?.closest("div.js-suggested-changes-blob");if(!a||!r.lineRange)continue;let o=(0,M.y)(a);e.push({authorLogin:t.author?.login??"ghost",commentId:t.id,commentDatabaseId:t.databaseId,path:i,ref:s,suggestion:o,lineRange:r.lineRange,threadId:n})}s(e)}},[r.lineRange,t.author?.login,t.bodyHTML,t.databaseId,t.id,t.subjectType,e,i,n]),a}(i,t,r,l,e);return(0,n.jsx)(n.Fragment,{children:u?.length?u.map(i=>{let{isValid:r,reason:l}=(0,O.o_)({suggestedChange:i,isOutdated:a,isPending:"PENDING"===t.state.toUpperCase(),isResolved:s,pullRequestIsClosed:void 0===c||"CLOSED"===c||"MERGED"===c,pullRequestIsInMergeQueue:"QUEUED"===c,userCanApplySuggestion:!!d,applySuggestedChangesValidationData:e,suggestedChangesConfig:o});return!r&&l?(0,T.createPortal)((0,n.jsx)(V,{reason:l}),i.ref):(0,T.createPortal)((0,n.jsx)(q,{suggestedChange:i}),i.ref)}):null})}try{W.displayName||(W.displayName="SuggestedChangeView")}catch{}var z=i(30721),X=i(83494),Q=i(20459);function J({isAnchorable:e=!1,index:t=0,isInlineComment:i,isLastChild:R,isOutdated:T,isThreadResolved:O,lineMarkersKey:M,anchorPrefix:P="r",comment:$,disableDialogMode:F,enableDialogMode:B,filePath:H,gridCellId:U,hideActions:G,isFirstComment:K=!1,isInDialogMode:V,onDeleteLineComment:q,onQuoteReply:J=d.l,subjectId:Y,threadCommentCount:Z,threadId:ee,threadPositionNumber:et,suggestedChangesConfig:ei,applySuggestedChangesValidationData:en,viewerData:er,ghostUser:ea=o.t.ghostUser,originalDiffPathUri:es,headingLevel:eo="h3"}){let{addToast:el}=(0,f.Y6)(),[ed,ec]=(0,C.useState)(!1),[eu,em]=(0,C.useState)($.isHidden),[ef,eh]=(0,C.useState)(!1),[ep,eg]=(0,C.useState)($.body),[eb,ev]=(0,C.useState)(!1),[eC,ex]=(0,C.useState)(!1),[ey,eL]=(0,C.useState)(""),{persistCommentToStorage:eS,removePersistedCommentFromStorage:eN}=(0,k.L)({subjectId:Y,filePath:H,fileLevelComment:"FILE"===$.subjectType,threadId:$.id,handlePersistedCommentExists:({text:e})=>{e&&eg(e)}}),ew=(0,C.useRef)(null),eD=(0,C.useRef)(null),ej=(0,C.useRef)(null),[eI,ek]=(0,C.useState)(""),e_=()=>{ew.current?.focus()};(0,C.useEffect)(()=>{if(ed){let e=window.setTimeout(e_);return()=>{window.clearTimeout(e)}}},[ed]);let{mutate:eA}=function({filePath:e,lineMarkersKey:t,onSuccess:i}){let n=(0,L.Kp)(),{deleteThreadComment:r}=(0,L.an)(),{onCommentThreadDeleted:a}=(0,L.Ud)(),s=(0,L.SM)(),{removePendingComment:o}=(0,L._N)();return(0,y.n)({mutationFn:async({commentId:i,threadId:r})=>{let a=s(Number(r),e,t)?.commentsData?.comments?.find(e=>e.id===i);if(!a)return;let o=`${n}/page_data/review_comments/${a.databaseId}`,l=await (0,w.q$)(`${o}`,{method:"DELETE"});if(204===l.status||200===l.status)return;let d=await (0,w.hp)(l);(0,w.R)(l,d)},onSuccess:(n,{commentId:s,threadId:l})=>{let d=r(Number(l),s,e,t);o(Number(l)),"thread_deleted"===d&&("thread_deleted"===d&&a({path:e,threadID:l}),i?.())}})}({filePath:H,lineMarkersKey:M,onSuccess:()=>{eh(!1),ex(!1),q?.()}}),eE=async()=>{F?.(),eh(!0)},{mutate:eR}=function(e,t){let i=(0,L.Kp)(),n=`${i}/page_data/${D.u.hideComment}`,{updateThreadComment:r}=(0,L.an)();return(0,y.n)({mutationFn:async({commentDatabaseId:e,reason:t})=>{let i=await (0,w.q$)(n,{method:"POST",body:{classifier:t,commentId:e}}),r=await (0,w.hp)(i);return(0,w.R)(i,r),r},onSuccess:i=>{r({threadID:i.threadId,filePath:e,lineMarkersKey:t,match:e=>e.databaseId===i.commentDatabaseId,transform:e=>{if(e)return{...e,isHidden:!0,minimizedReason:i.reason}}})}})}(H,M),{mutate:eT}=function(e,t){let i=(0,L.Kp)(),n=`${i}/page_data/${D.u.unhideComment}`,{updateThreadComment:r}=(0,L.an)();return(0,y.n)({mutationFn:async({commentDatabaseId:e})=>{let t=await (0,w.q$)(n,{method:"POST",body:{commentId:e}}),i=await (0,w.hp)(t);return(0,w.R)(t,i),i},onSuccess:i=>{r({threadID:i.threadId,filePath:e,lineMarkersKey:t,match:e=>e.databaseId===i.commentDatabaseId,transform:e=>{if(e)return{...e,isHidden:!1,minimizedReason:null}}})}})}(H,M),{mutate:eO}=function(){let{updateThreads:e}=(0,L.an)();return(0,y.n)({mutationFn:async({duration:e,hiddenReason:t,organizationLogin:i,notifyBlockedUser:n,shouldHideComment:r,userLogin:a})=>{let s=new FormData;s.append("duration",e),s.append("hide_comment",r.toString()),t&&s.append("hidden_reason",t),s.append("login",a),s.append("send_notification",n.toString()),await (0,N.DI)((0,x.ggd)({owner:i}),{method:"POST",body:s,redirect:"manual"})},onSuccess:(t,i)=>{e((0,S.jM)(e=>{let t=e.flatMap(e=>e.commentsData?.comments.filter(e=>e.author?.login===i.userLogin));if(0!==t.length)for(let e of t)e&&(e.viewerCanBlockFromOrg=!1,e.viewerCanUnblockFromOrg=!0,e.isHidden=i.shouldHideComment||e.isHidden,e.minimizedReason=i.hiddenReason||null)}))}})}(),{mutate:eM}=function(){let{updateThreads:e}=(0,L.an)();return(0,y.n)({mutationFn:async({organizationLogin:e,userLogin:t})=>{await (0,w.q$)(`${(0,x.ggd)({owner:e})}/${(0,x.QU3)(t)}`,{method:"DELETE",redirect:"manual"})},onSuccess:(t,i)=>{e((0,S.jM)(e=>{let t=e.flatMap(e=>e.commentsData?.comments.filter(e=>e.author?.login===i.userLogin));if(0!==t.length)for(let e of t)e&&(e.viewerCanBlockFromOrg=!0,e.viewerCanUnblockFromOrg=!1)}))}})}(),{mutate:eP}=function(e,t){let i=(0,L.Kp)(),{updateThreadComment:n}=(0,L.an)();return(0,y.n)({mutationFn:async({commentDatabaseId:e,reaction:t,viewerHasReacted:n})=>{let r=`${i}/page_data/${n?D.u.removeCommentReaction:D.u.addCommentReaction}`,a=await (0,w.q$)(r,{method:"POST",body:{reaction:t,commentId:e}}),s=await (0,w.hp)(a);return(0,w.R)(a,s),s},onSuccess:(i,r)=>{n({threadID:parseInt(r.threadId),filePath:e,lineMarkersKey:t,match:e=>e.databaseId===r.commentDatabaseId,transform:e=>{if(e)return{...e,reactionGroups:i.reactionGroups}}})}})}(H,M),{mutate:e$}=function({filePath:e,lineMarkersKey:t,onSuccess:i}){let n=(0,L.Kp)(),r=`${n}/page_data/${D.u.updateReviewComment}`,{updateThreadComment:a}=(0,L.an)();return(0,y.n)({mutationFn:async({commentId:e,bodyVersion:t,body:i})=>{let n=await (0,w.q$)(`${r}${t?`?body_version=${t}`:""}`,{method:"PUT",body:{body:i,commentId:e}}),a=await (0,w.hp)(n);return(0,w.R)(n,a),a},onSuccess:n=>{a({threadID:n.threadId,filePath:e,lineMarkersKey:t,match:e=>e.databaseId===n.commentDatabaseId,transform:e=>{if(e)return{...e,body:n.body,bodyHTML:n.bodyHTML,bodyVersion:n.bodyVersion}}}),i?.()}})}({filePath:H,lineMarkersKey:M,onSuccess:()=>{ec(!1),ev(!1),eN()}}),eF=(0,C.useCallback)(()=>{ev(!0);let e=(0,_.u)(ep,ei?.sourceContentFromDiffLines??"");if(!e.isValid){eL(e.errorMessage),ev(!1);return}e$({commentId:String($.databaseId),body:ep,bodyVersion:$.bodyVersion},{onError:()=>{ev(!1),el({type:"error",message:"Failed to update comment"})}})},[el,ep,$,ei?.sourceContentFromDiffLines,e$]),eB=$.databaseId?.toString(),eH=eB?`${P}${eB}`:void 0,eU=eH&&m.fV?new URL(`${m.fV.pathname}#${eH}`,m.fV.origin).toString():"",eG=(0,C.useRef)(null);(0,I.u)({isAnchorable:e,commentId:eB,commentAnchor:eH,containerRef:eG});let eK={outline:"2px solid",outlineColor:"accent.fg",outlineOffset:"-2px",boxShadow:"none"},eV=t>0,eq=t>1,eW=ed?"editing":eu?"hidden":"visible",ez={headingProps:{as:eo},avatarUrl:$.author?.avatarUrl??ea.avatarUrl,comment:{...$,url:eU,referenceText:$.reference.text??`#${$.reference.number}`},commentRef:eG,deleteComment:eE,editComment:()=>{ec(!0)},editHistoryComponent:void 0,hideComment:e=>{if(!$.databaseId)throw Error("Comment not found");eR({commentDatabaseId:$.databaseId,reason:e},{onError:()=>{ev(!1),ek("Failed to hide comment")},onSuccess:()=>em(!0)})},onBlock:(e,t,i,n,r,a)=>eO({duration:e,shouldHideComment:t,hiddenReason:i,organizationLogin:n,notifyBlockedUser:r,userLogin:a},{onError:()=>ek("Failed to block user"),onSuccess:()=>{t&&em(!0)}}),onUnblock:(e,t)=>eM({organizationLogin:e,userLogin:t},{onError:()=>ek("Failed to unblock user")}),onMinimize:em,onSuccessfulBlock:()=>{setTimeout(()=>m.cg?.location.reload(),800)},isMinimized:eu,commentAuthorLogin:$.author?.login??ea.login,navigate:d.l,commentSubjectAuthorLogin:$.reference?.author?.login??"",onReplySelect:J,unhideComment:()=>{if(!$.databaseId)throw Error("Comment not found");eT({commentDatabaseId:$.databaseId},{onError:()=>{ev(!1),ek("Failed to unhide comment")},onSuccess:()=>em(!1)})},hideActions:G,isReply:eV,forceInlineAvatar:!0,containerStyle:{},originalDiffPathUri:es,isOutdated:T,commentAuthorSlug:"copilot"===$.reviewVariantType?"copilot-pull-request-reviewer":void 0,commentAuthorType:"copilot"===$.reviewVariantType?a.S.Bot:void 0},eX=(0,C.useMemo)(()=>(0,z.E7)(),[]);return(0,n.jsx)(X.tL,{commands:{"pull-requests-diff-view:quote-reply":()=>{if(ed)return;let e=m.cg?.getSelection(),t=e?.anchorNode?{anchorNode:e.anchorNode,range:e.getRangeAt(0)}:null;J((0,Q.E)(eG?.current,t,$.body))}},children:(0,n.jsxs)(b.az,{ref:eG,id:e?eH:void 0,tabIndex:i?V?0:-1:0,"data-first-thread-comment":K,"data-marker-navigation-comment-thread-id":ee,"data-marker-navigation-comment-id":$.id,...V?{role:"document","aria-roledescription":"comment","aria-label":eV?void 0!==et?`Reply ${t} to Comment ${et}`:`Reply ${t}`:void 0!==et?`Comment ${et}`:"Comment"}:{},sx:{":target":eK,":focus":eK,scrollMarginTop:e?"120px":0},className:(0,v.$)(E.ReviewThreadContainer,"hidden"===eW&&"pb-2"),children:[eq&&(0,n.jsx)("div",{className:E.ReviewThreadWrapper,"data-is-reply":eV,children:(0,n.jsx)("div",{className:E.ReviewThreadBox})}),(0,n.jsx)("div",{className:E.ReviewThreadInnerContainer,"data-is-nested-reply":eq,children:(0,n.jsx)(a.v,{...ez,commentBody:$.body,threadCommentCount:Z,isInDialogMode:V,actions:G?void 0:(0,n.jsx)(j.RelayEnvironmentProvider,{environment:eX,children:(0,n.jsx)(s.p,{...ez})}),isOutdated:T})}),eI&&(0,n.jsxs)(p.A,{variant:"danger",className:"m-3",children:[(0,n.jsx)(h.StopIcon,{className:"mr-2"}),eI]}),(0,n.jsxs)("div",{className:E.ReviewThreadWrapper,"data-is-reply":eV,children:[eV&&(0,n.jsx)("div",{className:E.ReplyWrapper,"data-is-last-child":R}),"editing"===eW&&(0,n.jsx)("div",{className:(0,v.$)("flex-1 min-width-0 pr-2 pt-1 pb-2",eV?"pl-0":"pl-2"),children:(0,n.jsxs)(A.S,{ref:ew,label:"Update comment",value:ep,onChange:e=>{eS({text:e}),eg(e),eL(void 0)},onPrimaryAction:eF,suggestedChangesConfig:ei,markdownErrorMessage:ey,children:[(0,n.jsx)(r.xR,{variant:"default",onClick:()=>{ec(!1),eN(),eg($.body)},children:"Cancel"}),(0,n.jsx)(r.xR,{disabled:eb||!ep.length,loading:eb,variant:"primary",onClick:eF,children:"Update"})]})}),"visible"===eW&&(0,n.jsxs)("div",{className:E.BodyHTMLContainer,"data-is-reply":eV,children:[$.bodyHTML&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.vb,{ref:eD,className:(0,v.$)("markdown-body",E.SafeHTMLBox),"comment-testid":`Comment body html for comment ${$.id}`,html:$.bodyHTML}),"copilot"===$.reviewVariantType&&(0,n.jsxs)("p",{className:"text-small color-fg-muted mt-2 mb-1",children:[(0,n.jsx)("a",{target:"_blank",rel:"noopener noreferrer",className:"Link--inTextBlock",href:"https://docs.github.com/en/copilot/responsible-use-of-github-copilot-features/responsible-use-of-github-copilot-code-review",children:"Copilot"})," ","uses AI. Check for mistakes."]}),(0,n.jsxs)("div",{className:"d-flex flex-direction-column gap-2",children:["copilot"===$.reviewVariantType&&(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(l.Z,{commentUrl:$.url,commentId:$.databaseId?.toString()??""})}),$.reactionGroups&&(0,n.jsx)("div",{className:"d-flex flex-direction-column mt-2",children:(0,n.jsx)(c.P,{ref:ej,reactionGroups:$.reactionGroups,onReact:(e,t)=>{if(!$.databaseId)throw Error("Comment not found");setTimeout(()=>ej.current?.focus(),0),eP({commentDatabaseId:$.databaseId,threadId:ee,reaction:e,viewerHasReacted:t},{onError:()=>{ev(!1),el({type:"error",message:"Failed to react to comment"})}})},canReact:$.viewerCanReact})})]}),en&&(0,n.jsx)(W,{comment:$,commentBodyRef:eD,filePath:H,isOutdated:T,isThreadResolved:O,databaseId:$.databaseId,suggestedChangesConfig:ei,applySuggestedChangesValidationData:en,viewerCanApplySuggestion:er?.viewerCanApplySuggestion})]}),ef&&(0,n.jsx)(g.K,{title:"Delete comment?",confirmButtonContent:"Delete",confirmButtonType:"danger",confirmButtonLoading:eC,onClose:e=>{"confirm"===e?(ex(!0),eA({commentId:$.id,threadId:ee,filePath:H},{onError:()=>{eh(!1),el({type:"error",message:"Failed to delete comment"}),ex(!1)}})):(U&&B?.(U),eh(!1),ex(!1))},children:"Are you sure you want to delete this comment?"})]})]})]})})}try{J.displayName||(J.displayName="ReviewThreadComment")}catch{}},69510:(e,t,i)=>{i.d(t,{XG:()=>l,_l:()=>d});var n=i(65510),r=i(20622),a=i(96379);function s(e){return null!==e&&"object"==typeof e&&"previewInfo"in e}function o(e){return{thread:{id:e.threadId,isResolved:e.isResolved,isOutdated:e.isOutdated,line:e.line,subjectType:e.subjectType,subject:e.subject,commentsData:e.commentsData},previewInfo:{threadId:e.threadId,commentId:e.commentId,path:e.path,threadPreviewComments:e.threadPreviewComments,originalDiffPathUri:e.originalDiffPathUri,firstComment:e.firstComment,subject:e.subject}}}function l(e){return[r.u.threadPreviews,e]}function d({pathName:e,initialData:t}){let{queryFn:i,queryKey:d}=function(e){let t=`${e}/page_data/${r.u.threadPreviews}`;return{queryKey:l(e),queryFn:async()=>{let e=await (0,a.QJ)(t);if(!e.ok)throw Error(`HTTP ${e.status}`);let i=await e.json();return i.length>0&&!s(i[0])?i.map(o):i}}}(e),c=t&&t.length>0&&!s(t[0])?t.map(o):t;return(0,n.U)({queryKey:d,queryFn:i,initialData:c,staleTime:1/0})}},70109:(e,t,i)=>{i.d(t,{S:()=>l});var n=i(74848),r=i(42118),a=i(96540),s=i(76648),o=i(27011);let l=(0,a.forwardRef)(({children:e,...t},i)=>{let{pullRequest:a,repository:l}=(0,s.B)(),d=(0,o.L3)(),c={type:"pull_request",id:{id:a.id},pullRequestNumber:a.number,repository:{databaseId:l.id,nwo:`${l.ownerLogin}/${l.name}`,slashCommandsEnabled:!1},comparison:{startCommitOid:d.selectedRange.baseOid,endCommitOid:d.selectedRange.headOid}};return(0,n.jsx)(r.hF,{...t,ref:i,placeholder:"Leave a comment",actions:e,subject:c,showLabel:!1})});l.displayName="ConversationCommentBox"},71317:(e,t,i)=>{i.d(t,{k:()=>r});var n=i(71315);function r(e,t=0){if(void 0===n.XC)return;let i=n.XC.getElementById("screenReaderAnnouncementDiv")??void 0;if(i||(i=function(){if(void 0===n.XC)return;let e=n.XC.createElement("div");return e.classList.add("sr-only","mt-n1"),e.id="screenReaderAnnouncementDiv",e.setAttribute("role","alert"),e.setAttribute("data-testid","screenReaderAnnouncement"),e.setAttribute("aria-live","assertive"),n.XC.body.appendChild(e),e}()),!i)return;let a=i.textContent===e?`${e}\u00A0`:e;setTimeout(()=>{i&&(i.textContent=a)},t)}},73262:(e,t,i)=>{i.d(t,{K:()=>c});var n=i(74848),r=i(21728),a=i(96540),s=i(21373),o=i(34164),l=i(48505),d=i(18373);function c(e){let t,i,c,u,m=(0,r.c)(21),{automatedComment:f,isButtonDisabled:h,dismissError:p,onDismiss:g,onReopen:b,className:v}=e,[C,x]=(0,a.useState)(!1),{isDismissable:y,isReopenable:L,resourceName:S,toggleButtonLabel:N}=function(e){let t,i=(0,r.c)(6),n=e.isDismissed,a=!n&&e.viewerCanDismiss,s=n&&e.viewerCanReopen,o="alert";e.source===l.vk.CodeQuality&&(o="finding");let d=n?`Reopen ${o}`:`Dismiss ${o}`;return i[0]!==a||i[1]!==n||i[2]!==s||i[3]!==o||i[4]!==d?(t={isDismissed:n,isDismissable:a,isReopenable:s,resourceName:o,toggleButtonLabel:d},i[0]=a,i[1]=n,i[2]=s,i[3]=o,i[4]=d,i[5]=t):t=i[5],t}(f);return m[0]!==f||m[1]!==C||m[2]!==p||m[3]!==g?(t=C&&(0,n.jsx)(d.U,{setOpen:x,count:1,error:p,onSubmit:e=>{let{resolution:t,dismissalComment:i}=e;return g({reason:t,resolutionNote:i},{onSuccess:()=>x(!1)})},delegatedAlertDismissalEnabled:!1,codeSecurity:f.source===l.vk.CodeScanning}),m[0]=f,m[1]=C,m[2]=p,m[3]=g,m[4]=t):t=m[4],m[5]!==v||m[6]!==h||m[7]!==y||m[8]!==S||m[9]!==N?(i=y&&(0,n.jsxs)("div",{className:(0,o.$)("d-flex flex-items-center flex-wrap",v),children:[(0,n.jsx)(s.Q,{"aria-label":N,className:"mr-2",onClick:()=>x(!0),disabled:h,children:N}),(0,n.jsxs)("span",{className:"fgColor-muted f6",children:["Dismissing the ",S," will mark this conversation as resolved."]})]}),m[5]=v,m[6]=h,m[7]=y,m[8]=S,m[9]=N,m[10]=i):i=m[10],m[11]!==v||m[12]!==h||m[13]!==L||m[14]!==b||m[15]!==N?(c=L&&(0,n.jsx)("div",{className:(0,o.$)("d-flex flex-items-center flex-wrap",v),children:(0,n.jsx)(s.Q,{"aria-label":N,onClick:b,disabled:h,children:N})}),m[11]=v,m[12]=h,m[13]=L,m[14]=b,m[15]=N,m[16]=c):c=m[16],m[17]!==t||m[18]!==i||m[19]!==c?(u=(0,n.jsxs)(n.Fragment,{children:[t,i,c]}),m[17]=t,m[18]=i,m[19]=c,m[20]=u):u=m[20],u}try{c.displayName||(c.displayName="BaseAutomatedReviewCommentActions")}catch{}},80081:(e,t,i)=>{i.d(t,{EJ:()=>a,Lm:()=>s,o_:()=>r});let n={USER_CANNOT_APPLY_SUGGESTION:"You do not have permission to apply this suggestion.",PULL_REQUEST_IS_CLOSED:"This suggestion cannot be applied because the pull request is closed.",PULL_REQUEST_IS_IN_MERGE_QUEUE:"This suggestion cannot be applied because the pull request is queued to merge.",IS_OUTDATED:"This suggestion is outdated and cannot be applied.",IS_PENDING:"This suggestion is part of a pending comment and cannot be applied.",IS_RESOLVED:"This suggestion is part of a resolved comment and cannot be applied.",UNCHANGED_CODE:"This suggestion is invalid because no changes were made to the code.",INVALID_RANGE:"Unable to commit due to other pending changes affecting this line.",BATCH_TOO_BIG:"Unable to commit due to too many changes in the batch.",DELETED_LINES:"Unable to apply suggestions on deleted lines.",RANGE_NOT_PROVIDED:"This suggestion does not have a valid line range.",UNABLE_TO_DETERMINE_VALIDITY:"Unable to determine the validity of this suggestion."};function r({suggestedChange:e,isOutdated:t,isPending:i,isResolved:r,pullRequestIsClosed:a,pullRequestIsInMergeQueue:s,userCanApplySuggestion:o,applySuggestedChangesValidationData:l,suggestedChangesConfig:d}){let{lineRange:c}=l;if(t)return{isValid:!1,reason:n.IS_OUTDATED};if(i)return{isValid:!1,reason:n.IS_PENDING};if(r)return{isValid:!1,reason:n.IS_RESOLVED};if(a)return{isValid:!1,reason:n.PULL_REQUEST_IS_CLOSED};if(s)return{isValid:!1,reason:n.PULL_REQUEST_IS_IN_MERGE_QUEUE};if(!o)return{isValid:!1,reason:n.USER_CANNOT_APPLY_SUGGESTION};if(!c)return{isValid:!1,reason:n.RANGE_NOT_PROVIDED};if(!d)return{isValid:!1,reason:n.UNABLE_TO_DETERMINE_VALIDITY};if(!d?.isValidSuggestionRange)return{isValid:!1,reason:n.DELETED_LINES};let u=d?.sourceContentFromDiffLines,m=e.suggestion.join(`
`);return 0!==e.suggestion.length&&m===u?{isValid:!1,reason:n.UNCHANGED_CODE}:{isValid:!0}}function a(e,t){let i={isValid:!1,reason:n.INVALID_RANGE},r={isValid:!1,reason:n.BATCH_TOO_BIG};return t.length>=50?r:t.find(t=>t.threadId===e.threadId)||function(e,t){for(let r of t)if(e.path===r.path){var i,n;return i=e.lineRange,n=r.lineRange,i.endLineNumber>=n.startLineNumber&&i.startLineNumber<=n.endLineNumber}return!1}(e,t)?i:{isValid:!0}}function s(e){if(!e||e.subjectType?.toUpperCase()!=="LINE")return;let t=e.positioning??e.subject;if(!t)return;let i=t.startDiffSide??t.endDiffSide;if(!i||"isOutdated"in t&&t.isOutdated||!t.endLine||!t.endDiffSide)return;let n=t.startLine??t.endLine;return{endLineNumber:t.endLine,endOrientation:t.endDiffSide,startLineNumber:n,startOrientation:i||"RIGHT"}}},82603:(e,t,i)=>{i.d(t,{dG:()=>d,hG:()=>m,o5:()=>c});var n=i(96540),r=i(97286),a=i(65510),s=i(96379),o=i(20622);function l(e){return{queryKey:[o.u.codeowners,e],queryFn:async()=>{let t=`${e}/page_data/${o.u.codeowners}`,i=await (0,s.QJ)(t);if(!i.ok)throw Error(`HTTP ${i.status}`);return await i.json()},staleTime:1/0}}function d({basePath:e,initialData:t}){let{queryFn:i,queryKey:n}=l(e);return(0,r.I)({queryKey:n,queryFn:i,initialData:t,staleTime:1/0})}function c({basePath:e,diffPath:t}){let{queryFn:i,queryKey:r}=l(e);return(0,a.U)({queryKey:r,queryFn:i,staleTime:1/0,select:(0,n.useCallback)(e=>m({codeownersData:e,diffPath:t}),[t])})}let u={isOwnedByViewer:!1,owners:[],ruleLineNumber:void 0,ruleUrl:void 0};function m({diffPath:e,codeownersData:t}){if(!t)return u;let i=t.ownershipByPath[e];return i?{isOwnedByViewer:i.isOwnedByViewer,owners:i.owners||[],ruleLineNumber:i.ruleLineNumber,ruleUrl:i.ruleUrl}:u}},86909:(e,t,i)=>{i.d(t,{YH:()=>x,Gt:()=>C,Vv:()=>w});var n,r=i(74848),a=i(77430),s=i(73017),o=i(38621),l=i(26108),d=i(98552),c=i(69497),u=i(21373),m=i(34164),f=i(48505);let h={annotation:"Annotation-module__annotation--KlX5M",annotationSource:"Annotation-module__annotationSource--fZyli",annotationMessage:"Annotation-module__annotationMessage--gFM9M",inlineReviewThreadHeading:"Annotation-module__inlineReviewThreadHeading--Qj9j8"};var p=i(90274),g=i(96540),b=i(82075),v=i(71315);let C={[f.UZ.Failure]:(0,r.jsx)(o.StopIcon,{className:"fgColor-danger mr-2"}),[f.UZ.Warning]:(0,r.jsx)(o.AlertIcon,{className:"fgColor-attention mr-2"}),[f.UZ.Notice]:(0,r.jsx)(o.InfoIcon,{className:"fgColor-muted mr-2"})};function x({annotation:e,inSidePanel:t}){let i=(0,g.useMemo)(()=>t?"h3":"h2",[t]),{isCollapsed:n,handleToggleCollapsed:f}=w(e);return(0,r.jsxs)("div",{className:(0,m.$)("p-1 bgColor-default",p.GF[e.annotationLevel].borderColor,h.annotation),children:[(0,r.jsxs)("div",{className:"d-flex flex-items-center",children:[!t&&(0,r.jsx)(l.K,{"aria-label":n?"Expand annotation":"Collapse annotation",icon:n?o.ChevronRightIcon:o.ChevronDownIcon,size:"small",variant:"invisible",onClick:f}),!t&&(0,r.jsx)(L,{annotation:e}),t&&(0,r.jsx)(S,{annotation:e})]}),(!n||t)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"ml-4 mt-2",children:e.title&&(0,r.jsx)(d.A,{weight:"semibold",size:"medium",className:p.GF[e.annotationLevel].primaryColorClass,children:e.title})}),(0,r.jsxs)(i,{className:"sr-only",children:[p.GF[e.annotationLevel].ariaLabel,": ",e.title]}),(0,r.jsx)("div",{className:"mb-3 mt-1 ml-4",children:e.message&&(0,r.jsx)(s.$6,{html:e.message,className:h.annotationMessage})}),(0,r.jsxs)("div",{className:"d-flex flex-items-center flex-justify-between ml-4 pr-2 pb-2",children:[(0,r.jsxs)("div",{className:h.annotationSource,children:[(0,r.jsx)(a.r,{src:e.appAvatarUrl,alt:e.appAvatarAltText}),(0,r.jsxs)(c.A,{className:"ml-2",maxWidth:"300px",inline:!0,title:`${e.checkSuiteName} / ${e.checkRun.name}`,children:[(0,r.jsx)(d.A,{weight:"semibold",size:"small",children:e.checkSuiteName})," ","/ ",(0,r.jsx)(d.A,{size:"small",children:e.checkRun.name})]})]}),e.checkRun.detailsUrl&&(0,r.jsx)(u.Q,{as:"a",href:e.checkRun.detailsUrl,size:"small",children:"View details"})]})]})]})}function y({children:e}){return(0,r.jsx)("span",{className:"text-semibold fgColor-default",children:e})}function L({annotation:e}){return(0,r.jsxs)("h2",{className:h.inlineReviewThreadHeading,children:[C[e.annotationLevel],p.GF[e.annotationLevel].ariaLabel," on line"," ",(0,r.jsxs)(y,{children:["R",e.endLine]})]})}function S({annotation:e}){return(0,r.jsx)("div",{className:(0,m.$)(h.inlineReviewThreadHeading,"ml-4","pt-1","pl-0"),children:(0,r.jsx)(y,{children:p.GF[e.annotationLevel].ariaLabel})})}function N(e){return`AnnotationIsCollapsed_${e.path}_${e.endLine}_${e.annotationLevel}_${e.title}`}function w(e){let t=(0,b.A)("localStorage"),[i,n]=(0,g.useState)(!1);return(0,g.useEffect)(()=>{let t=localStorage.getItem(N(e));null!==t&&n(JSON.parse(t))},[e]),{isCollapsed:i,handleToggleCollapsed:()=>{v.cg?.requestAnimationFrame(()=>{t.setItem(N(e),JSON.stringify(!i))}),n(e=>!e)}}}try{x.displayName||(x.displayName="Annotation")}catch{}try{(n=AnnotationHeadingTag).displayName||(n.displayName="AnnotationHeadingTag")}catch{}try{y.displayName||(y.displayName="Emphasis")}catch{}try{L.displayName||(L.displayName="AnnotationBanner")}catch{}try{S.displayName||(S.displayName="SidePanelAnnotationBanner")}catch{}},87459:(e,t,i)=>{i.d(t,{oO:()=>nB,Ao:()=>nF,Yf:()=>B.Yf});var n=i(74848),r=i(50683),a=i(96540),s=i(36729),o=i(77430),l=i(38621),d=i(81960),c=i(26108),u=i(53627);function m(e,t="r"){(0,u.Zu)(`#${t}${e}`)}var f=i(91835),h=i(71315),p=i(83494),g=i(50625),b=i(93642);let v={AddCommentEditor:"AddCommentEditor-module__AddCommentEditor--JFfip"};var C=i(70109),x=i(27011),y=i(71317);let L={COMMENT:"comment",REVIEW:"review"};function S({batchingEnabled:e,condensed:t,fileLevelComment:i,filePath:r,focusOnMount:s,isReplying:o,lineNumber:l,onAddComment:d,onCancelComment:c,onPersistedCommentExists:u,quotedText:m="",side:S,startLineNumber:N,subjectId:w,threadId:D,suggestedChangesConfig:j}){let[I,k]=(0,a.useState)(m),[_,A]=(0,a.useState)(null),E=(0,a.useRef)(m),[R,T]=(0,a.useState)(),O=(0,a.useRef)(null),M=(0,a.useRef)(null),P=(0,x.it)(),$=(0,a.useCallback)(e=>{(0,y.k)(e??"",100),T(e)},[T]),F=null!==_,{persistCommentToStorage:B,removePersistedCommentFromStorage:H}=(0,g.L)({diffSide:S,filePath:r,line:l,subjectId:w,threadId:D,handlePersistedCommentExists:({text:e})=>{e&&(k(e),u?.())},fileLevelComment:!!i});(0,a.useEffect)(()=>{m!==E.current&&(E.current=m,k(m))},[m]),(0,a.useEffect)(()=>{if(s){let e=setTimeout(()=>{if(h.XC&&h.cg){if(M.current){let e=M.current,t=e.getBoundingClientRect(),i=h.XC?.documentElement.clientHeight||0;if(!(t.top>=0&&t.bottom<=(h.cg?.innerHeight||i))){let n=t.top,r=h.XC?.documentElement.getBoundingClientRect().top||0,a=e.clientHeight*(2/3);h.cg?.scrollTo({top:n-r-2/3*i+a,behavior:"smooth"})}}O.current&&(O.current.focus(),O.current.moveCursorToEnd())}},100);return()=>{window.clearTimeout(e)}}},[s]);let U=({submitBatch:e,action:t})=>{let i="Failed to save comment";if(F)return;if(!I.trim())return void $(`${i}: Body can't be blank`);A(t),T(void 0),$(void 0);let n=(0,b.u)(I,j?.sourceContentFromDiffLines??"");if(!n.isValid){$(n.errorMessage),T(n.errorMessage),A(null);return}d?.({commentText:I,onCompleted(){A(null),V()},onError(e){A(null),e.message&&(i=`${i}: ${e.message}`),$(i)},submitBatch:e})},G=()=>{U({submitBatch:!1,action:L.REVIEW})},K=()=>{U({submitBatch:!0,action:L.COMMENT})},V=(0,a.useCallback)(()=>{H(),k(""),c?.()},[c,H]),q={footer:{justifyContent:o?"end":"space-between","> div:first-child":{display:t||o?"none":"flex"},...t&&{"> div:last-child":{display:"flex",flexDirection:"column",width:"100%"}}}};return(0,n.jsx)(p.tL,{commands:{"pull-requests-conversations:submit-comment-and-review":K},children:(0,n.jsx)("div",{className:v.AddCommentEditor,onKeyDown:e=>{"Escape"!==e.key||I.trim()?e.stopPropagation():(e.preventDefault(),V())},children:(0,n.jsxs)(C.S,{ref:O,label:"Add diff comment",sx:q,value:I,onChange:e=>{$(void 0),B({text:e}),k(e)},onPrimaryAction:e?G:K,suggestedChangesConfig:j,markdownErrorMessage:R,lineNumber:l,filePath:r,startLineNumber:N,disabled:F,children:[c&&(0,n.jsx)(f.x,{className:"py-1 px-2",variant:"default",onClick:V,children:"Cancel"}),!P&&(0,n.jsx)(f.x,{className:"py-1 px-2",variant:e?"default":"primary",onClick:K,ref:M,loading:_===L.COMMENT,children:o?"Reply":"Comment"}),e&&(0,n.jsx)(f.x,{className:"py-1 px-2",variant:"primary",onClick:G,loading:_===L.REVIEW,children:P?"Add review comment":"Start a review"})]})})})}try{S.displayName||(S.displayName="AddCommentEditor")}catch{}function N({addCommentDialogTitle:e,isLeftSide:t,fileLevelComment:i,filePath:r,focusOnMount:a=!0,lineNumber:s,onAddComment:u,onClose:f,viewerData:h,threadsConnectionId:p,showOnCloseIcon:g=!0,...b}){return(0,n.jsxs)("div",{className:"px-2 pb-2 pt-1",children:[(0,n.jsxs)("div",{className:"d-flex flex-justify-between flex-items-center",children:[(0,n.jsxs)(d.A,{as:"h4",className:"f5 ml-1 pt-1 pb-2",children:[(0,n.jsx)(o.r,{alt:h.login,size:24,src:h.avatarUrl||"",className:"mr-2"}),i?(0,n.jsx)(n.Fragment,{children:"Add comment on file"}):(0,n.jsx)("span",{children:e??"Add a comment"})]}),f&&g&&(0,n.jsx)(c.K,{variant:"invisible",icon:l.XIcon,onClick:f,"aria-label":"Cancel"})]}),(0,n.jsx)(S,{focusOnMount:a,condensed:!1,fileLevelComment:i??!1,filePath:r,lineNumber:s,onAddComment:({commentText:e,onCompleted:t,onError:i,submitBatch:n})=>{u({text:e,onError:i,onCompleted:(e,i)=>{i&&m(i.toString()),t?.(e,i)},submitBatch:n})},onCancelComment:f,side:t?"LEFT":"RIGHT",...b})]})}try{N.displayName||(N.displayName="StartThreadComment")}catch{}var w=i(33671),D=i(8934),j=i(97286),I=i(73017),k=i(69726);let _={fileRendererViewport:"RichDiff-module__fileRendererViewport--EBwd1",fileRendererIframe:"RichDiff-module__fileRendererIframe--svTsY"};function A({queryConfig:e,initialData:t}){let i;t&&(t.proseDiffHtml||t.renderInfo||t.dependencyDiffPath)&&(i={proseDiffHtml:t.proseDiffHtml,renderInfo:t.renderInfo,dependencyDiffPath:t.dependencyDiffPath});let r=(0,j.I)({queryKey:[e?.key,e?.args],queryFn:async()=>await e?.fetcher(e.args)||{},initialData:i,staleTime:1/0,enabled:!!e}),{data:a,isLoading:s}=e?r:{data:i,isLoading:!1},{proseDiffHtml:o,renderInfo:l,dependencyDiffPath:d}=a||{};return s?(0,n.jsx)("div",{className:"d-flex flex-justify-center p-4",children:(0,n.jsx)(k.A,{size:"large"})}):o?(0,n.jsx)("div",{className:"prose-diff position-relative",children:(0,n.jsx)(I.vb,{html:o})}):l?(0,n.jsx)(w.default,{...l,viewportClassName:_.fileRendererViewport,iframeClassName:_.fileRendererIframe}):d?(0,n.jsx)("div",{children:(0,n.jsx)(D.x,{src:d,children:(0,n.jsxs)("div",{className:"text-center py-3",children:[(0,n.jsx)(k.A,{size:"medium"}),(0,n.jsx)("p",{className:"color-fg-muted my-2",children:"Loading Dependency Review..."})]})})}):(0,n.jsx)("div",{className:"d-flex flex-justify-center p-4",children:"This rich diff is not supported at the moment."})}try{A.displayName||(A.displayName="RichDiff")}catch{}var E=i(59523),R=i(19976),T=i(13083),O=i(57352),M=i(34164),P=i(21373);let $={gridColumnTemplate:"HiddenDiffPatch-module__gridColumnTemplate--gSfuk"};function F({children:e,helpText:t,helpUrl:i,onLoadDiff:r,diffAnchor:s}){let o=i&&t,[d,c]=(0,a.useState)("initial"),u=(0,a.useCallback)(async()=>{try{c("loading"),await r()}catch{c("error")}},[r,c]);return(0,n.jsx)("div",{className:"px-3 py-4 fgColor-muted","data-diff-anchor":s,children:(0,n.jsxs)("div",{className:(0,M.$)($.gridColumnTemplate),children:[(0,n.jsx)("svg",{"aria-hidden":!0,height:"84",style:{maxWidth:"340px"},viewBox:"0 0 340 84",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{clipPath:"url(#diff-placeholder)",d:"M0 0h340v84H0z",fillRule:"evenodd",style:{fill:"var(--bgColor-muted, var(--color-canvas-subtle))"}})})," ",(0,n.jsxs)("div",{className:"d-flex flex-justify-center flex-column flex-column text-center flex-items-center",children:["loading"===d&&(0,n.jsx)(k.A,{size:"medium"}),"error"===d&&(0,n.jsx)(l.AlertIcon,{size:24}),"initial"===d&&(0,n.jsx)(P.Q,{className:"h4 mx-auto fgColor-accent",variant:"invisible",onClick:()=>{u(),c("loading")},children:"Load Diff"}),"error"===d?(0,n.jsxs)("span",{className:"fgColor-muted mt-1",children:["The contents of the file couldn't be loaded."," ",(0,n.jsx)(O.A,{inline:!0,as:"button",onClick:()=>{u(),c("loading")},children:"Retry"})]}):(0,n.jsxs)("span",{className:"fgColor-muted mt-1",children:[e,o&&(0,n.jsx)(O.A,{inline:!0,href:i,children:t})]})]})]})})}try{F.displayName||(F.displayName="HiddenDiffPatch")}catch{}var B=i(3038);let H={finalLineId:"final-hunk-header-line"};function U(e,t){return e.startBlobLineNumber-t.startBlobLineNumber}function G(e,t){if("HUNK"===e.type&&e.__id===H.finalLineId)return{currentHunk:t[t.length-1],previousHunk:t[t.length-2]};let i=t.sort(U).findIndex(t=>t.startBlobLineNumber<=e.blobLineNumber&&t.endBlobLineNumber>=e.blobLineNumber);return{currentHunk:t[i],nextHunk:t[i+1],previousHunk:t[i-1]}}function K(e){let t,i=[],n=0;for(let r=1;r<e.length;r++){let a=e[r];if(a&&!(0,B.Po)(a)&&(t=a,"HUNK"===a.type)){let t,s=e[n];if(!s||(0,B.Po)(s))continue;let o=r-1;for(;(!t||(0,B.Po)(t))&&(t=e[o],-1!=--o););t&&!(0,B.Po)(t)&&i.push({startBlobLineNumber:s.blobLineNumber,endBlobLineNumber:t.blobLineNumber}),a.__id===H.finalLineId&&i.push({startBlobLineNumber:a.blobLineNumber,endBlobLineNumber:a.blobLineNumber+20}),n=r;continue}}if(t&&"HUNK"!==t.type){let r=e[n];r&&!(0,B.Po)(r)&&i.push({startBlobLineNumber:r.blobLineNumber,endBlobLineNumber:t.blobLineNumber})}return i}var V=i(45800),q=i(35750),W=i(18150),z=i(85242),X=i(88243),Q=i(16213),J=i(50467),Y=i(51391),Z=new WeakMap,ee=new WeakMap,et=new WeakMap,ei=new WeakMap,en=new WeakMap,er=new WeakMap,ea=new WeakSet,es=new WeakSet,eo=new WeakSet,el=new WeakSet,ed=new WeakSet,ec=new WeakSet,eu=new WeakSet,em=new WeakSet,ef=new WeakSet,eh=new WeakSet;let GridNavigator=class GridNavigator{moveToNextItem(e,t){let i,n=(0,q._)(this,ee).get(this.focusedGridCell?.cellId??"");if(!n)return;let[r]=n,[,a]=n;switch(("ArrowDown"===e||"ArrowUp"===e)&&(0,X._)(this,eu,ey).call(this,r)&&(0,q._)(this,ei)&&(a=(0,q._)(this,ei),(0,z._)(this,ei,void 0)),!0){case t&&"Home"===e:this.focusFirstGridCell();break;case t&&"End"===e:{let e=(0,q._)(this,Z).length-1,t=(0,q._)(this,Z)[e]?.length;t&&(i=(0,q._)(this,Z)[e]?.[t-1]);break}case"ArrowUp"===e:(0,X._)(this,eu,ey).call(this,r-1)?((0,X._)(this,eh,eN).call(this,a),i=(0,q._)(this,Z)[r-1]?.[0]):i=(0,q._)(this,Z)[r-1]?.[a];break;case"ArrowDown"===e:(0,X._)(this,eu,ey).call(this,r+1)?((0,X._)(this,eh,eN).call(this,a),i=(0,q._)(this,Z)[r+1]?.[0]):i=(0,q._)(this,Z)[r+1]?.[a];break;case"ArrowLeft"===e:i=(0,q._)(this,Z)[r]?.[a-1];break;case"ArrowRight"===e:i=(0,q._)(this,Z)[r]?.[a+1];break;case"PageUp"===e:{(0,X._)(this,eh,eN).call(this,a);let e=(0,X._)(this,eo,eb).call(this,r);i=(0,q._)(this,Z)[e]?.[0];break}case"PageDown"===e:{(0,X._)(this,eh,eN).call(this,a);let e=(0,X._)(this,es,eg).call(this,r),t=0;e||(e=(0,q._)(this,Z).length-1,t=a),i=(0,q._)(this,Z)[e]?.[t];break}case"Home"===e:i=(0,q._)(this,Z)[r]?.[0];break;case"End"===e:{let e=(0,q._)(this,Z)[r];if(e&&!(0,X._)(this,eu,ey).call(this,r)){let t=e.length-1;i=(0,q._)(this,Z)[r]?.[t]}}}return i&&(this.focusedGridCell=i),this.focusedGridCell}reinitializeGrid(e,t){(0,X._)(this,el,ev).call(this,e,t)}focusFirstGridCell(e){e&&(0,q._)(this,ee).get(e)?this.focusGridCell(e):this.focusedGridCell=(0,q._)(this,Z)[0]?.[0]}focusGridCell(e){if(this.focusedGridCell?.cellId===e)return;let t=(0,q._)(this,ee).get(e);if(!t)return;let[i,n]=t;this.focusedGridCell=(0,q._)(this,Z)[i]?.[n]}getNextSelectableCell(e){let t,i=this.getValidSelectableRowCell()||this.focusedGridCell,n=this.lastSelectedGridCell||i,r=(0,q._)(this,ee).get(n?.cellId??"");if(!r)return;let[a,s]=r;if("ArrowUp"===e){let e=a-1;for(;!t&&e>=0;)t=(0,X._)(this,ea,ep).call(this,{rowIndex:e,columnIndex:s}),e--}if("ArrowDown"===e){let e=a+1;for(;!t&&e<(0,q._)(this,Z).length;)t=(0,X._)(this,ea,ep).call(this,{rowIndex:e,columnIndex:s}),e++}return t&&(this.lastSelectedGridCell=t),t}getValidSelectableRowCell(){if(this.focusedGridCell?.isHunk)return;if(!this.focusedGridCell?.isEmpty)return this.focusedGridCell;let e=(0,q._)(this,ee).get(this.focusedGridCell.cellId)?.[0];if(e)return this.focusedGridCell.columnIndex<=1&&!(0,q._)(this,er)?(0,q._)(this,Z)[e]?.[this.focusedGridCell.columnIndex+1]:this.focusedGridCell.columnIndex<2&&(0,q._)(this,er)?(0,q._)(this,Z)[e]?.[this.focusedGridCell.columnIndex+2]:(0,q._)(this,Z)[e]?.[this.focusedGridCell.columnIndex-2]}clearLastSelectedCell(){this.lastSelectedGridCell=void 0}getFirstCodeCell(){let e=(0,q._)(this,Z).find(e=>e[0]&&!e[0].isHunk);return e?.find(e=>!e.isEmpty)}getLastCodeCell(){let e=(0,q._)(this,Z).slice().reverse().find(e=>e[0]&&!e[0].isHunk);return e?.slice().reverse().find(e=>!e.isEmpty)}hasLine(e,t,i){let n=(0,B.qX)((0,q._)(this,en),e,t),r=(0,B.u6)(n,0),a=(0,q._)(this,ee).get(r);if(!a)return!1;let[s]=a;return!!i===(0,X._)(this,eu,ey).call(this,s)}constructor(e,t,i,n,r){(0,Q._)(this,ea),(0,Q._)(this,es),(0,Q._)(this,eo),(0,Q._)(this,el),(0,Q._)(this,ed),(0,Q._)(this,ec),(0,Q._)(this,eu),(0,Q._)(this,em),(0,Q._)(this,ef),(0,Q._)(this,eh),(0,W._)(this,Z,{writable:!0,value:[]}),(0,W._)(this,ee,{writable:!0,value:new Map}),(0,W._)(this,et,{writable:!0,value:new Set}),(0,J._)(this,"focusedGridCell",void 0),(0,J._)(this,"lastSelectedGridCell",void 0),(0,W._)(this,ei,{writable:!0,value:void 0}),(0,W._)(this,en,{writable:!0,value:void 0}),(0,W._)(this,er,{writable:!0,value:void 0}),(0,z._)(this,en,e),(0,z._)(this,er,t),(0,X._)(this,el,ev).call(this,i,n),this.focusFirstGridCell(r)}};function ep({rowIndex:e,columnIndex:t}){let i=(0,q._)(this,Z)[e],n=i?.[t];switch(!0){case n?.isHunk:return;case n?.orientation==="left"&&n.isEmpty:return i?.[t+2];case n?.orientation==="right"&&n.isEmpty&&(0,q._)(this,er):return i?.[t-2];case n?.orientation==="right"&&n.isEmpty&&!(0,q._)(this,er):return i?.[t+1];default:return i?.[t]}}function eg(e){return Array.from((0,q._)(this,et)).sort((e,t)=>e-t).find(t=>t>e)}function eb(e){return Array.from((0,q._)(this,et)).sort((e,t)=>e-t).reverse().find(t=>t<e)??0}function ev(e,t){(0,z._)(this,Z,[]),(0,z._)(this,ee,new Map),(0,z._)(this,et,new Set);for(let i=0;i<e.length;i++){let n=[],r=e[i];if(void 0!==r){if((0,q._)(this,er)){let e=(t||[])[i],a=(0,B.qX)((0,q._)(this,en),r,e);(0,B.Po)(r)||"HUNK"!==r.type?(0,X._)(this,em,eL).call(this,{leftLine:r,rightLine:e,row:n,rowIdentifier:a,rowIndex:i}):(0,X._)(this,ec,ex).call(this,n,a,i,r)}else{let e=(0,B.qX)((0,q._)(this,en),r,r);(0,B.Po)(r)||"HUNK"!==r.type?(0,X._)(this,ef,eS).call(this,{diffLine:r,row:n,rowIdentifier:e,rowIndex:i}):(0,X._)(this,ec,ex).call(this,n,e,i,r)}(0,q._)(this,Z).push(n)}}}function eC({cellIndex:e,diffLine:t,orientation:i,row:n,rowIdentifier:r,rowIndex:a,isSplit:s}){let o,l,d=(0,B.u6)(r,e);l=!(s||(0,B.Po)(t))&&t?.type==="DELETION"&&1===e||!(s||(0,B.Po)(t))&&t?.type==="ADDITION"&&0===e||(0,B.Po)(t),(0,B.Po)(t)||"left"!==i||(o=t?.left),(0,B.Po)(t)||"right"!==i||(o=t?.right),n.push({lineNumber:o,orientation:i,isEmpty:l,isHunk:!1,cellId:(0,B.u6)(r,e),columnIndex:e,lineKey:!(0,B.Po)(t)&&t?(0,Y.bo)(t):void 0}),(0,q._)(this,ee).set(d,[a,e])}function ex(e,t,i,n){let r=(0,B.u6)(t,0);e.push({isHunk:!0,isEmpty:!1,cellId:r,columnIndex:0,lineKey:(0,Y.bo)(n)}),(0,q._)(this,ee).set(r,[i,0]),(0,q._)(this,et).add(i)}function ey(e){return(0,q._)(this,et).has(e)}function eL({leftLine:e,rightLine:t,row:i,rowIdentifier:n,rowIndex:r}){(0,X._)(this,ed,eC).call(this,{cellIndex:0,diffLine:e,orientation:"left",row:i,rowIdentifier:n,rowIndex:r,isSplit:!0}),(0,X._)(this,ed,eC).call(this,{cellIndex:1,diffLine:e,orientation:"left",row:i,rowIdentifier:n,rowIndex:r,isSplit:!0}),(0,X._)(this,ed,eC).call(this,{cellIndex:2,diffLine:t,orientation:"right",row:i,rowIdentifier:n,rowIndex:r,isSplit:!0}),(0,X._)(this,ed,eC).call(this,{cellIndex:3,diffLine:t,orientation:"right",row:i,rowIdentifier:n,rowIndex:r,isSplit:!0})}function eS({diffLine:e,row:t,rowIdentifier:i,rowIndex:n}){let r=(0,B.Po)(e)||"DELETION"!==e.type?"right":"left";(0,X._)(this,ed,eC).call(this,{cellIndex:0,diffLine:e,orientation:"left",row:t,rowIdentifier:i,rowIndex:n,isSplit:!1}),(0,X._)(this,ed,eC).call(this,{cellIndex:1,diffLine:e,orientation:"right",row:t,rowIdentifier:i,rowIndex:n,isSplit:!1}),(0,X._)(this,ed,eC).call(this,{cellIndex:2,diffLine:e,orientation:r,row:t,rowIdentifier:i,rowIndex:n,isSplit:!1})}function eN(e){(0,X._)(this,eu,ey).call(this,e)||(0,z._)(this,ei,e)}function ew(e){e&&setTimeout(()=>{0!==e.tabIndex&&(e.tabIndex=0)})}var eD=i(11683);let ej={ArrowLeft:eD.z0.ArrowHorizontal,ArrowDown:eD.z0.ArrowVertical,ArrowUp:eD.z0.ArrowVertical,ArrowRight:eD.z0.ArrowHorizontal,h:eD.z0.HL,j:eD.z0.JK,k:eD.z0.JK,l:eD.z0.HL,a:eD.z0.AD,s:eD.z0.WS,w:eD.z0.WS,d:eD.z0.AD,Tab:eD.z0.Tab,Home:eD.z0.HomeAndEnd,End:eD.z0.HomeAndEnd,PageUp:eD.z0.PageUpDown,PageDown:eD.z0.PageUpDown,Backspace:eD.z0.Backspace},eI=eD.z0.ArrowAll|eD.z0.PageUpDown|eD.z0.HomeAndEnd|eD.z0.AD,ek={ghostUser:{avatarUrl:"https://avatars.githubusercontent.com/ghost",id:"ghost",login:"ghost",url:"/ghost",__typename:"Author"}};var e_=i(61583),eA=i(4559);function eE({diffAnchor:e,endLineNumber:t,endOrientation:i,startLineNumber:n,startOrientation:r}){if(n&&t){var a;(0,e_.i8)({diffAnchor:e,endLineNumber:t,endOrientation:i,startLineNumber:n,startOrientation:r}),(a={diffAnchor:e,endLineNumber:t,endOrientation:i,startLineNumber:n,startOrientation:r}).startLineNumber===a.endLineNumber&&a.startOrientation===a.endOrientation?(0,eA.i)(`${"left"===a.startOrientation?"L":"R"}${a.startLineNumber} selected.`):(0,eA.i)(`${"left"===a.startOrientation?"L":"R"}${a.startLineNumber} to ${"left"===a.endOrientation?"L":"R"}${a.endLineNumber} selected.`)}}function eR(e){return e in ej&&(ej[e]&eI)>0}function eT({addLineToSelection:e,clearSelectedLines:t,containerRef:i,fileAnchor:n,getfirstLineSelectionOnDrag:r,isSplitDiff:s,leftLines:o,rightLines:l,selectMultipleLines:d,disabled:c}){var u;let m=(0,a.useRef)(void 0),f=(0,a.useMemo)(()=>new GridNavigator(n,s,o,l,m.current?.focusedGridCell?.cellId),[n,s,o,l]);(0,a.useEffect)(()=>{m.current=f},[f]),(0,a.useEffect)(()=>{let e=i.current,t=()=>{f.clearLastSelectedCell()};return e?.addEventListener("mousedown",t),()=>e?.removeEventListener("mousedown",t)},[i,f]),u=m.current,(0,a.useEffect)(()=>{if(u&&document.activeElement){let e=function(e,t,i){let n=[];for(let r=0;r<t.length;r++){let a=t[r],s=i?.[r]??a,o=!(0,B.Po)(a)&&a?.type==="HUNK";a&&s&&!e.hasLine(a,s,o)&&n.push(a)}return n}(u,o,l);if(0!==e.length){if(document.activeElement===document.body){let t,i,r,a=o.indexOf(e[e.length-1]),s=o[a+1],l=e[0];s&&!(0,B.Po)(s)&&"HUNK"===s.type&&(t=(0,B.u6)((0,B.qX)(n,s,s),0),i=document.querySelector(`[data-grid-cell-id=${t}]`),r=i?.querySelector("button[data-direction=down], button[data-direction=all]")),r||(t=(0,B.u6)((0,B.qX)(n,l,l),0),i=document.querySelector(`[data-grid-cell-id=${t}]`),r=i?.querySelector("button[data-direction=up], button[data-direction=all]")),t&&i&&(r?r.focus():i.focus(),f.focusGridCell(t),ew(i))}else if("BUTTON"===document.activeElement.tagName)ew(document.activeElement.closest("td"));else if("TD"===document.activeElement.tagName){let e=document.activeElement.getAttribute("data-grid-cell-id"),t=f.focusedGridCell?.cellId;if(e!==t){let e=i.current?.querySelector(`[data-grid-cell-id=${t}]`);e?.focus()}}}}},[n,o,f,l,u,i]);let h=(0,a.useCallback)(e=>{let t=e.target.getAttribute("data-grid-cell-id");t&&f.focusGridCell(t)},[f]);(0,a.useEffect)(()=>{let e=i.current;return e?.addEventListener("focusin",h),()=>e?.removeEventListener("focusin",h)},[i,h]);let p=(0,a.useCallback)((i,n,a)=>{let s=f.getValidSelectableRowCell();switch(!0){case(a.metaKey||a.ctrlKey)&&"KeyA"===a.code:{let e=f.getFirstCodeCell(),t=f.getLastCodeCell();if(!e||!t)return n;return e.lineKey&&e.lineNumber&&e.orientation&&d({endLineKey:t.lineKey,endOrientation:t.orientation,startLineKey:e.lineKey,startOrientation:e.orientation,firstLineSelectionOnDrag:{lineKey:e.lineKey,lineNumber:e.lineNumber,orientation:e.orientation,shouldStartConversation:!1}},eE),n}case a.shiftKey&&"ArrowDown"===a.key:{let t=f.getNextSelectableCell("ArrowDown");if(!t||!s)return n;return r()?e({lineKey:t.lineKey,orientation:t.orientation},eE):s.lineKey&&s.lineNumber&&s.orientation&&d({endLineKey:t.lineKey,endOrientation:t.orientation,startLineKey:s.lineKey,startOrientation:s.orientation,firstLineSelectionOnDrag:{lineKey:s.lineKey,lineNumber:s.lineNumber,orientation:s.orientation,shouldStartConversation:!1}},eE),eO(t.cellId),n}case a.shiftKey&&"ArrowUp"===a.key:{let t=f.getNextSelectableCell("ArrowUp");if(!t||!s)return n;return r()?e({lineKey:t.lineKey,orientation:t.orientation},eE):s.lineKey&&s.lineNumber&&s.orientation&&d({endLineKey:s.lineKey,endOrientation:s.orientation,startLineKey:t.lineKey,startOrientation:t.orientation,firstLineSelectionOnDrag:{lineKey:s.lineKey,lineNumber:s.lineNumber,orientation:s.orientation,shouldStartConversation:!1}},eE),eO(t.cellId),n}case"ArrowLeft"===a.key&&a.metaKey&&a.shiftKey:return n;default:{let e=f.moveToNextItem(a.key,a.ctrlKey),i=e&&document.querySelector(`[data-grid-cell-id=${e.cellId}]`);return t(),f.clearLastSelectedCell(),i??void 0}}},[e,r,f,d,t]);return(0,V.G)({containerRef:i,bindKeys:eI,getNextFocusable:p,focusableElementFilter:e=>"TD"===e.tagName&&"gridcell"===e.getAttribute("role"),focusInStrategy:"previous",disabled:c},[p]),{gridNavigator:f}}function eO(e){let t=h.XC?.querySelector(`[data-grid-cell-id=${e}]`);!function(e){if(!h.XC||!h.cg||!e)return!1;let t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(h.cg.innerHeight||h.XC.documentElement.clientHeight)&&t.right<=(h.cg.innerWidth||h.XC.documentElement.clientWidth)}(t)&&t?.scrollIntoView({block:"nearest",inline:"nearest"})}var eM=i(21537),eP=i(71323),e$=i(97283),eF=i(87134),eB=i(36472),eH=i(13814);let eU=(0,a.createContext)(null);function eG(e){let t=(0,a.useContext)(eU);if(!t)throw Error("Missing DiffStoreProvider in the tree");return(0,eP.P)(t,e)}let eK=({children:e,...t})=>{let i=(0,a.useRef)(null),r=(0,a.useRef)(t.diffLines),s=(0,a.useRef)(t.isSplitView),o=(0,a.useRef)(t.hiddenFeatures);return i.current||(i.current=eV(t)),(0,a.useEffect)(()=>{i.current&&r.current.length!==t.diffLines.length&&(i.current.getState().diffLinesSliceUpdates.updateDiffLinesHash(t.diffLines),r.current=t.diffLines)},[t,t.diffLines]),(0,a.useEffect)(()=>{i.current&&s.current!==t.isSplitView&&(i.current.getState().diffLinesSliceUpdates.updateDiffView(t.isSplitView),s.current=t.isSplitView)},[t,t.isSplitView]),(0,a.useEffect)(()=>{i.current&&!function(e,t){if(e.size!==t.size)return!1;for(let i of e)if(!t.has(i))return!1;return!0}(o.current,t.hiddenFeatures)&&(i.current.setState({hiddenFeatures:t.hiddenFeatures}),o.current=t.hiddenFeatures)},[t,t.hiddenFeatures]),(0,n.jsx)(eU.Provider,{value:i.current,children:e})},eV=e=>(0,e$.y)()((0,eF.lt)((...t)=>({...(e=>({dialogMode:{activeGridCellId:null},dialogModeActions:{enableDialogMode:t=>e(()=>({dialogMode:{activeGridCellId:t}}),void 0,"dialogMode#enabled"),disableDialogMode:()=>e(()=>({dialogMode:{activeGridCellId:null}}),void 0,"dialogMode#disabled")}}))(...t),...(({diffAnchor:e,path:t,diffLines:i,fileLineCount:n,isSplitView:r})=>(a,s)=>{let o=i.reduce((e,t)=>(e[(0,Y.bo)(t)]=t,e),{}),{selectedLineKeys:l,selectedLineRange:d,startOrientation:c}=(0,Y.EV)({diffAnchor:e,diffLines:i,isSplitView:r,lineRange:(0,Y.KV)(e)}),u=(0,Y.Aj)(l),m=(0,Y.sB)(l),f=i.reduce((e,t)=>{let i=(0,Y.bo)(t);return l.has((0,Y.bo)(t))&&(e[i]={isSelected:!0,isFirstSelected:u===i,isLastSelected:m===i}),e},{}),p=null;if(u){let e=o[u];if(e&&c){let t="left"===c?e.left:e.right;t&&(p={lineNumber:t,orientation:c,shouldStartConversation:!1,lineKey:(0,Y.bo)(e)})}}return{diffLines:{diffAnchor:e,_diffLines:i,_diffLinesHash:o,selectedLinesInfo:f,fileLineCount:n,firstLineSelectionOnDrag:p,_firstSelectedLineInfo:p?{lineKey:p.lineKey,lineNumber:p.lineNumber,orientation:p.orientation}:null,getDiffLinesInfo:()=>s().diffLines._diffLines,getSplitDiffLinesFromLineRange:e=>{let t=(0,B.Mk)(s().diffLines._diffLines),i=t.leftLines,n=t.rightLines;return(0,eB.A)({selectedLineRange:e,leftLines:i,rightLines:n})},getSelectedDiffLines:()=>{let e=[];for(let t of s().diffLines.selectedLineKeys){let i=s().diffLines._diffLinesHash[t];i&&e.push(i)}return e},getfirstLineSelectionOnDrag:()=>s().diffLines.firstLineSelectionOnDrag,getSelectedLineRange:()=>s().diffLines.selectedLineRange,hasSelectedLines:()=>s().diffLines.selectedLineKeys.size>0,isSplitView:r,selectedLineKeys:l,selectedLineRange:d},diffLinesSliceUpdates:{updateDiffLinesHash:e=>{let t=e.reduce((e,t)=>(e[(0,Y.bo)(t)]=t,e),{});a(i=>({diffLines:{...i.diffLines,_diffLines:e,_diffLinesHash:t}}),void 0,"updateDiffLines")},updateDiffView:e=>a(t=>({diffLines:{...t.diffLines,isSplitView:e}}),void 0,"update diff view settings")},diffLinesActions:{clearFirstLineSelectionOnDrag:()=>a(e=>({diffLines:{...e.diffLines,firstLineSelectionOnDrag:null}}),void 0,"clearFirstLineSelectionOnDrag"),addLineToSelection:({lineKey:i,orientation:n},r)=>{let o;if(!i)return;let l=s().diffLines._diffLinesHash[i];if(!l)return;let d=s().diffLines.firstLineSelectionOnDrag,c=s().diffLines._firstSelectedLineInfo,u=s().diffLines.selectedLineRange;if(d&&i===d.lineKey||!u){let e="right"===n?l.right:l.left;if(!e)return;s().diffLinesActions.selectLine({lineKey:i,firstLineSelectionOnDrag:{lineNumber:e,orientation:n,lineKey:i,shouldStartConversation:!1}},r);return}if(!c)return;let m=s().diffLines._diffLinesHash[c.lineKey];o=(0,Y.M6)({current:l,currentOrientation:n,previous:m,previousOrientation:c.orientation})?{...u,startLineNumber:("left"===n?l?.left:l?.right)??-1,startOrientation:n,endLineNumber:c.lineNumber,endOrientation:c.orientation}:{...u,startLineNumber:c.lineNumber,startOrientation:c.orientation,endLineNumber:("left"===n?l?.left:l?.right)??-1,endOrientation:n};let{selectedLineKeys:f,selectedLineRange:p}=(0,Y.EV)({diffAnchor:e,diffLines:s().diffLines._diffLines,isSplitView:s().diffLines.isSplitView,lineRange:o}),g=(0,Y.Aj)(f),b=(0,Y.sB)(f),v=Array.from(f).reduce((e,t)=>(e[t]={isFirstSelected:t===g,isLastSelected:t===b,isSelected:!0},e),{});if(!p?.endLineNumber||!p?.startLineNumber)return;let C=new eH.J(p,t);h.cg?.dispatchEvent(C),a(e=>({diffLines:{...e.diffLines,selectedLineKeys:f,selectedLinesInfo:v,selectedLineRange:p}}),void 0,"addLineToSelection"),r(p)},clearSelectedLines:()=>{a(e=>({diffLines:{...e.diffLines,firstLineSelectionOnDrag:null,selectedLineKeys:new Set([]),selectedLinesInfo:{},selectedLineRange:void 0,_firstSelectedLineInfo:null}}),void 0,"clearSelectedLines")},selectLine:({lineKey:e,firstLineSelectionOnDrag:i},n)=>{if(!e)return;s().diffLinesActions.clearSelectedLines();let r=s().diffLines._diffLinesHash[e];if(!r)return;let o={[e]:{isFirstSelected:!0,isLastSelected:!0,isSelected:!0}},l="left"===i.orientation?r.left:r.right;if(!l)return;let d={diffAnchor:s().diffLines.diffAnchor,endLineNumber:l,endOrientation:i.orientation,startLineNumber:l,startOrientation:i.orientation},c=new eH.J(d,t);h.cg?.dispatchEvent(c),a(t=>({diffLines:{...t.diffLines,firstLineSelectionOnDrag:{...i,lineKey:e},selectedLineKeys:new Set([e]),selectedLinesInfo:o,selectedLineRange:d,_firstSelectedLineInfo:{lineKey:e,lineNumber:i.lineNumber,orientation:i.orientation}}}),void 0,"selectLine"),n(d)},selectMultipleLines:({startLineKey:i,endLineKey:n,startOrientation:r,endOrientation:o,firstLineSelectionOnDrag:l},d)=>{if(!i||!n||!l)return;let c=s().diffLines._diffLinesHash[i],u=s().diffLines._diffLinesHash[n];if(!c||!u||!c.left&&!c.right||!u.left&&!u.right)return;let m={diffAnchor:e,endLineNumber:("right"===o?u.right:u.left)??-1,endOrientation:o,startLineNumber:("right"===r?c.right:c.left)??-1,startOrientation:r},{selectedLineKeys:f,selectedLineRange:p}=(0,Y.EV)({diffAnchor:e,diffLines:s().diffLines._diffLines,isSplitView:s().diffLines.isSplitView,lineRange:m}),g=(0,Y.Aj)(f),b=(0,Y.sB)(f),v=Array.from(f).reduce((e,t)=>(e[t]={isFirstSelected:t===g,isLastSelected:t===b,isSelected:!0},e),{});if(!p?.endLineNumber||!p?.startLineNumber)return;let C=new eH.J(p,t);h.cg?.dispatchEvent(C),a(e=>({diffLines:{...e.diffLines,selectedLinesInfo:v,selectedLineKeys:f,firstLineSelectionOnDrag:l,selectedLineRange:p,_firstSelectedLineInfo:{lineNumber:l.lineNumber,orientation:l.orientation,lineKey:l.lineKey}}}),void 0,"selectMultipleLines"),d(p)}}}})(e)(...t),...(({hiddenFeatures:e})=>()=>({hiddenFeatures:e}))(e)(...t),...(({addInjectedContextLines:e})=>()=>({injectedContextLinesActions:{addInjectedContextLines:e}}))(e)(...t),...(({newTreeEntry:e,oldTreeEntry:t})=>()=>({treeEntries:{newTreeEntry:e,oldTreeEntry:t}}))(e)(...t)}),{name:`diff-store-${e.diffAnchor}`}));try{eU.displayName||(eU.displayName="DiffStoreContext")}catch{}try{eK.displayName||(eK.displayName="DiffStoreProvider")}catch{}let eq=()=>eG(e=>e.diffLines.getSelectedDiffLines),eW=()=>eG(e=>e.diffLines.getDiffLinesInfo),ez=()=>eG(e=>e.diffLines.getfirstLineSelectionOnDrag),eX=()=>eG(e=>e.diffLines.getSelectedLineRange),eQ=()=>eG(e=>e.hiddenFeatures),eJ=e=>eG(t=>!!e&&t.dialogMode.activeGridCellId===e),eY=()=>eG(e=>e.dialogModeActions),eZ=()=>eG(e=>e.diffLines.diffAnchor),e0=()=>eG(e=>e.diffLines.fileLineCount),e1={isSelected:!1,isFirstSelected:!1,isLastSelected:!1},e2=e=>eG(t=>e&&t.diffLines.selectedLinesInfo[(0,Y.bo)(e)]||e1),e3=()=>eG(e=>e.diffLinesActions);var e4=i(30459);function e5({anchorRef:e,diffAnchor:t,isInDialogMode:i,isOpen:r,returnFocusRef:s,onCloseCommentDialog:o,suggestedChangesConfig:l,...d}){let{sendAnalyticsEvent:c}=(0,e4.s)(),u=(0,a.useRef)(null),m=eX(),f=(0,a.useMemo)(()=>{if(r&&l?.configureSuggestedChangesFromLineRange){let e=m();return l.configureSuggestedChangesFromLineRange(e,l?.shouldStartNewConversationWithSuggestedChange)}},[r,l,m]);return r?(0,n.jsx)("div",{className:"rounded-2 bgColor-default","data-marker-navigation-new-thread":!0,"data-marker-id":"new-comment",ref:u,tabIndex:i?0:-1,onFocus:e=>{e.target===u.current&&u.current.querySelector("textarea")?.focus()},children:(0,n.jsx)(N,{onClose:()=>{o(),c("comments.cancel_thread_reply","CANCEL_REVIEW_THREAD_BUTTON")},showOnCloseIcon:!1,suggestedChangesConfig:f,...d})}):null}try{e5.displayName||(e5.displayName="StartConversation")}catch{}var e8=i(2265);let e6=eD.z0.ArrowAll;eD.z0.ArrowHorizontal,eD.z0.ArrowVertical,eD.z0.ArrowVertical,eD.z0.ArrowHorizontal;let MarkerNavigator=class MarkerNavigator{focusMarker(e){let t=this.markers.findIndex(t=>t.id.toString()===e.toString());-1!==t&&(this.currentMarkerPosition={markerId:e,index:t})}get focusedMarker(){if(this.currentMarkerPosition)return this.markers[this.currentMarkerPosition.index]}moveToFirstComment(e){if(0!==this.markers.length&&!e)return}moveToNextMarker(e,t){let i;if(0===this.markers.length)return;if(t){let e=t.closest("[data-marker-id]"),i=e?.getAttribute("data-marker-id");i&&(this.currentMarkerPosition={markerId:i,index:this.markers.findIndex(e=>e.id.toString()===i.toString())})}if(!this.currentMarkerPosition){let t="ArrowUp"===e?this.markers.length-1:0,i=this.markers[t];if(!i)return;return this.currentMarkerPosition={markerId:i.id,index:t},this.markers[t]}let n=0===this.currentMarkerPosition.index,r=this.currentMarkerPosition.index===this.markers.length-1;switch(e){case"ArrowDown":if(r)return;i=(this.currentMarkerPosition.index+1)%this.markers.length;break;case"ArrowUp":if(n)return;i=(this.currentMarkerPosition.index-1+this.markers.length)%this.markers.length;break;default:return}let a=this.markers[i];if(a)return this.currentMarkerPosition={markerId:a.id,index:i},a}moveToNextMarkerItem(e,t){let i;if(!t||!this.markerComments)return;let n=t.closest("[data-marker-id]"),r=n?.getAttribute("data-marker-id");if(!n||!r)return;let a=this.markerComments[r]||[];if(0===a.length)return;let s=t.getAttribute("data-marker-navigation-comment-id"),o=a.findIndex(e=>e.id===s);if(-1===o)return;let l=o===a.length-1;switch(e){case"ArrowDown":if(l)return;i=o+1;break;case"ArrowUp":if(0===o)return;i=o-1;break;default:return}let d=a[i];if(d)return this.currentMarkerCommentPosition={markerId:d.id,index:i},d}constructor(e,t,i){if((0,J._)(this,"markers",void 0),(0,J._)(this,"markerComments",null),(0,J._)(this,"currentMarkerPosition",null),(0,J._)(this,"currentMarkerCommentPosition",null),this.markers=e.map(e=>{let t=e.id;return{...e,id:t}}),this.markerComments=e.reduce((e,t)=>{let i=document.querySelectorAll(`[data-marker-navigation-comment-thread-id="${t.id}"]`);if(i){let n=Array.from(i).map(e=>({id:e.getAttribute("data-marker-navigation-comment-id")}));return{...e,[t.id.toString()]:n}}return e},{}),t&&!i){let e=this.markers.findIndex(e=>e.id.toString()===t.toString());-1!==e&&(this.currentMarkerPosition={markerId:t,index:e})}}};function e7({containerRef:e,markers:t,disabled:i=!1,focusInStrategy:n="previous"}){let r=(0,a.useRef)(void 0),s=(0,a.useRef)(void 0);(0,a.useEffect)(()=>{s.current=new MarkerNavigator(t,r.current?.focusedMarker?.id||void 0),r.current=s.current},[t]);let o=(0,a.useCallback)((e,t,i)=>{let n=i.key,r=!e9(t)&&!te(t)&&!tr(t)&&!tt(t);switch(!0){case r&&("ArrowUp"===n||"ArrowDown"===n||"ArrowRight"===n||"ArrowLeft"===n):return tn(t)||ti(t)||void 0;case"ArrowUp"===n||"ArrowDown"===n:if(s.current&&e9(t)){let e=s.current.moveToNextMarker(n,ti(t));if(e)return document.querySelector(`[data-marker-id="${e.id}"]`)||void 0;return t}if(s.current&&tt(t)){let e=s.current.moveToNextMarker(n,tt(t));if(e)return document.querySelector(`[data-marker-id="${e.id}"]`)||void 0;return t}if(s.current&&tr(t)){let e=s.current.moveToNextMarkerItem(n,tr(t));if(e)return document.querySelector(`[data-marker-navigation-comment-id="${e.id}"]`)||void 0;return t}if(s.current&&te(t)){let e=s.current.moveToNextMarkerItem(n,t);if(e)return document.querySelector(`[data-marker-navigation-comment-id="${e.id}"]`)||void 0}return t;case"ArrowRight"===n:if(te(t))return tn(t);if(e9(t))return t?.querySelector('[data-first-thread-comment="true"]')||void 0;return t;case"ArrowLeft"===n:if(e9(t))return ti(t);if(tt(t))return tt(t);if(tr(t))return tr(t);if(te(t))return t?.closest("[data-marker-id]")||void 0;return t;default:return t??void 0}},[s]);return(0,V.G)({containerRef:e,bindKeys:e6,getNextFocusable:o,focusableElementFilter:e=>!i&&!!(e.hasAttribute("data-marker-id")&&e.hasAttribute("data-marker-navigation-comment-id")),focusInStrategy:n,disabled:i},[o,i]),{markerNavigator:s}}function e9(e){return!!e?.hasAttribute("data-marker-id")}function te(e){return!!e?.hasAttribute("data-marker-navigation-comment-id")}function tt(e){return e?.closest("[data-marker-navigation-new-thread]")??void 0}function ti(e){return e?.closest("[data-marker-id]")??void 0}function tn(e){return e?.closest("[data-marker-navigation-comment-id]")??void 0}function tr(e){return e?.closest("[data-marker-navigation-thread-reply]")??void 0}var ta=i(48505);let ts="a, audio, button, details, embed, iframe, img, input, keygen, label, object, select, textarea, video";function to(e){for(let t of(e?.setAttribute("aria-hidden","false"),Array.from(e?.querySelectorAll("*")??[])))t?.setAttribute("aria-hidden","false");for(let t of Array.from(e?.querySelectorAll(ts)??[]))t.setAttribute("tabindex","0")}function tl({commentSubjectType:e,gridCellId:t,markerRef:i,isThread:n=!1,thread:r}){let s=eJ(t);(0,a.useEffect)(()=>{let t=null;if(!n||r){if(s)"commit"===e?t=setTimeout(()=>{to(i.current)},100):to(i.current);else{var a;a=i.current,a?.setAttribute("aria-hidden","true"),function e(t=0){setTimeout(()=>{let t=Array.from(a?.querySelectorAll("*")??[]),i=Array.from(a?.querySelectorAll(ts)??[]);if(0===i.length)return e(200);for(let e of t)e?.setAttribute("aria-hidden","true");for(let e of i)e.setAttribute("tabindex","-1")},t)}()}return()=>{t&&clearTimeout(t)}}},[s,e,i,n,r])}var td=i(86909);let tc={inlineAnnotation:"InlineAnnotation-module__inlineAnnotation--bVDzc"};function tu({annotation:e,gridCellId:t,isFirstMarker:i}){let r=(0,a.useRef)(null),s=eJ(t);return tl({commentSubjectType:"pull request",gridCellId:t,markerRef:r}),(0,n.jsx)("div",{id:`annotation_${e.databaseId}`,ref:r,className:(0,M.$)("border rounded-2 color-border-default color-shadow-small overflow-hidden",i?"mb-1":"mb-2",tc.inlineAnnotation),"data-level":e.annotationLevel,"data-testid":`annotation-${e.id}`,"data-marker-id":`${e.id}`,tabIndex:s?0:-1,children:(0,n.jsx)(td.YH,{annotation:e})})}try{tu.displayName||(tu.displayName="InlineAnnotation")}catch{}let tm={closeMarkersDialogButton:"InlineMarkers-module__closeMarkersDialogButton--wdW2G",markersWrapper:"InlineMarkers-module__markersWrapper--Fw1hl",fileMarkersWrapper:"InlineMarkers-module__fileMarkersWrapper--rXaAB",markersDialogActive:"InlineMarkers-module__markersDialogActive--v0PSm"};var tf=i(33643),th=i(75202),tp=i(82075),tg=i(26607),tb=i(72511),tv=i(26382);function tC(){return(0,n.jsx)("div",{className:"position-relative",children:(0,n.jsxs)(tv.E,{border:!0,children:[(0,n.jsx)(tv.E.Visual,{children:(0,n.jsx)(l.AlertIcon,{size:24,className:"fgColor-muted mt-3 mb-3"})}),(0,n.jsx)(tv.E.Heading,{children:(0,n.jsx)("strong",{children:"Comments cannot be loaded right now"})}),(0,n.jsx)("div",{className:"mb-n2",children:(0,n.jsx)(tv.E.Description,{children:"Refresh the page or try again later"})}),(0,n.jsx)(tv.E.SecondaryAction,{href:"https://www.githubstatus.com/",children:"GitHub status"})]})})}try{tC.displayName||(tC.displayName="CommentErrorFallback")}catch{}let tx={inlineReviewThreadHeading:"InlineReviewThread-module__inlineReviewThreadHeading--CBLMR",ReviewThreadContainer:"InlineReviewThread-module__ReviewThreadContainer--MW9GI",ResolvableContainer:"InlineReviewThread-module__ResolvableContainer--FkZ8G",ThreadLoading:"InlineReviewThread-module__ThreadLoading--UIhR9"};var ty=i(11738),tL=i(96760),tS=i(84078),tN=i(20622),tw=i(48845),tD=i(97665),tj=i(94747),tI=i(96379),tk=i(69510),t_=i(80081),tA=i(11112);let tE={ReviewThreadContainer:"ReviewThread-module__ReviewThreadContainer--s6e8A"};var tR=i(61219),tT=i(45270);function tO({batchingEnabled:e,commentAnchorPrefix:t,lineMarkersKey:i,disableDialogMode:r,enableDialogMode:s,filePath:o,gridCellId:l,isInlineComment:d,isInDialogMode:c,onDeleteLineComment:u,subjectId:f,thread:p,threadPositionNumber:g,threadsConnectionId:b,shouldLimitHeight:v=!0,suggestedChangesConfig:C,viewerData:y,ghostUser:L}){let[N,w]=(0,a.useState)(!1),[D,j]=(0,a.useState)(void 0),{sendAnalyticsEvent:I}=(0,e4.s)(),k=(0,a.useRef)(null),_=(0,a.useRef)(null),{mutate:A}=function(e,t){let i=(0,x.Kp)(),n=(0,tD.jE)(),r=`${i}/page_data/${tN.u.createReviewComment}`,{updateThread:a}=(0,x.an)(),{addPendingComment:s,clearPendingReview:o}=(0,x._N)();return(0,tj.n)({mutationFn:async e=>{let t=await (0,tI.Sr)(`${r}`,{method:"POST",headers:{Accept:"application/json"},body:e}),i=await (0,tw.hp)(t);return(0,tw.R)(t,i),i},onSuccess:(r,l)=>(void 0!==l.submitBatch&&!l.submitBatch&&r.thread&&s(Number(r.thread.id)),l.submitBatch&&o(),a(Number(r.thread.id),e,t,e=>r.thread),n.invalidateQueries({queryKey:(0,tk.XG)(i)}))})}(o,i),{endOid:E,startOid:R}=(0,tT.Xv)(),T=e=>{j(e),w(!0)};if(!p.commentsData||null===p.commentsData.comments||p.commentsData.comments.length<1)return null;let O=(0,t_.Lm)(p),M=p.subjectType?.toLowerCase()==="line"?{lineRange:O}:void 0;return(0,n.jsx)("div",{"data-testid":"review-thread",children:(0,n.jsxs)("div",{className:tE.ReviewThreadContainer,"data-limit-height":v,children:[p.commentsData.comments.map((e,a)=>e.reviewVariantType===ta.hH.Automated&&0===a?(0,n.jsx)(tA.y,{anchorPrefix:t,comment:e,isAnchorable:!0,isInlineComment:d,isInDialogMode:c,isOutdated:p.positioning?.isOutdated,isThreadResolved:!!p.isResolved,onQuoteReply:T,subjectId:f,threadId:p.id,threadPositionNumber:g,threadsConnectionId:b,viewerData:y},e.id):(0,n.jsx)(tR.U,{lineMarkersKey:i,isAnchorable:!0,index:a,threadPositionNumber:g,isFirstComment:0===a,isInlineComment:d,isLastChild:a===(p.commentsData?.comments.length??0)-1,anchorPrefix:t,comment:e,commentConnectionId:p.commentsData?.__id,disableDialogMode:r,enableDialogMode:s,filePath:o,gridCellId:l,isInDialogMode:c,isOutdated:p.positioning?.isOutdated,subjectId:f,threadId:p.id,onDeleteLineComment:u,onQuoteReply:T,threadCommentCount:p.commentsData?.comments.length,threadsConnectionId:b,isThreadResolved:!!p.isResolved,suggestedChangesConfig:C,applySuggestedChangesValidationData:M,viewerData:y,ghostUser:L},e.id)),p.reviewCommentsLimitExceeded&&(0,n.jsx)(tS.l,{"aria-label":"Warning",title:"Warning",variant:"warning",hideTitle:!0,description:`Only the first ${(p.reviewCommentsLimit||0)-1} replies are currently being shown.`,className:"m-3"}),p.viewerCanReply&&(0,n.jsxs)("div",{id:tL.Bq.issueCommentComposer,className:"rounded-bottom-2 p-2 bgColor-inset","data-marker-navigation-comment-thread-id":p.id,"data-marker-navigation-comment-id":`${p.id}-reply-comment`,"data-marker-navigation-thread-reply":!0,tabIndex:c?0:-1,onFocus:e=>{_.current===e.target&&(N?_.current?.querySelector("textarea")?.focus():k.current?.focus())},ref:_,children:[N&&(0,n.jsx)(S,{startLineNumber:O?.startLineNumber,lineNumber:O?.endLineNumber,batchingEnabled:e,condensed:!1,fileLevelComment:!0,filePath:o,focusOnMount:!0,isReplying:!0,onCancelComment:()=>{w(!1),j(void 0),I("comments.cancel_thread_reply","CANCEL_REVIEW_THREAD_BUTTON"),h.cg?.requestAnimationFrame(()=>k.current?.focus())},quotedText:D,subjectId:f,threadId:p.id,onAddComment:({commentText:e,onCompleted:t,onError:i,submitBatch:n})=>{let r=p.commentsData?.comments[p.commentsData?.comments.length-1];A({text:e,submitBatch:n,inReplyTo:r?.databaseId,path:o,comparisonEndOid:E,comparisonStartOid:R},{onError:i,onSuccess:e=>{var i;(i=e.comment.databaseId)&&m(i.toString()),t?.()}}),I("comments.add","ADD_COMMENT_BUTTON")},suggestedChangesConfig:C}),!N&&(0,n.jsx)(ty.z,{ref:k,onClick:()=>{I("comments.start_thread_reply","REPLY_TO_THREAD_INPUT_BUTTON"),w(!0)},children:"Write a reply"})]})]})})}try{tO.displayName||(tO.displayName="ReviewThread")}catch{}var tM=i(97695),tP=i(39698),t$=i(25407),tF=i(21067),tB=i(73262);function tH({automatedComment:e,thread:t,filePath:i,lineMarkersKey:r,setErrorMessage:a,setIsCollapsed:s,safeLocalStorage:o}){let{mutate:l,isPending:d,error:c}=function(e,t){let i=(0,x.Kp)(),n=(0,tF.cj)(),r=(0,tD.jE)(),{updateThread:a}=(0,x.an)();return(0,tj.n)({mutationFn:async({automatedReviewCommentId:e,reason:t,resolutionNote:n})=>{let r=(0,t$.L7I)({basePath:i,automatedReviewCommentId:e}),a=await (0,tw.q$)(r,{method:"PUT",body:{reason:t,resolution_note:n}});(0,tw.R)(a)},onSuccess:(s,o)=>{a(Number(o.threadId),e,t,e=>{if(e?.commentsData?.comments[0]?.automatedComment){let t=e.commentsData?.comments[0]?.automatedComment;return{...e,isResolved:!0,resolvedBy:n,commentsData:{...e.commentsData,comments:[{...e.commentsData.comments[0],automatedComment:{...t,isDismissed:!0,viewerCanDismiss:!1,viewerCanReopen:!0}},...e.commentsData.comments.slice(1)]}}}}),r.invalidateQueries({queryKey:(0,tk.XG)(i)})}})}(i,r),{mutate:u,isPending:m}=function(e,t){let i=(0,x.Kp)(),n=(0,tD.jE)(),{updateThread:r}=(0,x.an)();return(0,tj.n)({mutationFn:async({automatedReviewCommentId:e})=>{let t=(0,t$.Aav)({basePath:i,automatedReviewCommentId:e}),n=await (0,tw.q$)(t,{method:"PUT"});(0,tw.R)(n)},onSuccess:(a,s)=>{r(Number(s.threadId),e,t,e=>{if(e?.commentsData?.comments[0]?.automatedComment){let t=e.commentsData?.comments[0]?.automatedComment;return{...e,isResolved:!1,resolvedBy:void 0,commentsData:{...e.commentsData,comments:[{...e.commentsData.comments[0],automatedComment:{...t,isDismissed:!1,viewerCanDismiss:!0,viewerCanReopen:!1}},...e.commentsData.comments.slice(1)]}}}}),n.invalidateQueries({queryKey:(0,tk.XG)(i)})}})}(i,r);return(0,n.jsx)(tB.K,{automatedComment:e,dismissError:c,isButtonDisabled:d||m,onDismiss:({reason:i,resolutionNote:n},{onSuccess:r})=>{l({automatedReviewCommentId:e.id,threadId:t.id,reason:i,resolutionNote:n},{onError:()=>a("Failed to dismiss"),onSuccess:()=>{r(),s(!0),o.removeItem(`reviewThreadIsCollapsed_${t.id}`)}})},onReopen:()=>{u({automatedReviewCommentId:e.id,threadId:t.id},{onError:()=>a("Failed to reopen"),onSuccess:()=>{s(!1),o.removeItem(`reviewThreadIsCollapsed_${t.id}`)}})},className:"p-2 border-top"})}try{tH.displayName||(tH.displayName="InlineAutomatedReviewThreadActions")}catch{}function tU({children:e}){return(0,n.jsx)("span",{className:"text-semibold fgColor-default",children:e})}function tG({thread:e}){if(void 0===e)return null;let t=e.positioning??e.subject;return void 0!==t&&t.endDiffSide&&t.endLine?t.startLine&&t.startDiffSide&&t.startLine!==t.endLine?tV({positioning:t}):tK({positioning:t}):null}function tK({positioning:e}){let t="LEFT"===e.endDiffSide?"L":"R";return(0,n.jsxs)("h2",{className:tx.inlineReviewThreadHeading,children:["Comment on line"," ",(0,n.jsxs)(tU,{children:[t,e.endLine??""]})]})}function tV({positioning:e}){let t="LEFT"===e.startDiffSide?"L":"R",i="LEFT"===e.endDiffSide?"L":"R";return(0,n.jsxs)("h2",{className:tx.inlineReviewThreadHeading,children:["Comment on lines"," ",(0,n.jsxs)(tU,{children:[t,e.startLine??""]})," ","to"," ",(0,n.jsxs)(tU,{children:[i,e.endLine??""]})]})}function tq({fileAnchor:e,filePath:t,gridCellId:i,onDeleteLineComment:r,threadId:s,threadPositionNumber:o,lineMarkersKey:d,threadsConnectionId:u,isFirstThread:m,ghostUser:f,manuallyUpdateCommentsWithThisThreadId:h,suggestedChangesConfig:p,...g}){let b=(0,x._W)(s,t,d),{mutate:v}=(0,tM.H)(t,d),C=(0,a.useRef)(null),y=(0,tp.A)("localStorage"),L=b?.isResolved,[S,N]=(0,a.useState)(""),[w,D]=(0,a.useState)(L??!1),j=eJ(i),{disableDialogMode:I,enableDialogMode:_}=eY();(0,a.useEffect)(()=>{let e=localStorage.getItem(`reviewThreadIsCollapsed_${s}`);null!==e?D(JSON.parse(e)):L&&D(!0)},[L,s]),tl({commentSubjectType:"pull request",gridCellId:i,markerRef:C,isThread:!0,thread:b});let A=(0,a.useMemo)(()=>{let t=b?.positioning??b?.subject;if(t&&e&&b&&t.startDiffSide&&t.endDiffSide&&t.startLine&&t.endLine&&p?.configureSuggestedChangesFromLineRange){let i=t.startLine??t.endLine,n=t.startDiffSide??t.endDiffSide,r={diffAnchor:e,endLineNumber:t.endLine,endOrientation:"LEFT"===t.endDiffSide?"left":"right",startLineNumber:i,startOrientation:"LEFT"===n?"left":"right",firstSelectedLineNumber:i,firstSelectedOrientation:"LEFT"===n?"left":"right"};return p?.configureSuggestedChangesFromLineRange(r)}},[e,b,p]),{sendAnalyticsEvent:E}=(0,e4.s)(),{mutate:R}=(0,tP.i)(t,d),T=b?.commentsData?.comments[0]?.reviewVariantType===ta.hH.Automated,O=T?b.commentsData?.comments[0]?.automatedComment:null;if(!b||!((b.commentsData?.comments?.length??0)>0))return null;let $=!!b.isResolved,F=b.commentsData?.comments?.some(e=>e.state?.toUpperCase()!=="PENDING"),B=b.commentsData?.comments?.[0]?.createdAt,H=b.commentsData?.comments?.[0]?.author?.login??"Unknown Author",U=`${L?"Unresolve":"Resolve"} comment`;if(B){let e=(0,tf.C)(new Date(B));U=`${L?"Unresolve":"Resolve"} ${H}'s comment, ${e}`}return(0,n.jsx)(th.t,{fallback:(0,n.jsx)(tC,{}),children:(0,n.jsxs)("div",{className:"rounded-2 bgColor-default",ref:C,children:[(0,n.jsxs)("div",{className:(0,M.$)("px-1",tx.ReviewThreadContainer),children:[(0,n.jsx)(c.K,{"aria-label":w?"Expand comment":"Collapse comment",icon:w?l.ChevronRightIcon:l.ChevronDownIcon,size:"small",variant:"invisible",onClick:()=>{window.requestAnimationFrame(()=>{y.setItem(`reviewThreadIsCollapsed_${s}`,JSON.stringify(!w))}),D(e=>!e)},"data-is-first-collapse-button":m}),(0,n.jsx)(tG,{thread:b}),(0,n.jsxs)("div",{className:tx.ResolvableContainer,children:[b.positioning?.isOutdated&&(0,n.jsx)(tg.A,{variant:"secondary",children:"Outdated"}),$&&!T&&(0,n.jsx)(tg.A,{variant:"secondary",children:"Resolved"}),O?.isDismissed&&(0,n.jsx)(tg.A,{variant:"secondary",children:"Dismissed"})]})]}),(0,n.jsxs)(a.Suspense,{fallback:(0,n.jsxs)("div",{className:tx.ThreadLoading,children:[(0,n.jsx)(k.A,{}),(0,n.jsx)("p",{children:"Loading comments"})]}),children:[S&&(0,n.jsxs)(tb.A,{variant:"danger",className:"m-2",children:[(0,n.jsx)(l.StopIcon,{className:"mr-2"}),S]}),!w&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(tO,{lineMarkersKey:d,disableDialogMode:I,enableDialogMode:_,filePath:t,gridCellId:i,onDeleteLineComment:r,isInlineComment:!0,isInDialogMode:j,thread:b,threadPositionNumber:o,threadsConnectionId:u,suggestedChangesConfig:A,shouldLimitHeight:!1,...g,ghostUser:f}),F&&!T&&(0,n.jsxs)("div",{className:"d-flex flex-items-center p-2 border-top flex-wrap",children:[(0,n.jsx)(P.Q,{"aria-label":U,onClick:$?()=>{b&&(R({threadId:b.id},{onError:()=>N("Failed to unresolve thread"),onSuccess:()=>{D(!1),y.removeItem(`reviewThreadIsCollapsed_${b.id}`)}}),E("comments.unresolve_thread","RESOLVE_CONVERSATION_BUTTON"))}:()=>{b&&(v({threadId:b.id},{onError:()=>N("Failed to resolve thread"),onSuccess:()=>{D(!0),y.removeItem(`reviewThreadIsCollapsed_${s}`)}}),E("comments.resolve_thread","RESOLVE_CONVERSATION_BUTTON"))},className:"mr-2",children:L?"Unresolve comment":"Resolve comment"}),$&&b.resolvedBy&&(0,n.jsxs)("span",{className:"fgColor-muted f6",children:[(0,n.jsx)("b",{children:b.resolvedBy})," marked this comment as resolved"]})]}),O&&(0,n.jsx)(tH,{automatedComment:O,thread:b,filePath:t,lineMarkersKey:d,setErrorMessage:N,setIsCollapsed:D,safeLocalStorage:y})]})]})]})})}try{tU.displayName||(tU.displayName="Emphasis")}catch{}try{tG.displayName||(tG.displayName="ThreadBanner")}catch{}try{tK.displayName||(tK.displayName="SingleLineThreadBanner")}catch{}try{tV.displayName||(tV.displayName="MultineLineThreadBanner")}catch{}try{tq.displayName||(tq.displayName="InlineReviewThread")}catch{}function tW(e,t,i){let{enableDialogMode:n}=eY();return(0,a.useCallback)((r={shouldFocusFirstMarker:!0},a)=>{t.current?.classList.contains("diff-text-cell")&&(n(e),i("USER_EXPANDED_MARKERS"),r.shouldFocusFirstMarker?setTimeout(()=>{t.current?.querySelector('[data-first-marker="true"]')?.focus()},0):a&&setTimeout(()=>{t.current?.querySelector(`[data-marker-id="${a}"]`)?.focus()},0))},[t,n,e,i])}let tz={[ta.UZ.Failure]:0,[ta.UZ.Warning]:1,[ta.UZ.Notice]:2};function tX(e){return(0,n.jsx)(e8.j,{children:(0,n.jsx)(tQ,{...e})})}function tQ({annotations:e,backgroundColor:t,cellRef:i,dispatchMarkersStatus:r,children:s,conversationListThreads:o,inlineMarkersRef:d,isMarkerListOpen:u,isRowSelected:m,lineMarkersKey:f,fileAnchor:p,filePath:g,gridCellId:b,gutterSizeOffset:v,lineType:C,onCloseConversationList:y,onCloseFocusMode:L,onDeleteLineComment:S,returnFocusRef:N,threadsConnectionId:w,suggestedChangesConfig:D,manuallyUpdateCommentsWithThisThreadId:j,ghostUser:I,...k}){let _=eJ(b),{disableDialogMode:A,enableDialogMode:E}=eY(),R=tW(b,i,r),T=(0,a.useRef)(null),O=(0,a.useMemo)(()=>[...e].sort((e,t)=>tz[e.annotationLevel]-tz[t.annotationLevel]),[e]),P=(0,a.useMemo)(()=>s?[...o,{id:"new-comment"},...O]:[...o,...O],[s,o,O]),$=e=>e.stopPropagation(),F=(0,a.useCallback)(e=>{e.target&&_&&(e.target.closest("[data-inline-markers]")||A())},[A,_]);(0,a.useEffect)(()=>(h.XC?.addEventListener("mousedown",F),()=>h.XC?.removeEventListener("mousedown",F)),[F]);let B=(0,x.mF)();return(0,a.useEffect)(()=>{if(B){let t=o.map(e=>e.id),i=e.map(e=>e.id);(t.includes(B)||i.includes(B))&&R({shouldFocusFirstMarker:!1},B)}},[B,R,o,e]),e7({containerRef:T,markers:P,disabled:!_}),(0,n.jsxs)("div",{className:(0,M.$)("d-flex pt-1",_?tm.markersDialogActive:""),style:_?{marginRight:`-${v}`,backgroundColor:t}:{marginRight:`-${v}`},"aria-hidden":_?"false":"true",onFocus:e=>{$(e),_||E(b)},onClick:$,onKeyUp:$,onMouseDown:$,onMouseUp:$,"data-inline-markers":!0,ref:d,children:[(0,n.jsxs)("div",{className:tm.markersWrapper,ref:T,children:[o.map((e,t)=>(0,n.jsx)("div",{className:(0,M.$)("mt-1 border rounded-2 color-border-default color-shadow-small",t===P.length-1?"mb-1":"mb-2"),"data-first-marker":0===t,"data-marker-id":`${e.id}`,tabIndex:_?0:-1,children:(0,n.jsx)(tq,{threadPositionNumber:t+1,manuallyUpdateCommentsWithThisThreadId:j,isFirstThread:0===t,filePath:g,lineMarkersKey:f,fileAnchor:p,gridCellId:b,onDeleteLineComment:S,threadId:e.id,threadsConnectionId:w,suggestedChangesConfig:D,ghostUser:I,...k})},`review-thread-${e.id}`)),s,O.map((e,t)=>{let i=0===t&&e===P[0];return(0,n.jsx)(tu,{annotation:e,gridCellId:b,isFirstMarker:i},`annotation-${e.id}`)})]}),_&&(0,n.jsx)(c.K,{icon:l.UndoIcon,className:(0,M.$)(tm.closeMarkersDialogButton,"ml-2 position-relative",0===o.length?"mt-2":"mt-1"),"aria-label":"Return to code","data-exit-dialog-mode-button":"true",variant:"default",size:"small",onMouseUp:L,onKeyDown:e=>{("Enter"===e.key||"Space"===e.code)&&L()}})]})}try{tX.displayName||(tX.displayName="InlineMarkers")}catch{}try{tQ.displayName||(tQ.displayName="InlineMarkersInternal")}catch{}var tJ=i(18799),tY=i(40260);async function tZ({diffLine:e,diffLines:t,getSelectedDiffLines:i,getSelectedLineRange:n,isSplit:r,isLeftSide:a}){let s,o=window.getSelection();if(o&&""!==o.toString())return void document.execCommand("copy");let l=i().length<=1;switch(!0){case l:s=t1(e);break;case r:s=t2({diffLines:t,diffOrientation:a?"left":"right",getSelectedLineRange:n});break;default:s=t0({diffLines:t,getSelectedLineRange:n})}await (0,tY.D)(s)}let t0=({diffLines:e,getSelectedLineRange:t})=>{let i=t();if(!i)return"";let{startOrientation:n,endOrientation:r,startLineNumber:a,endLineNumber:s}=i,o=0,l=0;return e.length>1&&(o=e.findIndex(e=>"left"===n?e.left===a:e.right===a),l=e.findIndex(e=>"left"===r?e.left===s:e.right===s)),(0,B.Ls)(e.slice(o,l+1))},t1=e=>(0,B.Po)(e)||!e?"":(0,B.Ls)([e]),t2=({diffLines:e,diffOrientation:t,getSelectedLineRange:i})=>{if(void 0===t)return"";let n=i();if(!n)return"";let r=(0,B.Mk)(e),a=r.leftLines,s=r.rightLines,{selectedRightLines:o,selectedLeftLines:l}=(0,eB.A)({selectedLineRange:n,leftLines:a,rightLines:s});return"left"===t?(0,B.Ls)(l):(0,B.Ls)(o)},t3=(0,a.createContext)(null);function t4({children:e}){let[t,i]=(0,a.useState)(!1),[r,s]=(0,a.useState)(),[o,l]=(0,a.useState)(),[d,c]=(0,a.useState)(),[u,m]=(0,a.useState)(),f=(0,a.useMemo)(()=>!!r||!!o||!!d||!!u,[r,d,o,u]),h=(0,a.useCallback)(()=>{i(!0)},[]),p=(0,a.useCallback)(()=>{i(!1)},[]),g=(0,a.useCallback)((e,t,i)=>{switch(e){case"context-menu":s(t),m(void 0),c(void 0),l(void 0);break;case"new-conversation":m({cellId:t,withSuggestedChange:i?.withSuggestedChange}),s(void 0),c(void 0),l(void 0);break;case"marker-details":c(t),s(void 0),l(void 0),m(void 0);break;case"marker-list":l(t),s(void 0),m(void 0),c(void 0)}},[]),b=(0,a.useCallback)(e=>{switch(e){case"context-menu":s(void 0);break;case"new-conversation":m(void 0);break;case"marker-details":c(void 0);break;case"marker-list":l(void 0)}},[]),v=(0,a.useMemo)(()=>({isActionBarVisible:t,showActionBar:h,hideActionBar:p,closeDialog:b,openDialog:g,anyMenuOpen:f,openContextMenuCell:r,openMarkersListCell:o,openMarkerDetailsCell:d,openNewConversationCell:u}),[t,h,p,b,g,f,r,o,d,u]);return(0,n.jsx)(t3.Provider,{value:v,children:e})}function t5(){let e=(0,a.useContext)(t3);if(!e)throw Error("useMarkersDialogContext must be used within a MarkersDialogContextProvider");return e}try{t3.displayName||(t3.displayName="MarkersDialogContext")}catch{}try{t4.displayName||(t4.displayName="MarkersDialogContextProvider")}catch{}function t8({cellId:e,actionBarRef:t}){let[i,n]=(0,a.useState)(t),{openDialog:r,closeDialog:s,openContextMenuCell:o,anyMenuOpen:l}=t5(),d=(0,a.useMemo)(()=>o===e,[e,o]),c=(0,a.useCallback)(()=>{r("context-menu",e)},[e,r]),u=(0,a.useCallback)(()=>{n(t),c()},[t,c]),m=(0,a.useCallback)(()=>{s("context-menu")},[s]),f=(0,a.useCallback)(()=>{d?m():c()},[m,d,c]),h=(0,a.useCallback)(()=>{n(t),f()},[t,f]);return{isContextMenuOpen:d,openContextMenu:c,openContextMenuFromActionBar:u,closeContextMenu:m,toggleContextMenu:f,toggleContextMenuFromActionBar:h,closeMarkerListDialog:(0,a.useCallback)(()=>{s("marker-list")},[s]),returnFocusRef:i,anyMenuOpen:l}}function t6({cellId:e,onOpenDialog:t}){let{openDialog:i,closeDialog:n,openNewConversationCell:r}=t5(),{sendAnalyticsEvent:s}=(0,e4.s)(),o=(0,a.useMemo)(()=>r?.cellId===e,[e,r]),l=(0,a.useCallback)(n=>{t?.(),i("new-conversation",e,n)},[e,t,i]),d=(0,a.useCallback)(()=>{l()},[l]),c=(0,a.useCallback)(()=>{l({withSuggestedChange:!0}),s("diff.start_new_conversation_with_suggested_change","CELL_CONTEXT_MENU")},[l,s]);return{isNewConversationDialogOpen:o,startNewConversation:d,startNewConversationWithSuggestedChange:c,closeNewConversation:(0,a.useCallback)(()=>{n("new-conversation")},[n]),shouldStartNewConversationWithSuggestedChange:(0,a.useMemo)(()=>r?.withSuggestedChange,[r])}}function t7({cellRef:e}){let{showActionBar:t,hideActionBar:i,anyMenuOpen:n}=t5(),[r,s]=(0,a.useState)(!1),o=(0,a.useCallback)(()=>{t()},[t]),l=(0,a.useCallback)(t=>{!n&&(e.current&&e.current.contains(t.relatedTarget)||i())},[n,e,i]),d=(0,a.useCallback)(()=>{t()},[t]),c=(0,a.useCallback)(()=>{!n&&(e.current===document.activeElement||e.current?.contains(document.activeElement)&&document.activeElement?.getAttribute("data-add-comment-button")!=="true"||i())},[n,e,i]),u=(0,a.useCallback)(t=>{e.current&&(n||(e.current.contains(t.relatedTarget)?e.current===t.relatedTarget&&s(!1):(i(),s(!1))))},[n,e,i]);return{isActionBarFocused:r,handleCellBlur:l,handleCellFocus:o,handleCellMouseEnter:d,handleCellMouseLeave:c,handleActionBarBlur:u,handleActionBarFocusCapture:(0,a.useCallback)(e=>{n||(e.stopPropagation(),s(!0))},[n]),handleActionBarKeydownCapture:(0,a.useCallback)(e=>{!n&&eR(e.key)&&e.stopPropagation()},[n])}}var t9=i(88431),ie=i(54571),it=i(21513),ii=i(73783),ir=i(94236),ia=i(5524),is=i(94602),io=i(90274);let il={commentIndicatorContainer:"CommentIndicator-module__commentIndicatorContainer--GS12p",AvatarStack:"CommentIndicator-module__AvatarStack--LfU8D",Compact:"CommentIndicator-module__Compact--Q1u86",Relaxed:"CommentIndicator-module__Relaxed--oSXaK",textStyles:"CommentIndicator-module__textStyles--ZLD5t"},id={compact:{avatarSize:18},relaxed:{avatarSize:20}},ic=ek.ghostUser;function iu({shouldAnimateRef:e,lineSpacingPreference:t="relaxed",threads:i,annotations:r}){(0,a.useEffect)(()=>{e?.current&&(e.current=!1)},[e]);let{avatarSize:s}=id[t],l=i.length+r.length;if(0===l)return null;let d={},c=[];r.map(e=>{e?.annotationLevel&&c.push({id:e.id,level:e.annotationLevel})}),i.map(e=>e?.commentsData?.comments?.map(e=>{e?.author?d[e?.author.login]=e.author:ic?.login&&(d[ic.login]=ic)}));let u=[...c.sort((e,t)=>(io.GF[e.level]?.priority||0)<(io.GF[t.level]?.priority||0)?-1:1).map(t=>e?.current?(0,n.jsx)(io.S,{annotationLevel:t.level},t.id):(0,n.jsx)(io.Xh,{annotationLevel:t.level},t.id)),...Object.keys(d).map(e=>{let t=d[e]?.login,i=d[e]?.avatarUrl??(ic?.avatarUrl||" ");return(0,n.jsx)(o.r,{alt:t,size:20,src:i},t)})].slice(0,3),m=l>9?"9+":`${l}`;return(0,n.jsxs)("div",{className:(0,M.$)("d-flex","flex-justify-between","flex-items-center",il.commentIndicatorContainer),children:[(0,n.jsx)(is.A,{disableExpand:!0,size:s,className:(0,M.$)(il.AvatarStack,"relaxed"===t?il.Relaxed:il.Compact),children:u}),(0,n.jsx)("span",{className:(0,M.$)("fgColor-default","ml-1",il.textStyles),children:m})]})}try{iu.displayName||(iu.displayName="CommentIndicator")}catch{}var im=i(89141);function ih({currentHunk:e,nextHunk:t,previousHunk:i}){let{addInjectedContextLines:n}=eG(e=>e.injectedContextLinesActions),r=!!e&&0!==e.startBlobLineNumber,a=!!e&&!!t;return{expandStartOfHunk:()=>{if(!r||!e)return;let t=i&&e&&i.endBlobLineNumber+20>e.startBlobLineNumber,a={start:Math.max(0,e.startBlobLineNumber-20),end:e.startBlobLineNumber};t&&(a.start=i.endBlobLineNumber+1),n(a)},expandEndOfHunk:()=>{a&&e&&n({start:e.endBlobLineNumber+1,end:e.endBlobLineNumber+1+20})},expandEndOfPreviousHunk:()=>{i&&n({start:i.endBlobLineNumber+1,end:i.endBlobLineNumber+1+20})},canExpandEndOfHunk:a,canExpandStartOfHunk:r}}var ip=i(29255);let ig={left:"L",right:"R"},ib="Add comment",iv="Suggest change";function iC(e,t,i){let n=i&&!(0,B.Ji)(t)?ig.left:ig.right;return`${e} on line ${n}${t.blobLineNumber}`}function ix({diffLine:e,handleStartConversationWithSuggestedChange:t,handleStartConversation:i,isLeftSide:r,isSplit:s}){let o,d,c,{selectMultipleLines:u}=e3(),m=eq(),f=eX()(),h=(0,a.useMemo)(()=>(0,B.Mk)(m()),[m]),p=(0,a.useMemo)(()=>h.leftLines.find(e=>!(0,B.Po)(e)),[h.leftLines]),g=(0,a.useMemo)(()=>{let e=h.leftLines.filter(e=>!(0,B.Po)(e));return e[e.length-1]},[h.leftLines]),b=(0,a.useMemo)(()=>h.leftLines.filter(e=>!(0,B.Po)(e)).every(e=>"DELETION"!==e.type),[h.leftLines]),v=(0,a.useMemo)(()=>h.rightLines.find(e=>!(0,B.Po)(e)),[h.rightLines]),C=(0,a.useMemo)(()=>{let e=h.rightLines.filter(e=>!(0,B.Po)(e));return e[e.length-1]},[h.rightLines]),x=(0,a.useMemo)(()=>0===h.rightLines.filter(e=>!(0,B.Po)(e)).length,[h.rightLines]),y=(0,a.useMemo)(()=>0===h.leftLines.filter(e=>!(0,B.Po)(e)).length,[h.leftLines]),L=(0,a.useMemo)(()=>!(h.leftLines.find(e=>!(0,B.Po)(e)&&!(0,B.Ji)(e)&&"INJECTED_CONTEXT"!==e.type)||h.rightLines.find(e=>!(0,B.Po)(e)&&!(0,B.Ji)(e)&&"INJECTED_CONTEXT"!==e.type)),[h.leftLines,h.rightLines]),S=(0,a.useCallback)((e,n)=>{!(!f||!g||!p||(0,B.Po)(g)||(0,B.Po)(p))&&p.left&&g.left&&(u({endLineKey:(0,Y.bo)(g),endOrientation:"left",startLineKey:(0,Y.bo)(p),startOrientation:"left",firstLineSelectionOnDrag:{lineKey:(0,Y.bo)(p),lineNumber:p.left,orientation:"left",shouldStartConversation:!1}},eE),n?.withSuggestedChange?t():i())},[f,g,p,u,t,i]),N=(0,a.useCallback)((e,n)=>{!(!f||!C||!v||(0,B.Po)(C)||(0,B.Po)(v))&&v.right&&C.right&&(u({endLineKey:(0,Y.bo)(C),endOrientation:"right",startLineKey:(0,Y.bo)(v),startOrientation:"right",firstLineSelectionOnDrag:{lineKey:(0,Y.bo)(v),lineNumber:v.right,orientation:"right",shouldStartConversation:!1}},eE),n?.withSuggestedChange?t():i())},[f,C,v,u,t,i]),w="DELETION"!==e.type,D=(0,a.useMemo)(()=>!!f&&(f.startOrientation!==f.endOrientation||f.startLineNumber!==f.endLineNumber),[f]),j=!1,I=!1;if(f&&D){let e=ig[f.startOrientation],r=ig[f.endOrientation];return c=` on lines ${e}${f.startLineNumber}-${r}${f.endLineNumber}`,!(0,B.Po)(p)&&!(0,B.Po)(g)&&p&&g&&(j=!0,o=p.left===g.left?x?` on line L${p.left}`:`, original line L${p.left}`:x?` on lines L${p.left}-L${g.right}`:`, original lines L${p.left}-L${g.left}`),!(0,B.Po)(v)&&!(0,B.Po)(C)&&v&&C&&(I=!0,d=v.right===C.right?y||s&&L?` on line R${v.right}`:`, modified line R${C.right}`:y||s&&L?` on lines R${v.right}-R${C.right}`:`, modified lines R${v.right}-R${C.right}`),(0,n.jsx)(n.Fragment,{children:s?(0,n.jsx)(n.Fragment,{children:L?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(ia.l.Item,{onSelect:N,children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.PlusIcon,{})}),ib+d,(0,n.jsx)(ia.l.TrailingVisual,{children:(0,n.jsx)(ip.U,{keys:"Alt+n"})})]}),(0,n.jsxs)(ia.l.Item,{onSelect:e=>N(e,{withSuggestedChange:!0}),children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.PlusCircleIcon,{})}),iv+d]})]}):(0,n.jsxs)(n.Fragment,{children:[j?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(ia.l.Item,{onSelect:S,children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.PlusIcon,{})}),ib+o,(0,n.jsx)(ia.l.TrailingVisual,{children:(0,n.jsx)(ip.U,{keys:x?"Alt+n":"Alt+Shift+N"})})]}),b&&(0,n.jsxs)(ia.l.Item,{onSelect:e=>S(e,{withSuggestedChange:!0}),children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.PlusCircleIcon,{})}),iv+o]})]}):null,I?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(ia.l.Item,{onSelect:N,children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.PlusIcon,{})}),ib+d,(0,n.jsx)(ia.l.TrailingVisual,{children:(0,n.jsx)(ip.U,{keys:"Alt+n"})})]}),(0,n.jsxs)(ia.l.Item,{onSelect:e=>N(e,{withSuggestedChange:!0}),children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.PlusCircleIcon,{})}),iv+d]})]}):null]})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(ia.l.Item,{onSelect:i,children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.PlusIcon,{})}),ib+c]}),w&&b&&(0,n.jsxs)(ia.l.Item,{onSelect:t,children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.PlusCircleIcon,{})}),iv+c]})]})})}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(ia.l.Item,{onSelect:i,children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.PlusIcon,{})}),iC(ib,e,r)]}),w&&(0,n.jsxs)(ia.l.Item,{onSelect:t,children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.PlusCircleIcon,{})}),iC(iv,e,r)]})]})}try{ix.displayName||(ix.displayName="StartConversationContextMenuItems")}catch{}var iy=i(66358);function iL(e){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(iD,{...e}),e.viewerData.shouldDisplayComments&&(0,n.jsx)(iN,{diffAnchor:e.diffAnchor,diffLine:e.diffLine,fileDiffReference:e.copilotChatReference,isLeftSide:e.isLeftSide}),(0,n.jsx)(iA,{handleCopyCode:e.handleCopyCode}),(0,n.jsx)(iw,{diffAnchor:e.diffAnchor}),e.viewerData.shouldDisplayComments&&(0,n.jsx)(iS,{diffAnchor:e.diffAnchor,diffLine:e.diffLine}),(0,n.jsx)(iE,{currentHunk:e.currentHunk,diffAnchor:e.diffAnchor,nextHunk:e.nextHunk,previousHunk:e.previousHunk})]})}function iS({diffLine:e,diffAnchor:t}){let i=eX(),r=(0,a.useCallback)(()=>{let n=i(),r=(0,B.j2)({line:e,range:n,fileAnchor:t});r&&(0,tY.D)(r)},[t,i,e]);return(0,n.jsxs)(ia.l.Item,{onSelect:r,onMouseDown:e=>{window.getSelection()?.toString()!==""&&e.preventDefault()},children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.LinkIcon,{})}),"Copy link",(0,n.jsx)(ia.l.TrailingVisual,{children:(0,n.jsx)(ip.U,{keys:"Mod+Alt+y"})})]})}let iN=e=>{let t=eX()(),i=(0,B.Av)(t,e.diffLine,e.isLeftSide,e.diffAnchor);return e.fileDiffReference?(0,n.jsx)(im.w,{showDivider:!0,selectedRange:i,fileDiffReference:e.fileDiffReference}):null};function iw({diffAnchor:e}){return(0,n.jsxs)(ia.l.Item,{onSelect:()=>{setTimeout(()=>{document.querySelector(`table[data-diff-anchor="${e}"]`)?.dispatchEvent(new KeyboardEvent("keydown",{key:"a",code:"KeyA",ctrlKey:!0}))})},children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.MultiSelectIcon,{})}),"Select all",(0,n.jsx)(ia.l.TrailingVisual,{children:(0,n.jsx)(ip.U,{keys:"Mod+a"})})]})}function iD({diffLine:e,handleViewMarkersSelection:t,isLeftSide:i,isSplit:r,shouldDisplayCollapseComments:a,showStartConversation:s,startConversationCurrentLine:o,startConversationWithSuggestedChange:l,threads:d,annotations:c,viewerData:u}){let m=c.length>0;return s||d||m?(0,n.jsxs)(n.Fragment,{children:[u.shouldDisplayComments&&s&&(0,n.jsx)(ix,{diffLine:e,handleStartConversation:o,handleStartConversationWithSuggestedChange:l,isLeftSide:i,isSplit:r}),(0,n.jsx)(ij,{threads:d,annotations:c,diffLine:e,handleViewMarkersSelection:t,isLeftSide:i,isSplit:r,shouldDisplayCollapseComments:a,viewerData:u}),(0,n.jsx)(ia.l.Divider,{})]}):null}function ij({diffLine:e,handleViewMarkersSelection:t,isLeftSide:i,isSplit:r,threads:a,annotations:s,shouldDisplayCollapseComments:o,viewerData:l}){return l.commentsPreference===tJ.sI.Visible?null:r?(0,n.jsx)(iI,{threads:a,annotations:s,handleViewMarkersSelection:t,isLeftSide:i,shouldDisplayCollapseComments:o}):(0,n.jsx)(ik,{threads:a,annotations:s,diffLine:e,onSelect:()=>t(),shouldDisplayCollapseComments:o})}function iI({handleViewMarkersSelection:e,isLeftSide:t,shouldDisplayCollapseComments:i,threads:r,annotations:a}){let s=r.length>0,o=a.length>0;return t?(0,n.jsx)(n.Fragment,{children:s&&(0,n.jsx)(i_,{text:i?"Collapse comments":"Expand comments",onSelect:()=>e("LEFT")})}):(0,n.jsx)(n.Fragment,{children:(s||o)&&(0,n.jsx)(i_,{text:i?"Collapse comments":"Expand comments",onSelect:()=>e("RIGHT")})})}function ik({diffLine:e,onSelect:t,threads:i,annotations:r,shouldDisplayCollapseComments:a}){return e&&(i.length>0||r.length>0)?(0,n.jsx)(i_,{text:a?"Collapse comments":"Expand comments",onSelect:()=>t()}):null}function i_({onSelect:e,text:t}){return(0,n.jsxs)(ia.l.Item,{onSelect:e,children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.CommentDiscussionIcon,{})}),t]})}function iA({handleCopyCode:e}){return(0,n.jsxs)(ia.l.Item,{onSelect:e,onMouseDown:e=>{window.getSelection()?.toString()!==""&&e.preventDefault()},children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.CopyIcon,{})}),"Copy",(0,n.jsx)(ia.l.TrailingVisual,{children:(0,n.jsx)(ip.U,{keys:"Mod+c"})})]})}function iE({currentHunk:e,diffAnchor:t,nextHunk:i,previousHunk:r}){let a=eQ(),{canExpandStartOfHunk:s,canExpandEndOfHunk:o}=ih({currentHunk:e,nextHunk:i,previousHunk:r});return s||o||r||i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ia.l.Divider,{}),a.has(iy.YR.expandLines)?null:(0,n.jsx)(iR,{currentHunk:e,nextHunk:i,previousHunk:r}),(0,n.jsx)(iT,{diffAnchor:t,nextHunk:i,previousHunk:r})]}):null}function iR({currentHunk:e,nextHunk:t,previousHunk:i}){let{canExpandStartOfHunk:r,expandEndOfHunk:a,expandStartOfHunk:s,canExpandEndOfHunk:o}=ih({currentHunk:e,nextHunk:t,previousHunk:i});return(0,n.jsxs)(n.Fragment,{children:[r&&(0,n.jsxs)(ia.l.Item,{onSelect:s,children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.FoldUpIcon,{})}),"Expand above"]}),o&&(0,n.jsxs)(ia.l.Item,{onSelect:a,children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.FoldDownIcon,{})}),"Expand below"]})]})}function iT({diffAnchor:e,nextHunk:t,previousHunk:i}){return(0,n.jsxs)(n.Fragment,{children:[t?(0,n.jsxs)(ia.l.Item,{"aria-keyshortcuts":"PageDown",onSelect:()=>{setTimeout(()=>{document.querySelector(`table[data-diff-anchor="${e}"]`)?.dispatchEvent(new KeyboardEvent("keydown",{key:"PageDown"}))})},children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.MoveToBottomIcon,{})}),"Go to next hunk",(0,n.jsx)(ia.l.TrailingVisual,{children:"Page Down"})]}):null,i?(0,n.jsxs)(ia.l.Item,{"aria-keyshortcuts":"PageUp",onSelect:()=>{setTimeout(()=>{document.querySelector(`table[data-diff-anchor="${e}"]`)?.dispatchEvent(new KeyboardEvent("keydown",{key:"PageUp"}))})},children:[(0,n.jsx)(ia.l.LeadingVisual,{children:(0,n.jsx)(l.MoveToTopIcon,{})}),"Go to previous hunk",(0,n.jsx)(ia.l.TrailingVisual,{children:"Page Up"})]}):null]})}try{iL.displayName||(iL.displayName="CellContextMenu")}catch{}try{iS.displayName||(iS.displayName="CopyAnchorLink")}catch{}try{iw.displayName||(iw.displayName="SelectAllListItem")}catch{}try{iD.displayName||(iD.displayName="MarkerListItems")}catch{}try{ij.displayName||(ij.displayName="ViewMarkerListItems")}catch{}try{iI.displayName||(iI.displayName="SplitDiffMarkersListItems")}catch{}try{ik.displayName||(ik.displayName="UnifiedDiffMarkerListItem")}catch{}try{i_.displayName||(i_.displayName="MarkerListItem")}catch{}try{iA.displayName||(iA.displayName="CopyContentListItems")}catch{}try{iE.displayName||(iE.displayName="HunkListItems")}catch{}try{iR.displayName||(iR.displayName="ExpandHunksListItems")}catch{}try{iT.displayName||(iT.displayName="JumpToHunkListItems")}catch{}var iO=i(17998);function iM({authorAvatarUrl:e,authorLogin:t,lineSpacingPreference:i,sx:r}){return(0,n.jsx)(iO.k,{altText:`${t}'s avatar image with pending indicator`,icon:l.DotFillIcon,iconColor:"var(--fgColor-attention, var(--color-attention-fg))",square:!1,size:"compact"===i?18:20,src:e,backgroundSx:{backgroundColor:"var(--bgColor-default, var(--color-canvas-default))",boxShadow:"0 0 0 .1px var(--bgColor-default, var(--color-canvas-default))"},sx:{alignItems:"center",display:"flex",height:"var(--diff-line-minimum-height)",...r}})}try{iM.displayName||(iM.displayName="InProgressCommentIndicator")}catch{}let iP={"action-bar-position":"ActionBar-module__action-bar-position--cMcOj",addCommentButton:"ActionBar-module__addCommentButton--gIYSg",addCommentButtonDraftCompact:"ActionBar-module__addCommentButtonDraftCompact--HKIKU",addCommentButtonDraftRelaxed:"ActionBar-module__addCommentButtonDraftRelaxed--_qJPM",addCommentButtonNew:"ActionBar-module__addCommentButtonNew--j1kFj",actionBarArrowSizing:"ActionBar-module__actionBarArrowSizing--L93H4",actionBarHeight:"ActionBar-module__actionBarHeight--wiyuB",actionBarStartCommentWidth:"ActionBar-module__actionBarStartCommentWidth--TTHf8","action-bar-button-group":"ActionBar-module__action-bar-button-group--G1uFN"},i$=(0,a.forwardRef)(function({annotations:e,authorAvatarUrl:t,authorLogin:i,cellId:r,cellRef:s,copilotChatReference:o,currentHunk:d,diffAnchor:c,diffLine:u,enterDialogMode:m,hasDraftComment:f,handleCopyCode:h,isLeftSide:p,isSplit:g,nextHunk:b,onMouseDownAddCommentButton:v,onMouseLeaveAddCommentButton:C,previousHunk:x,shouldDisplayCollapseComments:y,shouldDisplayMinimizedComments:L,showStartConversation:S,threads:N,toggleViewingMarkers:w,viewerData:D},j){let I=(0,a.useRef)(null),k=(0,a.useRef)(null),{lineSpacingPreference:_,commentsPreference:A}=D,E=(0,a.useRef)(null),R=I.current?I:k;(0,it.T)(j,R);let T=N.reduce((e,t)=>e+(t.commentsData?.comments.length??0),0),O=e.length,{isActionBarFocused:$,handleActionBarBlur:F,handleActionBarFocusCapture:B,handleActionBarKeydownCapture:H}=t7({cellRef:s}),{isContextMenuOpen:U,anyMenuOpen:G,toggleContextMenu:K,toggleContextMenuFromActionBar:V}=t8({cellId:r,actionBarRef:E}),{startNewConversation:q,startNewConversationWithSuggestedChange:W}=t6({cellId:r,onOpenDialog:m}),z=(0,a.useCallback)(e=>{e.stopPropagation(),q()},[q]),X=T+O>0&&A===tJ.sI.Collapsed,Q={onBlur:F,onFocusCapture:B,onKeyDownCapture:H},J=(0,a.useCallback)(t=>{(1===N.length||1===e.length)&&t.preventDefault(),w?.()},[e.length,N.length,w]);return(0,n.jsxs)(n.Fragment,{children:[S&&(0,n.jsx)("div",{"aria-hidden":!$,className:(0,M.$)("d-flex","flex-row",iP.addCommentButton),children:(0,n.jsx)(n.Fragment,{children:f?(0,n.jsx)(P.Q,{"aria-label":"Continue comment in progress",size:"small",className:(0,M.$)("py-0","compact"===_?iP.addCommentButtonDraftCompact:iP.addCommentButtonDraftRelaxed,iP.actionBarHeight),onClick:q,...Q,children:(0,n.jsx)(iM,{lineSpacingPreference:_,authorAvatarUrl:t,authorLogin:i})}):(0,n.jsx)(P.Q,{icon:l.PlusIcon,"aria-label":"Add comment",ref:k,size:"small","data-add-comment-button":!0,className:(0,M.$)("fgColor-muted","bgColor-accent-emphasis","borderColor-accent-emphasis","fgColor-onEmphasis","px-0",iP.addCommentButtonNew,iP.actionBarHeight,iP.actionBarStartCommentWidth),onClick:z,onMouseDown:v,onMouseLeave:C,...Q})})}),(0,n.jsx)("div",{"aria-hidden":!$,className:(0,M.$)("d-flex","flex-row",iP["action-bar-position"]),children:(0,n.jsxs)(ii.A,{className:iP["action-bar-button-group"],...Q,children:[X&&L&&(0,n.jsx)(P.Q,{ref:I,"aria-expanded":G,"aria-label":"View comments",size:"small",className:(0,M.$)("py-0","px-1",iP.actionBarHeight),onClick:J,children:(0,n.jsx)(iu,{threads:N,annotations:e,lineSpacingPreference:_})}),(0,n.jsxs)(ir.W,{anchorRef:E,open:U,onOpenChange:K,children:[(0,n.jsx)(ir.W.Anchor,{children:(0,n.jsx)(P.Q,{ref:E,"aria-haspopup":"true","aria-label":"More actions",icon:l.TriangleDownIcon,size:"small",className:(0,M.$)("fgColor-muted",iP.actionBarArrowSizing),onClick:V})}),(0,n.jsx)(ir.W.Overlay,{width:"medium",children:(0,n.jsx)(ia.l,{children:(0,n.jsx)(iL,{threads:N,annotations:e,currentHunk:d,diffAnchor:c,diffLine:u,shouldDisplayCollapseComments:y,copilotChatReference:o,showStartConversation:S,handleCopyCode:h,handleViewMarkersSelection:w,isLeftSide:p,isSplit:g,nextHunk:b,previousHunk:x,startConversationCurrentLine:q,startConversationWithSuggestedChange:W,viewerData:D})})})]})]})})]})});function iF({threadCount:e,annotationCount:t}){let i=function(e,t){let i=t>0,n=e>0;switch(!0){case i&&n:return"Code has comments and alerts. Press enter to view.";case n:return"Code has comments. Press enter to view.";case i:return"Code has alerts. Press enter to view.";default:return""}}(e,t);return i?(0,n.jsx)("span",{className:"sr-only user-select-none",children:i}):null}i$.displayName="ActionBar";try{iF.displayName||(iF.displayName="DiffLineScreenReaderSummary")}catch{}let iB={"comment-indicator":"ContentCell-module__comment-indicator--Avv5C","in-progress-comment-indicator":"ContentCell-module__in-progress-comment-indicator--Onob7"},iH=(0,a.forwardRef)(function({cellId:e,children:t,className:i,columnIndex:r,diffLine:s,diffAnchor:o,handleDiffCellMouseDown:l,handleExitDialogMode:d,handleHideMarkersFromFocus:c,handleDiffSideCellSelectionBlocking:u,handleStartConversation:m,handleUserClosedMarkersDialog:f,isLeftSide:h,isRowSelected:p=!1,isSplit:g,lineAnchor:b,commentDialogOpen:v,enterDialogMode:C,hasThreads:x,role:y,...L},S){let N=(0,a.useRef)(null),w=eX();(0,a.useImperativeHandle)(S,()=>N.current,[]);let{disableDialogMode:D}=eY(),j=(0,a.useCallback)(()=>{let e=w(),t=(0,B.j2)({line:s,range:e,fileAnchor:o});t&&(0,tY.D)(t)},[o,w,s]),I=ez(),{clearFirstLineSelectionOnDrag:k}=e3(),_=(0,a.useCallback)(()=>{let e=I();e?.shouldStartConversation&&m?.(),k()},[k,I,m]),A=(0,a.useCallback)(e=>{e.shiftKey&&e.preventDefault(),l?.(e),u?.(e)},[l,u]),E=(0,a.useCallback)(()=>{N.current?.focus(),D(),d?.(),f?.()},[D,d,f]),R=eq(),T=eW(),O=(0,a.useCallback)(async e=>{if(e.target===N.current&&(e?.metaKey||e?.ctrlKey)&&"c"===e.key){e.preventDefault();let t=T();await tZ({diffLine:s,diffLines:t,getSelectedDiffLines:R,getSelectedLineRange:w,isSplit:g,isLeftSide:h});return}if(e.target===N.current&&(e?.metaKey||e?.ctrlKey)&&e.altKey&&"y"===e.key)return void j();if(N.current?.contains(e.target)&&e?.key==="Escape")return void E();if(N.current?.contains(e.target)&&"true"===e.target.getAttribute("data-exit-dialog-mode-button")&&!e?.shiftKey&&e?.key==="Tab"){e.preventDefault(),N.current?.querySelector('[data-is-first-collapse-button="true"]')?.focus();return}if(N.current?.contains(e.target)&&"true"===e.target.getAttribute("data-is-first-collapse-button")&&e?.shiftKey&&e?.key==="Tab"){e.preventDefault(),N.current?.querySelector('[data-exit-dialog-mode-button="true"]')?.focus();return}e.target===N.current&&"Enter"===e.key&&(C?.(),!1===x&&m?.(),e.preventDefault())},[T,s,R,w,g,h,j,E,C,x,m]),M=`Cell-left:${s.left}-right:${s.right}-leftSide:${h}`;return(0,n.jsx)("td",{ref:N,"data-grid-cell-id":e,"data-line-anchor":b,"data-selected":!!p,role:y??"gridcell",style:{userSelect:"none",position:"relative"},tabIndex:-1,valign:"top",className:i?`focusable-grid-cell ${i} ${r<3?"left-side":""}`:"focusable-grid-cell",onKeyDown:O,onMouseDown:A,onMouseUp:_,...L,children:t},M)});try{iH.displayName||(iH.displayName="Cell")}catch{}var iU=i(43362);function iG(){let e=(0,x.Kp)(),t=(0,tD.jE)(),i=`${e}/page_data/${tN.u.createReviewComment}`,{updateThread:n}=(0,x.an)(),{onCommentThreadAdded:r}=(0,x.Ud)(),{addPendingComment:a,clearPendingReview:o}=(0,x._N)();return(0,tj.n)({mutationFn:async e=>{let t=await (0,tI.Sr)(`${i}`,{method:"POST",headers:{Accept:"application/json"},body:e}),n=await (0,tw.hp)(t);return(0,tw.R)(t,n),n},onSuccess:(i,l)=>{let d=l.subjectType===s.Wr.File?"FILE":"right"===l.side?`R${l.line}`:`L${l.line}`,c=l.startSide&&l.startLine?"right"===l.startSide?`R${l.startLine}`:`L${l.startLine}`:void 0;void 0!==l.submitBatch&&!l.submitBatch&&i.thread&&a(Number(i.thread.id)),l.submitBatch&&o(),n(Number(i.thread.id),l.path,d,()=>{let e=(0,iU.YY)(l);return i.thread.subject=e,i.thread.positioning=e,i.thread}),r({path:l.path,diffLineKey:d,startPosition:c,threadID:i.thread.id}),t.invalidateQueries({queryKey:(0,tk.XG)(e)})}})}var iK=i(91747),iV=new WeakMap,iq=new WeakMap,iW=new WeakMap,iz=new WeakMap,iX=new WeakMap,iQ=new WeakMap,iJ=new WeakMap,iY=new WeakSet,iZ=new WeakSet,i0=new WeakSet;let ReviewCommentFactory=class ReviewCommentFactory{fileRequestData(){return{...(0,X._)(this,i0,i3).call(this),path:(0,q._)(this,iq),subjectType:s.Wr.File}}lineRequestData(e,t){let i=t&&!(0,B.Ji)(e)?"left":"right";return{...(0,X._)(this,i0,i3).call(this),line:e.blobLineNumber,path:(0,X._)(this,iY,i1).call(this,i),positioning:{type:s.Wr.Line,baseCommitOid:(0,q._)(this,iV),headCommitOid:(0,q._)(this,iW),path:(0,X._)(this,iY,i1).call(this,i),line:e.blobLineNumber,commitOid:(0,X._)(this,iZ,i2).call(this,i)},side:i,subjectType:s.Wr.Line}}multilineRequestData(e){let{endLineNumber:t,endOrientation:i,startLineNumber:n,startOrientation:r}=e,a="left"===i?"left":"right",o="left"===r?"left":"right";return{...(0,X._)(this,i0,i3).call(this),line:t,path:(0,X._)(this,iY,i1).call(this,a),positioning:{baseCommitOid:(0,q._)(this,iV),headCommitOid:(0,q._)(this,iW),type:s.Wr.Multiline,startPath:(0,X._)(this,iY,i1).call(this,o),startLine:n,startCommitOid:(0,X._)(this,iZ,i2).call(this,o),endPath:(0,X._)(this,iY,i1).call(this,a),endLine:t,endCommitOid:(0,X._)(this,iZ,i2).call(this,a)},side:a,startLine:n,startSide:o,subjectType:s.Wr.Multiline}}constructor({filePath:e,newTreeEntry:t,oldTreeEntry:i,selectedDiffRange:n,submitBatch:r,text:a}){(0,Q._)(this,iY),(0,Q._)(this,iZ),(0,Q._)(this,i0),(0,W._)(this,iV,{writable:!0,value:void 0}),(0,W._)(this,iq,{writable:!0,value:void 0}),(0,W._)(this,iW,{writable:!0,value:void 0}),(0,W._)(this,iz,{writable:!0,value:void 0}),(0,W._)(this,iX,{writable:!0,value:void 0}),(0,W._)(this,iQ,{writable:!0,value:void 0}),(0,W._)(this,iJ,{writable:!0,value:void 0}),(0,z._)(this,iV,n.baseOid),(0,z._)(this,iq,e),(0,z._)(this,iW,n.headOid),(0,z._)(this,iz,t),(0,z._)(this,iX,i),(0,z._)(this,iQ,r),(0,z._)(this,iJ,a)}};function i1(e){return"left"===e&&(0,q._)(this,iX)?.path&&(0,q._)(this,iz)?.path&&(0,q._)(this,iX).path!==(0,q._)(this,iz).path?(0,q._)(this,iX).path:(0,q._)(this,iq)}function i2(e){return"left"===e?(0,q._)(this,iV):(0,q._)(this,iW)}function i3(){return{comparisonEndOid:(0,q._)(this,iW),comparisonStartOid:(0,q._)(this,iV),text:(0,q._)(this,iJ),submitBatch:(0,q._)(this,iQ)}}let i4=(0,a.forwardRef)(function({annotationsAtPosition:e,columnIndex:t,copilotChatReference:i,currentHunk:r,diffAnchor:s,diffLine:o,dispatchMarkersStatus:d,filePath:c,handleDiffSideCellSelectionBlocking:u,isLeftSide:m,isRowSelected:f,isSplit:p,lineAnchor:b,markersStatus:v,nextHunk:C,previousHunk:y,rowId:L,subjectId:S,threadsAtPosition:N,viewerData:w},D){let[j,k]=(0,B.x_)(o.html,o.type),_=k&&["+","-"].includes(k),[A,E]=(0,a.useState)(""),{isActionBarVisible:R,hideActionBar:T}=t5(),{hasPersistedComment:O}=(0,g.L)({diffSide:m?"LEFT":"RIGHT",filePath:c,line:o.blobLineNumber,subjectId:S,fileLevelComment:!1}),P=(0,B.u6)(L,t),$=eJ(P),{disableDialogMode:F}=eY(),H=m?"LEFT":"RIGHT",U="RIGHT"===H?o.right:o.left,G=(0,B.oH)(U,H),K=N.length,V=e.length,q=(0,a.useRef)(null),W=(0,a.useRef)(null);(0,a.useImperativeHandle)(D,()=>W.current,[]);let z=0!==K+V,X=(0,B.S4)({hasThreads:z&&w.commentsPreference===tJ.sI.Collapsed}),Q=function(e,t,i){let n=eX();return(0,a.useMemo)(()=>{let r=n(),a="Add a comment on",s=!!r&&r.startLineNumber!==r.endLineNumber;if(r&&s&&i){let e={left:"L",right:"R"},t=e[r.startOrientation],i=e[r.endOrientation];a+=r.startLineNumber!==r.endLineNumber?` lines ${t}${r.startLineNumber} to ${i}${r.endLineNumber}`:` line ${t}${r.startLineNumber}`}else{let i=t&&!(0,B.Ji)(e)?"L":"R";a+=` line ${i}${e.blobLineNumber}`}return a},[e,n,t,i])}(o,!!m,f),{handleCellBlur:J,handleCellFocus:Z,handleCellMouseEnter:ee,handleCellMouseLeave:et}=t7({cellRef:W}),ei=(0,a.useRef)(null),en=tW(P,W,d),er=eW(),ea=eq(),es=eX(),eo=(0,iK.u)("cotd_ui"),el=(0,a.useCallback)(()=>{setTimeout(()=>W.current?.focus()),F(),d("USER_MINIMIZED_MARKERS")},[F,d]),ed=(0,a.useCallback)(()=>{w.commentsPreference===tJ.sI.Collapsed&&v.showMarkers?el():en()},[el,en,v.showMarkers,w.commentsPreference]),{closeMarkerListDialog:ec,returnFocusRef:eu,isContextMenuOpen:em}=t8({cellId:P,actionBarRef:q}),ef=(0,a.useCallback)(()=>{en(),w.shouldDisplayComments||T();let e=es();e||(e={startLineNumber:o.blobLineNumber,endLineNumber:o.blobLineNumber,startOrientation:m?"left":"right",endOrientation:m?"left":"right",diffAnchor:s});let t=new eH.L(e,c);h.cg?.dispatchEvent(t)},[en,w.shouldDisplayComments,es,c,T,o.blobLineNumber,m,s]),{isNewConversationDialogOpen:eh,shouldStartNewConversationWithSuggestedChange:ep,startNewConversation:eg,closeNewConversation:eb}=t6({cellId:P,onOpenDialog:ef}),ev=(0,a.useMemo)(()=>{if(!R)return!1;if(!w.shouldDisplayComments)if(eo)return!(0,B.Po)(o);else return(0,B.a1)(o,(0,B.Mk)(ea()));return!eh&&!!w.viewerCanComment&&(eo?!(0,B.Po)(o):(0,B.a1)(o,(0,B.Mk)(ea())))},[R,eh,w.shouldDisplayComments,w.viewerCanComment,eo,o,ea]),{endOid:eC,startOid:ex}=(0,tT.Xv)(),{mutate:ey}=iG(),{selectedRange:eL}=(0,x.L3)(),{newTreeEntry:eS,oldTreeEntry:eN}=eG(e=>e.treeEntries),ew=function(e,t){let{sendAnalyticsEvent:i}=(0,e4.s)(),n=eG(e=>e.diffLines.getSplitDiffLinesFromLineRange),r=eX(),[s]=(0,ie.I)(()=>!1,!0,[]),o=(e=>{let t=(0,a.useRef)(e);return(0,t9.N)(()=>(t.current=e,()=>t.current=null),[e]),(0,a.useCallback)((...e)=>t.current?.(...e),[])})(function(t,r){let a=function(t){if(!t)return"DELETION"!==e.type;if("right"===t.startOrientation&&"right"===t.endOrientation)return!0;if(t.startLineNumber===t.endLineNumber&&t.startOrientation===t.endOrientation)return"DELETION"!==e.type;let i=n(t)?.selectedLeftLines;return!!i?.every(e=>"empty-diff-line"!==e&&"DELETION"!==e.type)}(t);return{isValidSuggestionRange:a,showSuggestChangesButton:a,sourceContentFromDiffLines:a?function(t){let i=t?n(t)?.selectedRightLines:[];if(t&&i&&i.length>1)return s?"":(0,B.Ls)(i);if(!e)return"";let[r]=(0,B.dv)(e.text,e.type);return r}(t):void 0,onInsertSuggestedChange:()=>{i("diff.add_suggested_change","ADD_SUGGESTED_CHANGE_BUTTON")},shouldInsertSuggestedChange:r}});return(0,a.useMemo)(()=>({getSelectedLineRange:r,configureSuggestedChangesFromLineRange:o,shouldStartNewConversationWithSuggestedChange:t}),[o,r,t])}(o,ep),eD=(0,a.useCallback)(()=>{en?.(),eg?.()},[en,eg]),ej=(0,a.useRef)(!0),eI=(0,a.useMemo)(()=>!!w.shouldDisplayComments&&(z&&w.commentsPreference===tJ.sI.Collapsed?!v.userMinimized:(!!eh||!!z)&&(w.commentsPreference===tJ.sI.Collapsed&&(!!eh||!!$)||w.commentsPreference===tJ.sI.Visible&&(!!z||!!eh||!!v.showMarkers)||!1)),[z,$,eh,v.showMarkers,v.userMinimized,w.commentsPreference,w.shouldDisplayComments]),e_=(0,a.useMemo)(()=>(0,B.dT)(o),[o]),{addLineToSelection:eA,clearSelectedLines:eR,selectLine:eT}=e3(),eO=ez();(0,a.useEffect)(()=>{O&&w.commentsPreference===tJ.sI.Visible&&eD()},[O,eD,w.commentsPreference]);let eM=(0,a.useCallback)(()=>{let e=es();return!!e&&("right"===e.endOrientation&&!m&&e.endLineNumber===o.right||!!e&&"left"===e.endOrientation&&!!m&&e.endLineNumber===o.left)},[es,m,o.left,o.right]),eP=(0,a.useCallback)(()=>{eM()||eR()},[eR,eM]),e$=(0,a.useCallback)(e=>{if(1!==e.buttons)return;et();let t=m?o.left:o.right,i=(0,Y.bo)(o);f||!t||eM()?eA({lineKey:(0,Y.bo)(o),orientation:m?"left":"right"},eE):eT({lineKey:i,firstLineSelectionOnDrag:{lineNumber:t,orientation:m?"left":"right",lineKey:i,shouldStartConversation:!0}},eE)},[eA,et,eM,m,f,o,eT]),eF=(0,a.useCallback)(e=>{let t=eO();1===e.buttons&&t&&eA({lineKey:(0,Y.bo)(o),orientation:m?"left":"right"},eE),ee()},[eA,eO,ee,m,o]),eB=(0,a.useCallback)(()=>{let e=eO();if(!e){w.shouldDisplayComments||em||T(),et();return}let t=es(),i=t?.startOrientation==="right"&&"right"===e.orientation&&!m&&o.right===e.lineNumber,n=t?.startOrientation==="left"&&"left"===e.orientation&&m&&o.left===e.lineNumber;i||n||et()},[eO,es,m,o.right,o.left,w.shouldDisplayComments,em,et,T]),eU=(0,a.useCallback)(()=>{d("USER_EXITED_MARKERS_DIALOG")},[d]),eK=(0,a.useCallback)(()=>{d("USER_MINIMIZED_MARKERS")},[d]),eV=(0,a.useCallback)(()=>{el(),eb()},[el,eb]),eQ=async()=>{let e=er();await tZ({diffLine:o,diffLines:e,getSelectedDiffLines:ea,getSelectedLineRange:es,isSplit:p,isLeftSide:m})},eZ=`ContentCell-left:${o.left}-right:${o.right}-leftSide:${m}`,e0=`inline-dialog-heading-${(0,a.useId)()}`,e1=(0,a.useMemo)(()=>{if(!f)return o.blobLineNumber;let e=es();return e?.endLineNumber??o.blobLineNumber},[es,f,o.blobLineNumber]),e2=(0,a.useMemo)(()=>{if(!f)return;let e=es();return e?.startLineNumber},[es,f]);return(0,n.jsxs)(iH,{ref:W,cellId:P,columnIndex:t,commentDialogOpen:eh,diffAnchor:s,diffLine:o,enterDialogMode:en,handleDiffSideCellSelectionBlocking:u,handleExitDialogMode:eU,handleUserClosedMarkersDialog:eK,lineAnchor:b,handleStartConversation:eD,hasThreads:z,isLeftSide:m,isRowSelected:f,isSplit:p,className:(0,M.$)(`diff-text-cell ${m?"left-side-diff-cell":"right-side-diff-cell"} ${e_?"pt-4":""}`,{"border-right":m&&"HUNK"!==o.type}),style:{backgroundColor:(0,B.Yf)(o.type,!1,f),paddingRight:X},onBlur:J,onFocus:Z,onMouseEnter:eF,onMouseLeave:eB,"aria-labelledby":$?e0:void 0,role:$?"dialog":"gridcell",children:[$&&(0,n.jsx)("h1",{id:e0,className:"sr-only",children:"Comment view"}),(0,n.jsxs)("code",{className:(0,M.$)("diff-text syntax-highlighted-line",{addition:"ADDITION"===o.type,deletion:"DELETION"===o.type}),children:[_&&(0,n.jsx)("span",{className:"diff-text-marker",children:k}),(0,n.jsx)(I.$6,{html:j,className:(0,M.$)("diff-text-inner",{"color-fg-muted":"HUNK"===o.type})})]}),o.displayNoNewLineWarning&&(0,n.jsx)(l.NoEntryIcon,{size:16,className:"fgColor-danger"}),(R||o.isLastSelected&&m&&es()?.endOrientation==="left"&&o.left===es()?.endLineNumber||!m&&es()?.endOrientation==="right"&&o.right===es()?.endLineNumber)&&(0,n.jsx)(i$,{authorAvatarUrl:w.avatarUrl,authorLogin:w.login,ref:q,cellId:P,cellRef:W,copilotChatReference:i,currentHunk:r,diffAnchor:s,diffLine:o,threads:N,annotations:e,enterDialogMode:ef,handleCopyCode:eQ,hasDraftComment:O,isLeftSide:m,isSplit:p,nextHunk:C,onMouseDownAddCommentButton:eP,onMouseLeaveAddCommentButton:e$,previousHunk:y,showStartConversation:ev,shouldDisplayMinimizedComments:w.shouldDisplayComments,shouldDisplayCollapseComments:v.showMarkers,toggleViewingMarkers:ed,viewerData:w}),eI?(0,n.jsx)(tX,{backgroundColor:(0,B.Yf)(o.type,!0,f),gridCellId:P,gutterSizeOffset:X,inlineMarkersRef:ei,cellRef:W,dispatchMarkersStatus:d,lineMarkersKey:G,manuallyUpdateCommentsWithThisThreadId:A,annotations:e,batchingEnabled:!0,conversationListThreads:N,fileAnchor:s,filePath:c,onCloseFocusMode:el,isMarkerListOpen:!!W.current?.classList.contains("diff-text-cell")&&N.length>0,isRowSelected:f,lineType:o.type,returnFocusRef:eu,subjectId:S,suggestedChangesConfig:ew,onCloseConversationList:ec,onDeleteLineComment:()=>{N.length<=1&&setTimeout(()=>W.current?.focus())},viewerData:w,ghostUser:ek.ghostUser,children:eh&&(0,n.jsx)("div",{className:(0,M.$)(" border rounded-2 color-border-default",(N.length,"mt-2 mb-1")),children:(0,n.jsx)(e5,{addCommentDialogTitle:Q,anchorRef:W,diffAnchor:s,batchingEnabled:!0,filePath:c,focusOnMount:!(O&&w.commentsPreference===tJ.sI.Visible),isLeftSide:!!m,isInDialogMode:$,isOpen:eh,lineNumber:e1,returnFocusRef:eu,startLineNumber:e2,subjectId:S,suggestedChangesConfig:ew,viewerData:w,onAddComment:({onCompleted:e,onError:t,submitBatch:i,text:n})=>{if(!o)return;let r=es();if(eo){let a,s=new ReviewCommentFactory({filePath:c,newTreeEntry:eS,oldTreeEntry:eN,selectedDiffRange:eL,submitBatch:i,text:n});ey(a=r&&f&&r.startLineNumber&&r.endLineNumber&&r.startLineNumber!==r.endLineNumber?s.multilineRequestData(r):s.lineRequestData(o,m),{onError:t,onSuccess:t=>{e?.(t.thread.id,t.comment?.databaseId),en(),E(t.thread.id)}})}else{let a,s,l=!!r&&r.startLineNumber!==r.endLineNumber,d=o.blobLineNumber,u=m&&!(0,B.Ji)(o)?"left":"right";r&&l&&f&&(u="left"===r.endOrientation?"left":"right",s="left"===r.startOrientation?"left":"right",d=r.endLineNumber,a=r.startLineNumber),ey({text:n,line:d,path:c,side:u,startSide:s,submitBatch:i,startLine:a,comparisonEndOid:eC,comparisonStartOid:ex},{onError:t,onSuccess:t=>{e?.(t.thread.id,t.comment?.databaseId),en(),E(t.thread.id)}})}},onCloseCommentDialog:eV})})}):null,!R&&w.commentsPreference===tJ.sI.Collapsed&&w.shouldDisplayComments&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{"aria-hidden":"true",style:{left:"compact"===w.lineSpacingPreference?"-8px":"-9px"},className:(0,M.$)("position-absolute top-0 d-flex user-select-none",iB["in-progress-comment-indicator"]),children:O&&(0,n.jsx)(iM,{lineSpacingPreference:w.lineSpacingPreference,authorAvatarUrl:w.avatarUrl,authorLogin:w.login})}),(0,n.jsx)("div",{"aria-hidden":"true",className:(0,M.$)("position-absolute top-0 d-flex user-select-none",iB["comment-indicator"]),children:(0,n.jsx)(iu,{threads:N,annotations:e,shouldAnimateRef:ej,lineSpacingPreference:w.lineSpacingPreference})})]}),(0,n.jsx)(iF,{annotationCount:V,threadCount:K})]},eZ)}),i5=(0,a.memo)(i4);try{i4.displayName||(i4.displayName="ContentCellUnmemoized")}catch{}try{i5.displayName||(i5.displayName="ContentCell")}catch{}let i8=["CONTEXT","INJECTED_CONTEXT"],i6=(0,a.memo)(i7);function i7({children:e,columnIndex:t,diffAnchor:i,diffLine:r,handleDiffSideCellSelectionBlocking:s,isLeftSide:o,isRowSelected:l,isSplit:d,filePath:c,copilotChatReference:u,contentRef:m,contentColumnIndex:f,dispatchMarkersStatus:h,rowId:p,threadsAtPosition:g,annotationsAtPosition:b,...v}){var C;let x=(0,a.useRef)(null),y=ez(),{addLineToSelection:L}=e3(),S=(0,a.useCallback)(e=>{1===e.buttons&&y()&&L({lineKey:(0,Y.bo)(r),orientation:o?"left":"right"},eE)},[y,L,r,o]),{selectLine:N}=e3(),w=eX(),D=`LineNumberCell-left:${r.left}-right:${r.right}-leftSide:${o}`,j=(0,B.u6)(p,f),I=tW(j,m,h),{startNewConversation:k}=t6({cellId:j,onOpenDialog:I}),_=(0,B.u6)(p,t);return(0,n.jsx)(iH,{ref:x,cellId:_,className:(0,M.$)("diff-line-number position-relative",i8.includes(r.type)&&"diff-line-number-neutral"),columnIndex:t,diffAnchor:i,diffLine:r,"data-first-unified-line-number-cell":!d&&0===t,enterDialogMode:I,handleDiffSideCellSelectionBlocking:s,hasThreads:(C=g.length+b.length,("CONTEXT"!==r.type||!o||!d)&&C>0),style:{backgroundColor:(0,B.Yf)(r.type,!0,l),textAlign:"center"},handleDiffCellMouseDown:e=>{if(w()&&e.shiftKey)return void L({lineKey:(0,Y.bo)(r),orientation:o?"left":"right"},eE);let t=o?r.left:r.right;t&&N({lineKey:(0,Y.bo)(r),firstLineSelectionOnDrag:{orientation:o?"left":"right",lineNumber:t,shouldStartConversation:!1,lineKey:(0,Y.bo)(r)}},eE)},handleStartConversation:k,isLeftSide:o,isRowSelected:l,isSplit:d,onMouseEnter:S,...v,children:(0,n.jsx)("code",{children:e})},D)}try{i6.displayName||(i6.displayName="LineNumberCell")}catch{}try{i7.displayName||(i7.displayName="LineNumberCellUnmemoized")}catch{}function i9({columnIndex:e,diffAnchor:t,diffLine:i,isLeftSide:r,isSplit:a,showRightBorder:s}){return(0,n.jsx)(iH,{className:(0,M.$)("empty-diff-line",{"border-right":s}),columnIndex:e,diffAnchor:t,diffLine:i,isLeftSide:r,isSplit:a})}try{i9.displayName||(i9.displayName="EmptyCell")}catch{}function ne(e,t){switch(t){case"SHOW_MARKERS":return{userMinimized:!1,showMarkers:!0};case"USER_EXPANDED_MARKERS":return{showMarkers:!0,userMinimized:!1};case"USER_MINIMIZED_MARKERS":return{userMinimized:!0,showMarkers:!1};case"USER_EXITED_MARKERS_DIALOG":return{...e,showMarkers:!1}}}var nt=i(87825);let ni=({annotationsAtPosition:e,copilotChatReference:t,currentHunk:i,diffAnchor:r,diffLine:s,filePath:o,lineAnchor:l,handleDiffSideCellSelectionBlocking:d,hasHiddenUnicodeCharacters:c,isLeftSide:u,isRowSelected:m,isSplit:f,nextHunk:h,previousHunk:p,rowId:g,subjectId:b,threadsAtPosition:v,viewerData:C})=>{let x=(0,a.useRef)(null),y="ADDITION"!==s.type,L=!f||u,S="DELETION"!==s.type,N=!f||!u,w=(0,a.useCallback)(()=>{d&&d("left")},[d]),D=(0,a.useCallback)(()=>{d&&d("right")},[d]),j=f?u?1:3:2,[I,k]=function(e){let[t,i]=(0,a.useReducer)(ne,{userMinimized:e===tJ.sI.Collapsed,showMarkers:!1}),n=(0,a.useRef)(e);return(0,a.useEffect)(()=>{n.current!==e&&(n.current=e,e===tJ.sI.Visible?i("SHOW_MARKERS"):i("USER_MINIMIZED_MARKERS"))},[e,i]),[t,i]}(C.commentsPreference);return(0,n.jsxs)(t4,{children:[L&&(0,n.jsxs)(i6,{threadsAtPosition:v,annotationsAtPosition:e,copilotChatReference:t,columnIndex:0,contentColumnIndex:j,contentRef:x,diffAnchor:r,diffLine:s,dispatchMarkersStatus:k,filePath:o,handleDiffSideCellSelectionBlocking:D,isLeftSide:u,isRowSelected:m,isSplit:f,rowId:g,children:[c&&!S&&(0,n.jsx)(nr,{children:(0,n.jsx)(nt.o,{})}),y&&s.left]}),N&&(0,n.jsxs)(i6,{annotationsAtPosition:e,copilotChatReference:t,columnIndex:f?2:1,contentColumnIndex:j,contentRef:x,diffAnchor:r,diffLine:s,dispatchMarkersStatus:k,filePath:o,handleDiffSideCellSelectionBlocking:w,isLeftSide:u,isRowSelected:m,isSplit:f,rowId:g,threadsAtPosition:v,children:[c&&S&&(0,n.jsx)(nr,{children:(0,n.jsx)(nt.o,{})}),S&&s.right]}),(0,n.jsx)(i5,{annotationsAtPosition:e,copilotChatReference:t,columnIndex:j,currentHunk:i,diffAnchor:r,diffLine:s,dispatchMarkersStatus:k,filePath:o,lineAnchor:l,handleDiffSideCellSelectionBlocking:u?D:w,isLeftSide:u,isRowSelected:m,isSplit:f,markersStatus:I,nextHunk:h,previousHunk:p,ref:x,rowId:g,subjectId:b,threadsAtPosition:v,viewerData:C})]})},nn=({annotationsAtPosition:e,copilotChatReference:t,currentHunk:i,diffLine:r,diffAnchor:a,filePath:s,handleDiffSideCellSelectionBlocking:o,hasHiddenUnicodeCharacters:l,isLeftSide:d,isRowSelected:c,isSplit:u,nextHunk:m,previousHunk:f,rowId:h,subjectId:p,threadsAtPosition:g,viewerData:b})=>{if((0,B.Po)(r))return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i9,{columnIndex:2*!d,diffAnchor:a,diffLine:r,isLeftSide:d,isSplit:u}),(0,n.jsx)(i9,{columnIndex:d?1:3,diffAnchor:a,diffLine:r,isLeftSide:d,isSplit:u})]});let v=d?"left":(0,T.XU)(r.type),C="left"===v?r.left:r.right,x=(0,T.IQ)(a,v,C??0);switch(r.type){case"HUNK":return null;case"ADDITION":case"DELETION":case"CONTEXT":case"INJECTED_CONTEXT":return(0,n.jsx)(ns,{annotationsAtPosition:e,copilotChatReference:t,currentHunk:i,diffAnchor:a,diffLine:r,filePath:s,handleDiffSideCellSelectionBlocking:o,hasHiddenUnicodeCharacters:l,isLeftSide:d,isRowSelected:c,isSplit:u,lineAnchor:x,nextHunk:m,previousHunk:f,rowId:h,subjectId:p,threadsAtPosition:g,viewerData:b});default:throw Error(`cannot handle type ${r.type}`)}};function nr({children:e}){return(0,n.jsx)("span",{className:"position-absolute",style:{left:"-1px",zIndex:"1"},children:e})}let na=a.memo(nn),ns=a.memo(ni);try{ni.displayName||(ni.displayName="CodeDiffLineUnmemoized")}catch{}try{nn.displayName||(nn.displayName="DiffLineSideUnmemoized")}catch{}try{nr.displayName||(nr.displayName="DiffCodeAlert")}catch{}try{na.displayName||(na.displayName="DiffLineSide")}catch{}try{ns.displayName||(ns.displayName="CodeDiffLine")}catch{}function no({isSplit:e}){return(0,n.jsx)("div",{className:(0,M.$)("hunk-kebab-icon pr-2 pb-1",!e&&"hunk-kebab-icon-unified"),children:(0,n.jsx)(l.KebabHorizontalIcon,{})})}try{no.displayName||(no.displayName="HunkKebabIcon")}catch{}function nl({diffAnchor:e,diffLine:t,isLeftSide:i,isSplit:r,renderHunkButton:s}){let o=(0,a.useRef)(null),[l,d]=function(e){let[t,i]=(0,a.useState)(!1),[n,r]=(0,a.useState)(!1),s=(0,a.useCallback)(t=>{e.current&&e.current.contains(t.relatedTarget)||i(!1)},[e]),o=(0,a.useCallback)(()=>{e.current===document.activeElement&&i(!0)},[e]),l=(0,a.useCallback)(t=>{e.current&&!e.current.contains(t.relatedTarget)&&i(!1),r(!1)},[e]),d=(0,a.useCallback)(e=>{e.stopPropagation(),r(!0)},[]);return[{onFocus:o,onBlur:s},{"aria-hidden":!n,tabIndex:t?0:-1,onBlur:l,onFocusCapture:d,onKeyDownCapture:(0,a.useCallback)(e=>{eR(e.key)&&e.stopPropagation()},[])}]}(o);if((0,B.Po)(t))return null;let c=`HunkCell-left:${t.left}-right:${t.right}`;return(0,n.jsx)(iH,{className:"diff-hunk-cell",colSpan:4,columnIndex:0,diffAnchor:e,diffLine:t,isLeftSide:i,isSplit:r,ref:o,style:{backgroundColor:"var(--bgColor-accent-muted, var(--color-accent-subtle))",flexGrow:1},...l,children:(0,n.jsxs)("div",{className:"d-flex flex-row",children:[s?.(d)??(0,n.jsx)(no,{isSplit:r}),(0,n.jsx)("code",{className:"diff-text-cell hunk",children:(0,n.jsx)(I.$6,{className:"diff-text-inner color-fg-muted",html:t.html})})]})},c)}try{nl.displayName||(nl.displayName="HunkCell")}catch{}let nd={"expand-button-line":"ExpandableHunkHeaderDiffLine-module__expand-button-line--CbsbZ","expand-up-and-down":"ExpandableHunkHeaderDiffLine-module__expand-up-and-down--amzYl","expand-button-unified":"ExpandableHunkHeaderDiffLine-module__expand-button-unified--pt9f0"};function nc({direction:e,icon:t,isSplit:i,label:r,onClick:a,ariaLabel:s,className:o,...l}){let{sendAnalyticsEvent:d}=(0,e4.s)();return(0,n.jsx)("button",{onClick:()=>{a(),d("file_entry.expand_hunk","FILE_EXPANDER_BUTTON")},className:(0,M.$)("Button Button--iconOnly Button--invisible",nd["expand-button-line"],!i&&nd["expand-button-unified"],o),"aria-label":s??r,"data-direction":e,...l,children:(0,n.jsx)(t,{})})}function nu({currentHunk:e,diffAnchor:t,diffLine:i,fileLineCount:r,isLeftSide:s,isSplit:o,nextHunk:d,nextLine:c,previousHunk:u,prevLine:m}){let{expandStartOfHunk:f,expandEndOfPreviousHunk:h}=ih({currentHunk:e,nextHunk:d,previousHunk:u}),p=0===i.position&&0!==i.blobLineNumber||!m,g=!c,b=0===i.blobLineNumber,v=p||g,C=g&&i.blobLineNumber===r,x=(0,a.useMemo)(()=>!v&&!(i.blobLineNumber<=0)&&(!!(i.blobLineNumber-m.blobLineNumber<=20)||!!(c.blobLineNumber-i.blobLineNumber>=20)),[v,i,c,m]),y=(0,a.useMemo)(()=>!v&&!C&&i.blobLineNumber-m.blobLineNumber>20,[v,C,i,m]),L=(0,a.useMemo)(()=>!(i.blobLineNumber<=0)&&!b&&!!p,[p,b,i]),S=(0,a.useMemo)(()=>!p&&!C&&!!g,[p,g,C]),N=(0,a.useMemo)(()=>{switch(!0){case x:return"expand-all";case y:return"expand-up-and-down";case L:return"expand-up";case S:return"expand-down"}},[x,y,L,S]),w=()=>f(),D=()=>h(),j=()=>f(),I=eQ();return(0,n.jsx)(nl,{renderHunkButton:e=>{if(I.has(iy.YR.expandLines))return null;switch(N){case"expand-all":return(0,n.jsx)(nc,{...e,direction:"all",icon:l.UnfoldIcon,isSplit:o,label:`Expand file from line ${m?.blobLineNumber||""} to line ${c?.blobLineNumber||""}`,onClick:j});case"expand-up-and-down":return(0,n.jsxs)("div",{className:"d-flex flex-column",children:[(0,n.jsx)(nc,{...e,direction:"down",icon:l.FoldDownIcon,isSplit:o,label:`Expand file down from line ${m?.blobLineNumber||""}`,className:nd["expand-up-and-down"],onClick:D}),(0,n.jsx)(nc,{...e,direction:"up",icon:l.FoldUpIcon,isSplit:o,label:`Expand file up from line ${c?.blobLineNumber||""}`,className:nd["expand-up-and-down"],onClick:w})]});case"expand-up":return(0,n.jsx)(nc,{...e,direction:"up",icon:l.FoldUpIcon,isSplit:o,label:`Expand file up from line ${c?.blobLineNumber||""}`,onClick:w});case"expand-down":return(0,n.jsx)(nc,{...e,direction:"down",icon:l.FoldDownIcon,isSplit:o,label:`Expand file down from line ${m?.blobLineNumber||""}`,onClick:D});default:return null}},diffAnchor:t,diffLine:i,isLeftSide:s,isSplit:o})}try{nc.displayName||(nc.displayName="ExpandButtonLine")}catch{}try{nu.displayName||(nu.displayName="ExpandableHunkHeaderDiffLine")}catch{}var nm=i(12918);let nf=(0,a.memo)(function({copilotChatReference:e,diffHasHiddenUnicodeCharacters:t,filePath:i,handleDiffSideCellSelectionBlocking:r,hunksData:s,leftDiffLine:o,nextDiffLine:l,prevDiffLine:d,rightDiffLine:c,showHiddenUnicode:u,subjectId:m,viewerData:f}){let h=eZ(),p=e0(),g=e=>{let i=!1;return t&&!(0,B.Po)(e)&&(i=(0,eM.Y)(e.text),u&&i&&(e=e.html?{...e,html:(0,nm.Gx)(e.html)??e.html}:{...e,text:(0,eM.TA)(e.text)})),[e,i]},[b,v]=g(o),[C,y]=g(c),L=e2((0,B.Po)(b)?void 0:b),S=e2((0,B.Po)(C)?void 0:C),N=(0,a.useMemo)(()=>(0,B.Po)(b)?b:{...b,...L},[b,L]),w=(0,a.useMemo)(()=>(0,B.Po)(C)?C:{...C,...S},[C,S]),D=(0,B.qK)(N)&&"HUNK"===N.type,j=(0,B.qX)(h,o,c),I=(0,B.Po)(N)?(0,B.Po)(w)?void 0:w:N,k=(0,B.Po)(b)?void 0:(0,B.oH)(b.left,"LEFT"),{threads:_,annotations:A}=(0,x.rP)(i,k??""),E=(0,B.Po)(C)?void 0:(0,B.oH)(C.right,"RIGHT"),{threads:R,annotations:T}=(0,x.rP)(i,E??""),O=(0,a.useMemo)(()=>!(((0,B.Po)(N)||!N.isSelected)&&((0,B.Po)(w)||!w.isSelected)),[N,w]);if(!I)return null;let{currentHunk:M,nextHunk:P,previousHunk:$}=G(I,s);return N?(0,n.jsx)("tr",{className:"diff-line-row",children:D?(0,n.jsx)(nu,{currentHunk:M,diffAnchor:h,diffLine:o,fileLineCount:p,isLeftSide:!0,isSplit:!0,nextHunk:P,nextLine:l,previousHunk:$,prevLine:d}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(na,{annotationsAtPosition:A,copilotChatReference:e,currentHunk:M,diffLine:N,diffAnchor:h,filePath:i,handleDiffSideCellSelectionBlocking:r,hasHiddenUnicodeCharacters:v,isLeftSide:!0,isRowSelected:O,isSplit:!0,nextHunk:P,previousHunk:$,rowId:j,subjectId:m,threadsAtPosition:_,viewerData:f}),(0,n.jsx)(na,{threadsAtPosition:R,annotationsAtPosition:T,copilotChatReference:e,currentHunk:M,diffLine:w,diffAnchor:h,filePath:i,handleDiffSideCellSelectionBlocking:r,hasHiddenUnicodeCharacters:y,isLeftSide:!1,isRowSelected:O,isSplit:!0,nextHunk:P,previousHunk:$,rowId:j,subjectId:m,viewerData:f})]})},j):null});try{nf.displayName||(nf.displayName="SplitDiffRow")}catch{}let nh=(0,a.memo)(function({diffHasHiddenUnicodeCharacters:e,diffLines:t,fileAnchor:i,filePath:r,handleDiffSideCellSelectionBlocking:o,showHiddenUnicode:l,tableRef:d,copilotChatReference:c,subjectId:u,viewerData:m}){let{leftLines:f,rightLines:h}=function(e){let{leftLines:t,rightLines:i}=(0,a.useMemo)(()=>(function(e){let t=[],i=[],n=()=>{for(;t.length<i.length;)t.push(s.Vv);for(;i.length<t.length;)i.push(s.Vv)};for(let r of e)switch(r.type){case"ADDITION":i.push(r);break;case"DELETION":t.push(r);break;case"CONTEXT":case"INJECTED_CONTEXT":case"HUNK":n(),t.push(r),i.push(r)}return n(),{leftLines:t,rightLines:i}})(e),[e]);return{leftLines:t,rightLines:i}}(t),p=(0,a.useMemo)(()=>K(f),[f]),{addLineToSelection:g,clearSelectedLines:b,selectMultipleLines:v}=e3();return eT({addLineToSelection:g,clearSelectedLines:b,containerRef:d,fileAnchor:i,getfirstLineSelectionOnDrag:ez(),isSplitDiff:!0,leftLines:f,selectMultipleLines:v,rightLines:h,disabled:!1}),(0,n.jsx)(n.Fragment,{children:f.map((t,i)=>{let a=f[i],s=h[i],d=f[i-1],g=(0,B.Po)(f[i+1])?h[i+1]:f[i+1],b=`${(0,B.Po)(a)||!a?`empty-left-diff-${i}`:a.blobLineNumber}-${(0,B.Po)(s)||!s?`empty-right-diff-${i}`:s.blobLineNumber}`;return(0,n.jsx)(nf,{copilotChatReference:c,diffHasHiddenUnicodeCharacters:e,filePath:r,handleDiffSideCellSelectionBlocking:o,hunksData:p,leftDiffLine:a,nextDiffLine:g,prevDiffLine:d,rightDiffLine:s,showHiddenUnicode:l,subjectId:u,viewerData:m},b)})})});try{nh.displayName||(nh.displayName="SplitDiffLines")}catch{}let np=(0,a.memo)(function({copilotChatReference:e,diffHasHiddenUnicodeCharacters:t,filePath:i,hunksData:r,currentDiffLine:s,nextDiffLine:o,prevDiffLine:l,showHiddenUnicode:d,subjectId:c,viewerData:u}){let m=eZ(),f=e0(),h=e2(s),p=(0,a.useMemo)(()=>({...s,...h}),[s,h]),g=(0,a.useMemo)(()=>!!p.isSelected,[p.isSelected]),b="DELETION"!==s.type?"RIGHT":"LEFT",v="RIGHT"===b?s.right:s.left,C=(0,B.oH)(v,b),{threads:y,annotations:L}=(0,x.rP)(i,C??""),S="HUNK"===p.type,N=(0,T.IQ)(m,(0,T.XU)(p.type),p.blobLineNumber),{currentHunk:w,nextHunk:D,previousHunk:j}=G(p,r),I=(0,B.qX)(m,p,p),k=t&&(0,eM.Y)(p.text);d&&k&&(p=p.html?{...p,html:(0,nm.Gx)(p.html)??p.html}:{...p,text:(0,eM.TA)(p.text)});let _="DELETION"===p.type;return(0,n.jsx)("tr",{className:"diff-line-row",children:S?(0,n.jsx)(nu,{currentHunk:w,diffAnchor:m,diffLine:p,fileLineCount:f,isLeftSide:_,isSplit:!1,nextHunk:D,nextLine:o,previousHunk:j,prevLine:l}):(0,n.jsx)(ns,{annotationsAtPosition:L,copilotChatReference:e,currentHunk:w,diffAnchor:m,diffLine:p,filePath:i,hasHiddenUnicodeCharacters:k,isLeftSide:_,isRowSelected:g,isSplit:!1,lineAnchor:N,nextHunk:D,previousHunk:j,rowId:I,subjectId:c,threadsAtPosition:y,viewerData:u})},I)});try{np.displayName||(np.displayName="UnifiedDiffRow")}catch{}let ng=(0,a.memo)(function({diffHasHiddenUnicodeCharacters:e,diffLines:t,fileAnchor:i,filePath:r,tableRef:s,showHiddenUnicode:o,copilotChatReference:l,subjectId:d,viewerData:c}){let u=(0,a.useMemo)(()=>K(t.map(e=>e)),[t]),{addLineToSelection:m,clearSelectedLines:f,selectMultipleLines:h}=e3();return eT({addLineToSelection:m,clearSelectedLines:f,containerRef:s,fileAnchor:i,getfirstLineSelectionOnDrag:ez(),isSplitDiff:!1,leftLines:t,selectMultipleLines:h,disabled:!1}),(0,n.jsx)(n.Fragment,{children:t.map((i,a)=>{let s=t[a+1],m=t[a-1],f=`unified-diff-row-l:${i.left}-r:${i.right}-b:${i.blobLineNumber}`;return(0,n.jsx)(np,{copilotChatReference:l,diffHasHiddenUnicodeCharacters:e,filePath:r,hunksData:u,currentDiffLine:i,nextDiffLine:s,prevDiffLine:m,showHiddenUnicode:o,subjectId:d,viewerData:c},f)})})});try{ng.displayName||(ng.displayName="UnifiedDiffLines")}catch{}let nb={tableLayoutFixed:"DiffLines-module__tableLayoutFixed--UBX7h",compact:"DiffLines-module__compact--wxqBo"};var nv=i(60745);function nC({diffAnchor:e,children:t}){return(0,n.jsx)("div",{className:"fgColor-muted p-2","data-diff-anchor":e,children:t})}let nx=(0,a.memo)(function({diffEntryData:e,diffLinesManuallyUnhidden:t,baseHelpUrl:i,onHandleLoadDiff:r,copilotChatReference:a,hasExpandedAllRanges:s,isSplitView:o,subjectId:l,viewerData:d}){let c=`diff-${e.pathDigest}`;if(e.isBinary)return(0,n.jsx)(nC,{diffAnchor:c,children:"Binary file not shown."});if((0,E.dK)(e))return(0,n.jsx)(nC,{diffAnchor:c,children:"File renamed without changes."});if((0,E.Jc)(e))return(0,n.jsx)(nC,{diffAnchor:c,children:"File copied without changes."});if((0,E.Sn)(e,e.status,e.oldTreeEntry?.mode,e.newTreeEntry?.mode))return(0,n.jsx)(nC,{diffAnchor:c,children:"File mode changed."});if(!t&&(0,E.HI)(e))return(0,n.jsx)(F,{diffAnchor:c,onLoadDiff:r,children:(0,E.l_)(e.truncatedReason)});if((0,E.s8)(e))return(0,n.jsx)(nC,{diffAnchor:c,children:"Whitespace-only changes."});if(!t&&(0,E.lO)(e))return(0,n.jsx)(F,{diffAnchor:c,onLoadDiff:r,children:"This file was deleted."});if(!t&&(0,E.xW)(e))return(0,n.jsxs)(F,{diffAnchor:c,helpText:"customizing how changed files appear on GitHub.",helpUrl:`${i}/github/administering-a-repository/customizing-how-changed-files-appear-on-github`,onLoadDiff:r,children:["Some generated files are not rendered by default. Learn more about"," "]});if(e.isTooBig&&0===e.diffLines.length)if(t)return(0,n.jsxs)(nC,{diffAnchor:c,children:["Diff is too big to render. To view,"," ",(0,n.jsx)(O.A,{inline:!0,href:`${i}/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally`,children:"check out this pull request locally."})]});else return(0,n.jsx)(F,{diffAnchor:c,onLoadDiff:r,children:"Large diffs are not rendered by default."});return e.diffLines?(0,n.jsx)(ny,{diffAnchor:c,diffEntryData:e,viewerData:d,copilotChatReference:a,hasExpandedAllRanges:s,isSplitView:o,subjectId:l}):null});function ny({diffAnchor:e,viewerData:t,diffEntryData:i,copilotChatReference:r,hasExpandedAllRanges:s,isSplitView:o,subjectId:l}){let d=(0,a.useRef)(null),{clearSelectedLines:c}=e3(),[m,f]=(0,a.useState)(null),[p,g]=(0,a.useState)(!1),b=i.newTreeEntry?.lineCount??i.oldTreeEntry?.lineCount??0,v=(0,a.useMemo)(()=>{let e=i.diffLines[i.diffLines.length-1];return e?.blobLineNumber&&e.blobLineNumber<b?i.diffLines.concat({__id:H.finalLineId,blobLineNumber:e.blobLineNumber+1,left:null,right:null,type:"HUNK",html:"",text:""}):i.diffLines},[i.diffLines,b]),{lineSpacingPreference:C,tabSizePreference:x}=t,y=eG(e=>e.diffLines.hasSelectedLines),L=(0,a.useCallback)(e=>{if(!d.current||!e.target)return;let t=e.target;!d.current.contains(t)&&(t.closest("td.diff-line-number")||t.closest("[data-add-comment-button]"))&&y()&&(c(),(0,eA.i)("Selection Cleared"),(0,u.K3)())},[c,y]);(0,a.useEffect)(()=>(h.XC?.addEventListener("mousedown",L),()=>{h.XC?.removeEventListener("mousedown",L)}),[L]);let S=(0,a.useMemo)(()=>{let e,t=i.status,n=i.oldTreeEntry?.path,r=i.newTreeEntry?.path;if(n||r)return e="RENAMED"===t?`${n} renamed to ${r}`:"DELETED"===t||"REMOVED"===t?n:r,`Diff for: ${e}`},[i]),N=(0,T.c7)(v),w=(0,a.useCallback)(e=>{f(e)},[f]),D=(0,a.useCallback)(e=>{if(e.shiftKey&&e.metaKey&&"ArrowLeft"===e.key&&!s&&e.target?.getAttribute("role")==="gridcell"){let e=document.querySelector(`.js-expand-all-difflines-button[data-file-path="${i.path}"]`);e?.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0}))}},[s,i.path]),j=(0,a.useCallback)(e=>{let t=document.getSelection();if(t){let i=[];for(let e=0;e<t.rangeCount;e++){let n=t.getRangeAt(e).cloneContents();if(n.querySelectorAll("td").length){let e=`td.diff-line-number, span.diff-text-marker${o?`, ${"left"===m?"td.left-side-diff-cell":"td.right-side-diff-cell"}`:""}`;for(let t of n.querySelectorAll(e))t.parentNode&&t.parentNode.removeChild(t);for(let e of n.children){if(0===e.querySelectorAll("td.diff-text-cell").length)continue;let t=e.textContent;`
`===t?i.push(""):i.push(t)}}else if(1===t.rangeCount){let e=t.toString();if(!e)continue;i.push(e)}else{let e=n.textContent;if(!e)continue;i.push(e)}}e.clipboardData.setData("text/plain",i.join(`
`)),e.preventDefault()}},[m,o]),I=(0,a.useMemo)(()=>v.some(e=>(0,eM.Y)(e.text)),[v]),k={diffHasHiddenUnicodeCharacters:I,diffLines:v,fileAnchor:e,fileLineCount:b,filePath:i.path,handleDiffSideCellSelectionBlocking:w,showHiddenUnicode:p,tableRef:d,copilotChatReference:r,subjectId:l,viewerData:t};return(0,n.jsxs)(n.Fragment,{children:[I&&(0,n.jsx)(nv.a,{isShown:p,toggleShowHiddenCharacters:()=>g(!p)}),(0,n.jsx)("table",{"aria-label":S,onKeyDown:D,ref:d,className:(0,M.$)("tab-size","width-full",nb.tableLayoutFixed,{[nb.compact]:"compact"===C}),"data-block-diff-cell-selection":m,"data-diff-anchor":e,"data-tab-size":x,"data-paste-markdown-skip":!0,onCopy:j,role:"grid",style:{"--line-number-cell-width":`${N}px`,"--line-number-cell-width-unified":`${2*parseFloat(N)}px`},children:o?(0,n.jsx)(R.wj,{lineWidth:N,children:(0,n.jsx)(nh,{...k})}):(0,n.jsx)(R.Qe,{lineWidth:N,children:(0,n.jsx)(ng,{...k})})})]})}try{nC.displayName||(nC.displayName="PlainTextStatus")}catch{}try{nx.displayName||(nx.displayName="DiffLines")}catch{}try{ny.displayName||(ny.displayName="CodeDiffLines")}catch{}var nL=i(8431),nS=i(46251),nN=i(78049);let nw={filesActionList:"SubmoduleDiff-module__filesActionList--sbPQt",fileRowLinkItem:"SubmoduleDiff-module__fileRowLinkItem--Z1ES5",path:"SubmoduleDiff-module__path--hB1wm",fileRow:"SubmoduleDiff-module__fileRow--Y9n2E",linesAdded:"SubmoduleDiff-module__linesAdded--tJqtP",linesDeleted:"SubmoduleDiff-module__linesDeleted--nr9cp"};function nD({submodule:e}){let{basePath:t,changedFiles:i,contentsUrl:r,newCommitOid:s,oldCommitOid:o,status:d,submoduleUrl:c}=e,u=e.summary.length>0&&e.contentsUrl&&"MODIFIED"===d,m=(0,a.useMemo)(()=>{switch(d){case"ADDED":return(0,n.jsx)(nk,{commitOid:s,contentsUrl:r,type:"added"});case"DELETED":case"REMOVED":return(0,n.jsx)(nk,{commitOid:o,contentsUrl:r,type:"deleted"});default:return(0,n.jsx)(n_,{newCommitOid:s,oldCommitOid:o,changedFiles:i,contentsUrl:r})}},[s,o,d,i,r]);return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:`px-3 py-2 ${u?"border-bottom bgColor-muted":""}`,children:[(0,n.jsx)(l.FileSubmoduleIcon,{className:"fgColor-muted mr-2",size:16}),(0,n.jsx)(nj,{basePath:t,submoduleUrl:c}),m]}),u&&(0,n.jsx)(ia.l,{className:nw.filesActionList,showDividers:!0,variant:"full",children:e.summary.map(e=>(0,n.jsx)(nA,{compareUrl:`${r}/compare/${o}...${s}`,linesAdded:e.linesAdded,linesDeleted:e.linesDeleted,path:e.path,pathDigest:e.pathDigest,status:e.status},e.pathDigest))})]})}function nj({basePath:e,submoduleUrl:t}){return(0,n.jsxs)(n.Fragment,{children:["Submodule"," ",t?(0,n.jsx)(O.A,{inline:!0,href:t,children:e}):e," "]})}function nI(e){return e.slice(0,7)}function nk({commitOid:e="",contentsUrl:t,type:i}){let r="added"===i?"added at":"deleted from";return t?(0,n.jsxs)(n.Fragment,{children:[r," ",(0,n.jsx)(O.A,{inline:!0,href:`${t}/tree/${e}`,children:nI(e)})]}):(0,n.jsxs)(n.Fragment,{children:[r," ",nI(e)]})}function n_({newCommitOid:e="",oldCommitOid:t="",changedFiles:i=0,contentsUrl:r}){let a=i>0&&r?`${i} ${1===i?"file":"files"}`:`from ${nI(t)} to ${nI(e)}`;return(0,n.jsxs)(n.Fragment,{children:["updated"," ",r?(0,n.jsx)(O.A,{inline:!0,href:`${r}/compare/${t}...${e}`,children:a}):a]})}function nA({compareUrl:e,linesAdded:t,linesDeleted:i,path:a,pathDigest:s,status:o}){return(0,n.jsx)(ia.l.LinkItem,{href:`${e}#diff-${s}`,className:nw.fileRowLinkItem,children:(0,n.jsxs)(nS.B,{gap:"condensed",direction:"horizontal",align:"center",className:nw.fileRow,children:[(0,n.jsx)(nN.E,{status:o}),(0,n.jsxs)("div",{className:"d-flex gap-1 flex-justify-between width-full",children:[(0,n.jsx)("span",{className:nw.path,children:a}),(t>0||i>0)&&(0,n.jsxs)("div",{className:"d-flex flex-shrink-0 gap-1 flex-nowrap",children:[(0,n.jsx)("div",{className:nw.linesAdded,children:t>0&&(0,n.jsxs)(r.C,{isAddition:!0,children:["+",nE(t)]})}),(0,n.jsx)("div",{className:nw.linesDeleted,children:i>0&&(0,n.jsxs)(r.C,{isAddition:!1,children:["-",nE(i)]})})]})]})]})})}function nE(e){return e>999?`${(e/1e3).toFixed(1)}k`:e.toLocaleString()}try{nD.displayName||(nD.displayName="SubmoduleDiff")}catch{}try{nj.displayName||(nj.displayName="SubmodulePath")}catch{}try{nk.displayName||(nk.displayName="SubmoduleCommitChange")}catch{}try{n_.displayName||(n_.displayName="SubmoduleModified")}catch{}try{nA.displayName||(nA.displayName="SubmoduleFileRow")}catch{}let nR=({path:e,oid:t,repository:i})=>e&&t?{type:"file",url:(0,t$.IO9)({repo:i,commitish:t,action:"raw",path:e}),path:e,repoID:i.id,repoName:i.name,repoOwner:i.ownerLogin,ref:t,commitOID:t}:null,nT={ReviewThreadContainer:"FileReviewThread-module__ReviewThreadContainer--InwxI",ReviewThreadHeading:"FileReviewThread-module__ReviewThreadHeading--oFg3s",ReviewThreadInnerContainer:"FileReviewThread-module__ReviewThreadInnerContainer--jYE3S",SpinnerWrapper:"FileReviewThread-module__SpinnerWrapper--zQOoj"};function nO({fileAnchor:e,filePath:t,thread:i,isFirstThread:r,ghostUser:o,manuallyUpdateCommentsWithThisThreadId:d,...u}){let m=(0,a.useRef)(null),f=(0,tp.A)("localStorage"),h=i?.isResolved,[p,g]=(0,a.useState)(""),[b,v]=(0,a.useState)(h??!1);(0,a.useEffect)(()=>{let e=localStorage.getItem(`reviewThreadIsCollapsed_${i.id}`);null!==e?v(JSON.parse(e)):h&&v(!0)},[h,i.id]);let{sendAnalyticsEvent:C}=(0,e4.s)(),{mutate:x}=(0,tM.H)(t,s.zW),{mutate:y}=(0,tP.i)(t,s.zW);if(!i||!(i.commentsData?.comments&&i.commentsData.comments.length>0))return null;let L=!!i.isResolved,S=i.commentsData?.comments?.some(e=>e.state?.toUpperCase()!=="PENDING"),N=i.commentsData?.comments[0]?.createdAt,w=i.commentsData?.comments[0]?.author?.login??"Unknown Author",D=`${h?"Unresolve":"Resolve"} comment`;if(N){let e=(0,tf.C)(new Date(N));D=`${h?"Unresolve":"Resolve"} ${w}'s comment, ${e}`}return(0,n.jsx)(th.t,{fallback:(0,n.jsx)(tC,{}),children:(0,n.jsxs)("div",{className:"rounded-2 bgColor-default",ref:m,children:[(0,n.jsxs)("div",{className:(0,M.$)("px-1",nT.ReviewThreadContainer),children:[(0,n.jsx)(c.K,{"aria-label":b?"Expand comment":"Collapse comment",icon:b?l.ChevronRightIcon:l.ChevronDownIcon,size:"small",variant:"invisible",onClick:()=>{window.requestAnimationFrame(()=>{f.setItem(`reviewThreadIsCollapsed_${i.id}`,JSON.stringify(!b))}),v(e=>!e)},"data-is-first-collapse-button":r}),(0,n.jsx)("h2",{className:nT.ReviewThreadHeading,children:"Comment on file"}),(0,n.jsxs)("div",{className:nT.ReviewThreadInnerContainer,children:[i.positioning?.isOutdated&&(0,n.jsx)(tg.A,{variant:"secondary",children:"Outdated"}),L&&(0,n.jsx)(tg.A,{variant:"secondary",children:"Resolved"})]})]}),(0,n.jsxs)(a.Suspense,{fallback:(0,n.jsxs)("div",{className:nT.SpinnerWrapper,children:[(0,n.jsx)(k.A,{}),(0,n.jsx)("p",{children:"Loading comments"})]}),children:[p&&(0,n.jsxs)(tb.A,{variant:"danger",className:"m-2",children:[(0,n.jsx)(l.StopIcon,{className:"mr-2"}),p]}),!b&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(tO,{lineMarkersKey:s.zW,batchingEnabled:!0,filePath:t,gridCellId:`${t}-file-level-markers`,isInlineComment:!1,thread:i,shouldLimitHeight:!1,...u,ghostUser:o}),S&&(0,n.jsxs)("div",{className:"d-flex flex-items-center p-2 border-top flex-wrap",children:[(0,n.jsx)(P.Q,{"aria-label":D,onClick:L?()=>{i&&(y({threadId:i.id},{onError:()=>g("Failed to unresolve thread"),onSuccess:()=>{v(!1),f.removeItem(`reviewThreadIsCollapsed_${i.id}`)}}),C("comments.unresolve_thread","RESOLVE_CONVERSATION_BUTTON"))}:()=>{i&&!i.isResolved&&(x({threadId:i.id},{onError:()=>g("Failed to resolve thread"),onSuccess:()=>{v(!0),f.removeItem(`reviewThreadIsCollapsed_${i.id}`)}}),C("comments.resolve_thread","RESOLVE_CONVERSATION_BUTTON"))},className:"mr-2",children:h?"Unresolve comment":"Resolve comment"}),L&&i.resolvedBy&&(0,n.jsxs)("span",{className:"fgColor-muted f6",children:[(0,n.jsx)("b",{children:i.resolvedBy})," marked this comment as resolved"]})]})]})]})]})})}try{nO.displayName||(nO.displayName="FileReviewThread")}catch{}function nM({conversationListThreads:e,filePath:t,manuallyUpdateCommentsWithThisThreadId:i,ghostUser:r,...s}){let o=(0,a.useRef)(null);return e7({containerRef:o,markers:e,disabled:!1,focusInStrategy:"closest"}),(0,n.jsx)("div",{className:"d-flex pt-1 px-1",children:(0,n.jsx)("div",{className:tm.fileMarkersWrapper,ref:o,children:e.map((i,a)=>(0,n.jsx)("div",{className:(0,M.$)("mt-1 border rounded-2 color-border-default color-shadow-small",a===e.length-1?"mb-1":"mb-2"),"data-first-marker":0===a,"data-marker-id":`${i.id}`,tabIndex:0,children:(0,n.jsx)(nO,{subjectId:s.subjectId,viewerData:s.viewerData,filePath:t,thread:i,ghostUser:r},i.id)},`review-thread-${i.id}`))})})}try{nM.displayName||(nM.displayName="FileMarkers")}catch{}let nP=new Set,n$=(0,a.forwardRef)(function({addFileCommentButtonRef:e,collapsed:t,currentUser:i,diffLines:o,diffManuallyExpanded:d,diffSize:c,helpUrl:u,fileComments:m,hiddenFeatures:f=nP,isAddingFileComment:p,isBinary:g,isSelected:b=!1,isSubmodule:v,isTooBig:C,leftSideContent:y,linesAdded:L,linesChanged:S,linesDeleted:w,newTreeEntry:D,newCommitOid:j,objectId:I,oldTreeEntry:k,oldCommitOid:_,onToggleCollapse:E,path:R,pathDigest:T,pullRequestGlobalRelayId:O,repository:P,richDiffState:$,rightSideContent:F,setIsAddingFileComment:B,hasExpandedAllRanges:H,expandAllContextLines:U,canExpandOrCollapseLines:G,status:K,submodule:V,truncatedReason:q,addInjectedContextLines:W,loadDiff:z},X){let Q=v&&!!V,J=!Q&&!$?.showRichDiff,[Y,Z]=(0,a.useState)(d),ee=(0,x.j5)(),et=function({isBinary:e,isSubmodule:t,path:i,status:n,repository:r,newCommitOid:s,newTreeEntry:o,oldCommitOid:l,oldTreeEntry:d,pathDigest:c,hasCopilotAccess:u}){return(0,a.useMemo)(()=>{if((({hasCopilotAccess:e,isBinary:t,isSubmodule:i,path:n,repository:r,status:a})=>!!e&&!t&&!i&&!!n&&"DELETED"!==a&&"REMOVED"!==a&&!!r.id&&!!r.name&&!!r.ownerLogin&&!0)({isBinary:e,isSubmodule:t,path:i,status:n,repository:r,hasCopilotAccess:u}))return(({newCommitOid:e,newTreeEntry:t,oldCommitOid:i,oldTreeEntry:n,path:r,pathDigest:a,repository:s})=>{let o=i&&e?(0,t$.IO9)({repo:s,commitish:i,action:"raw",path:r}):"";return{baseFile:nR({path:n?.path,oid:i,repository:s}),headFile:nR({path:t?.path,oid:e,repository:s}),baseBranchRef:i,id:`#diff-${a}`,type:"file-diff",url:o}})({newCommitOid:s,newTreeEntry:o,oldCommitOid:l,oldTreeEntry:d,path:i,pathDigest:c,repository:r})},[s,o,l,d,c,r,u,e,t,i,n])}({isBinary:g,isSubmodule:v,path:R,status:K,repository:P,newCommitOid:j,newTreeEntry:D,oldCommitOid:_,oldTreeEntry:k,pathDigest:T,hasCopilotAccess:i.hasCopilotAccess}),ei=async()=>{await z(),Z(!0)},{endOid:en,startOid:er}=(0,tT.Xv)(),ea=(0,iK.u)("cotd_ui"),{selectedRange:es}=(0,x.L3)(),{mutate:eo}=iG(),el=(0,a.useMemo)(()=>({avatarUrl:i?.avatarURL??"",diffViewPreference:i?.splitPreference,login:i?.login??"",lineSpacingPreference:i?.lineSpacing,shouldDisplayComments:i?.shouldDisplayComments,shouldDisplayEditOptions:i?.shouldDisplayEditOptions,tabSizePreference:i?.tabSize??4,viewerCanComment:i?.canComment,viewerCanApplySuggestion:i?.canApplySuggestion,commentsPreference:i?.commentsPreference}),[i]),ed=(0,a.useId)(),ec=`heading-${ed}`,eu=(0,a.useMemo)(()=>"split"===new URLSearchParams(h.cg?.location.search).get("diff")||"split"===i.splitPreference,[i.splitPreference]),em=D?.lineCount??k?.lineCount??0;return(0,n.jsxs)(eK,{addInjectedContextLines:W,diffAnchor:`diff-${T}`,diffLines:o,fileLineCount:em,path:R,hiddenFeatures:f,isSplitView:eu,oldTreeEntry:k,newTreeEntry:D,children:[(0,n.jsxs)("div",{role:"region",ref:X,"aria-labelledby":ec,id:`diff-${T}`,className:(0,M.$)(nL.A.diffTargetable,nL.A.diff),"data-targeted":b,children:[(0,n.jsx)("div",{className:nL.A.diffHeaderWrapper,children:(0,n.jsx)(r.B,{headingId:ec,hiddenFeatures:f,areLinesExpanded:H,canExpandOrCollapseLines:G,fileLinkHref:`#diff-${T}`,isCollapsed:t,isBinary:g,size:c,canToggleRichDiff:$?.richDiff?.canToggleRichDiff,linesAdded:L,linesChanged:S,linesDeleted:w,newMode:D?.mode,newPath:D?.path,oldMode:k?.mode,oldPath:k?.path,patchStatus:K,path:R,onToggleExpandAllLines:U,onToggleFileCollapsed:e=>E(e,!t),onToggleDiffDisplay:$?.onToggleRichDiff,additionalLeftSideContent:y,rightSideContent:F,showRichDiff:$?.showRichDiff,isInSingleFileMode:ee})}),t?null:(0,n.jsxs)("div",{className:"border position-relative rounded-bottom-2",children:[(0,n.jsxs)(n.Fragment,{children:[m.length>0&&(0,n.jsx)(nM,{conversationListThreads:m,filePath:R,subjectId:O||""}),p&&(0,n.jsx)("div",{className:(0,M.$)("border rounded-2 color-border-default m-1 rounded-2 bgColor-default",nL.A.diffAddFileThread),children:(0,n.jsx)(N,{batchingEnabled:!0,filePath:R,fileLevelComment:!0,isLeftSide:void 0,subjectId:O||"",viewerData:el,onAddComment:({onCompleted:e,onError:t,submitBatch:i,text:n})=>{ea?eo(new ReviewCommentFactory({filePath:R,selectedDiffRange:es,submitBatch:i,text:n}).fileRequestData(),{onError:t,onSuccess:t=>{e?.(t.thread.id,t.comment.databaseId),B(!1)}}):eo({text:n,path:R,submitBatch:i,subjectType:s.Wr.File,comparisonEndOid:en,comparisonStartOid:er},{onError:t,onSuccess:t=>{e?.(t.thread.id,t.comment.databaseId),B(!1)}})},onClose:()=>{B(!1),e?.current?.focus()}})})]}),Q&&(0,n.jsx)(nD,{submodule:V}),$?.showRichDiff&&(0,n.jsx)(A,{queryConfig:$.queryConfig,initialData:$.richDiff}),J&&(0,n.jsx)(nx,{hasExpandedAllRanges:H,copilotChatReference:et,diffEntryData:{diffLines:o,isBinary:g,isTooBig:C,linesChanged:S,newTreeEntry:D,newCommitOid:j,objectId:I,oldTreeEntry:k,oldCommitOid:_,path:R,pathDigest:T,status:K,truncatedReason:q},baseHelpUrl:u,subjectId:O||"",viewerData:el,isSplitView:eu,diffLinesManuallyUnhidden:Y,onHandleLoadDiff:ei})]})]},`${T}_${o.length}`),ee&&(0,n.jsxs)("div",{className:nL.A.diffFooter,children:[(0,n.jsx)(l.InfoIcon,{size:16,"aria-hidden":"true"}),(0,n.jsx)("span",{className:"text-center",children:"Due to the large number of changes in this pull request, only one file is being shown at a time."})]})]})});function nF({path:e,pathDigest:t,linesAdded:i,linesChanged:s,linesDeleted:o,oldTreeEntry:d,newTreeEntry:c,status:u}){let m=(0,a.useId)(),f=`heading-${m}`,[h,p]=(0,a.useState)(!1);return(0,n.jsxs)("div",{role:"region","aria-labelledby":f,id:`diff-${t}`,className:(0,M.$)(nL.A.diffTargetable,nL.A.diff),children:[(0,n.jsx)("div",{className:nL.A.diffHeaderWrapper,children:(0,n.jsx)(r.B,{headingId:f,isCollapsed:h,isBinary:!1,linesAdded:i,linesChanged:s,linesDeleted:o,newMode:c?.mode,newPath:c?.path,oldMode:d?.mode,oldPath:d?.path,patchStatus:u,path:e,onToggleFileCollapsed:()=>p(!h)})}),!h&&(0,n.jsx)("div",{className:"border position-relative rounded-bottom-2",children:(0,n.jsxs)(tv.E,{children:[(0,n.jsx)(tv.E.Visual,{children:(0,n.jsx)(l.AlertIcon,{size:"medium",className:"fgColor-muted"})}),(0,n.jsx)(tv.E.Heading,{as:"h4",children:"There was an issue loading this file"}),(0,n.jsxs)(tv.E.Description,{children:[" ","Try refreshing the page or if the problem persists"," ",(0,n.jsx)("a",{className:"fgColor-muted",href:"https://support.github.com/",children:(0,n.jsx)("u",{children:"contact support"})}),"."]})]})})]},`${t}_error`)}let nB=(0,a.memo)(n$);try{n$.displayName||(n$.displayName="DiffUnmemoized")}catch{}try{nF.displayName||(nF.displayName="DiffErrorFallback")}catch{}try{nB.displayName||(nB.displayName="Diff")}catch{}},88008:(e,t,i)=>{i.d(t,{CE:()=>a,Ol:()=>s,hW:()=>o});var n=i(95800);function r(e,t){return`${e}-${t}-active-batch-suggestions`}function a(e,t,i){let a=r(e,t);(0,n.SO)(a,JSON.stringify(i))}function s(e,t){let i=r(e,t),a=(0,n.Gq)(i);if(!a)return[];try{let e=JSON.parse(a);return Array.isArray(e)?e:[]}catch{return[]}}function o(e,t){let i=r(e,t);(0,n.Ai)(i)}},90274:(e,t,i)=>{i.d(t,{GF:()=>d,S:()=>l,Xh:()=>s});var n=i(74848),r=i(38267),a=i(48505);function s({annotationLevel:e,...t}){let{icon:i,...r}=d[e];return function({fill:e,stroke:t,ariaLabel:i,svgHtml:r,className:a}){return(0,n.jsx)("svg",{"aria-label":i,className:a,fill:e,height:"24",stroke:t,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",style:{boxShadow:"none"},viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",children:r})}({...i,...r,...t})}let o=(0,r.i7)(["0%{opacity:0;}100%{opacity:1;}"]),l=(0,r.Ay)(s).withConfig({displayName:"AnnotationIcon__AnimatedAnnotationIcon",componentId:"sc-541735e4-0"})(["animation:"," 0.1s ease-in;"],o),d={[a.UZ.Failure]:{priority:1,ariaLabel:"Check failure",primaryColor:"danger.fg",primaryColorClass:"fgColor-danger",borderColor:"borderColor-danger-emphasis",icon:{fill:"var(--bgColor-danger-emphasis, var(--color-danger-emphasis))",stroke:"var(--fgColor-onEmphasis, var(--color-fg-on-emphasis))",svgHtml:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,n.jsx)("line",{x1:"15",x2:"9",y1:"9",y2:"15"}),(0,n.jsx)("line",{x1:"9",x2:"15",y1:"9",y2:"15"})]})}},[a.UZ.Warning]:{priority:2,ariaLabel:"Check warning",primaryColor:"attention.fg",primaryColorClass:"fgColor-attention",borderColor:"borderColor-attention-emphasis",icon:{fill:"var(--bgColor-attention-emphasis, var(--color-attention-emphasis))",stroke:"var(--fgColor-onEmphasis, var(--color-fg-on-emphasis))",svgHtml:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,n.jsx)("line",{x1:"12",x2:"12",y1:"8",y2:"12"}),(0,n.jsx)("line",{x1:"12",x2:"12",y1:"16",y2:"16"})]})}},[a.UZ.Notice]:{priority:3,ariaLabel:"Check notice",primaryColor:"fg.muted",primaryColorClass:"fgColor-muted",borderColor:"fgColor-muted",icon:{fill:"var(--bgColor-neutral-emphasis, var(--color-neutral-emphasis))",stroke:"var(--fgColor-onEmphasis, var(--color-fg-on-emphasis))",svgHtml:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,n.jsx)("line",{x1:"12",x2:"12",y1:"16",y2:"12"}),(0,n.jsx)("line",{x1:"12",x2:"12",y1:"8",y2:"8"})]})}}};try{s.displayName||(s.displayName="AnnotationIcon")}catch{}try{l.displayName||(l.displayName="AnimatedAnnotationIcon")}catch{}},93642:(e,t,i)=>{function n(e,t){for(let i of function e(t,i=[]){if(""===t)return i;let n=t.match(r());if(!n)return i;let a=n.groups.fence;if(!a)return i;let s=a.includes("~")?"~":"`",o=t.match(function(e,t){let i=r([e],t);return RegExp(`${i.source}(?:\r?
)(?<suggestion>.*?)(?:\r?
)^ {0,3}${e}{${t},}[ 	]*$`,"ms")}(s,a.length));if(!o)return i;let l=0,d=n.groups.indent;""!==d&&(l=d.length);let c=o.groups.suggestion;if(l>0){let e=RegExp(`^ {0,${l}}`,"m");c=c.replace(e,"")}return i.push(c),e(t.slice(o.index+o[0].length),i)}(e))if(i===t)return{isValid:!1,errorMessage:"Suggested change cannot be the same as the original line"};return{isValid:!0,errorMessage:""}}function r(e=["`","~"],t){let i=t?`{${t}}`:"{3,}",n=e.map(e=>`${e}${i}`);return RegExp(`^(?<indent> {0,3})(?<fence>${n.join("|")})suggestion[ 	]*$`,"m")}i.d(t,{u:()=>n})},97695:(e,t,i)=>{i.d(t,{H:()=>c});var n=i(48845),r=i(20622),a=i(97665),s=i(94747),o=i(69510),l=i(27011),d=i(21067);function c(e,t){let i=(0,l.Kp)(),c=(0,d.cj)(),u=`${i}/page_data/${r.u.resolveThread}`,m=(0,a.jE)(),{updateThread:f}=(0,l.an)();return(0,s.n)({mutationFn:async({threadId:e})=>{let t=await (0,n.q$)(u,{method:"POST",body:{threadId:e}});(0,n.R)(t)},onSuccess:(n,r)=>(f(Number(r.threadId),e,t,e=>{if(e)return{...e,isResolved:!0,resolvedBy:c}}),m.invalidateQueries({queryKey:(0,o.XG)(i)}))})}}}]);
//# sourceMappingURL=packages_diff-lines_diff-lines_ts-0cd219906600.js.map